(function(e){e.fn.countdown=function(t,n){function i(e,t){return function(){return t.call(e)}}var r=["seconds","minutes","hours","days","weeks","daysLeft"];return this.each(function(){function c(){if(s.closest("html").length===0){p(),h("removed");return}l--,l<0&&(l=0),u={seconds:l%60,minutes:Math.floor(l/60)%60,hours:Math.floor(l/60/60)%24,days:Math.floor(l/60/60/24),weeks:Math.floor(l/60/60/24/7),daysLeft:Math.floor(l/60/60/24)%7};for(var e=0;e<r.length;e++){var t=r[e];o[t]!=u[t]&&(o[t]=u[t],h(t))}l==0&&(p(),h("finished"))}function h(r){var i=e.Event(r);i.date=new Date((new Date).valueOf()+l),i.value=o[r]||"0",i.toDate=t,i.lasting=u;switch(r){case"seconds":case"minutes":case"hours":i.value=i.value<10?"0"+i.value.toString():i.value.toString();break;default:i.value&&(i.value=i.value.toString())}n.call(s,i)}function p(){clearInterval(a)}function d(){s.data("countdownInterval",setInterval(i(s,c),1e3)),a=s.data("countdownInterval")}if(!(t instanceof Date))if(String(t).match(/^[0-9]*$/))t=new Date(t);else if(t.match(/([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{2,4})\s([0-9]{1,2})\:([0-9]{2})\:([0-9]{2})/)||t.match(/([0-9]{2,4})\/([0-9]{1,2})\/([0-9]{1,2})\s([0-9]{1,2})\:([0-9]{2})\:([0-9]{2})/))t=new Date(t);else{if(!t.match(/([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{2,4})/)&&!t.match(/([0-9]{2,4})\/([0-9]{1,2})\/([0-9]{1,2})/))throw new Error("Doesn't seen to be a valid date object or string");t=new Date(t)}var s=e(this),o={},u={},a=s.data("countdownInterval"),f=new Date,l=Math.floor((t.valueOf()-f.valueOf())/1e3);c(),a&&p(),d()})}})(jQuery);(function(e,t){var n={smoketimeout:[],init:!1,zindex:1e3,i:0,bodyload:function(e){var r=t.createElement("div");r.setAttribute("id","smoke-out-"+e),r.className="smoke-base",r.style.zIndex=n.zindex,n.zindex++,t.body.appendChild(r)},newdialog:function(){var t=(new Date).getTime();return t=Math.random(1,99)+t,n.init?n.bodyload(t):n.listen(e,"load",function(){n.bodyload(t)}),t},forceload:function(){},build:function(t,r){n.i++,r.stack=n.i,t=t.replace(/\n/g,"<br />"),t=t.replace(/\r/g,"<br />");var i="",s="OK",o="Cancel",u="",a="",f;r.type==="prompt"&&(i='<div class="dialog-prompt"><input id="dialog-input-'+r.newid+'" type="text" '+(r.params.value?'value="'+r.params.value+'"':"")+" />"+"</div>"),r.params.ok&&(s=r.params.ok),r.params.cancel&&(o=r.params.cancel),r.params.classname&&(u=r.params.classname);if(r.type!=="signal"){a='<div class="dialog-buttons">';if(r.type==="alert")a+='<button id="alert-ok-'+r.newid+'">'+s+"</button>";else if(r.type==="quiz")r.params.button_1&&(a+='<button class="quiz-button" id="'+r.type+"-ok1-"+r.newid+'">'+r.params.button_1+"</button>"),r.params.button_2&&(a+='<button class="quiz-button" id="'+r.type+"-ok2-"+r.newid+'">'+r.params.button_2+"</button>"),r.params.button_3&&(a+='<button class="quiz-button" id="'+r.type+"-ok3-"+r.newid+'">'+r.params.button_3+"</button>"),r.params.button_cancel&&(a+='<button id="'+r.type+"-cancel-"+r.newid+'" class="cancel">'+r.params.button_cancel+"</button>");else if(r.type==="prompt"||r.type==="confirm")r.params.reverseButtons?a+='<button id="'+r.type+"-ok-"+r.newid+'">'+s+"</button>"+'<button id="'+r.type+"-cancel-"+r.newid+'" class="cancel">'+o+"</button>":a+='<button id="'+r.type+"-cancel-"+r.newid+'" class="cancel">'+o+"</button>"+'<button id="'+r.type+"-ok-"+r.newid+'">'+s+"</button>";a+="</div>"}f='<div id="smoke-bg-'+r.newid+'" class="smokebg"></div>'+'<div class="dialog smoke '+u+'">'+'<div class="dialog-inner">'+t+i+a+"</div>"+"</div>",n.init?n.finishbuild(t,r,f):n.listen(e,"load",function(){n.finishbuild(t,r,f)})},finishbuild:function(e,r,i){var s=t.getElementById("smoke-out-"+r.newid);s.className="smoke-base smoke-visible  smoke-"+r.type,s.innerHTML=i;while(s.innerHTML==="")s.innerHTML=i;n.smoketimeout[r.newid]&&clearTimeout(n.smoketimeout[r.newid]),n.listen(t.getElementById("smoke-bg-"+r.newid),"click",function(){n.destroy(r.type,r.newid),r.type==="prompt"||r.type==="confirm"||r.type==="quiz"?r.callback(!1):r.type==="alert"&&typeof r.callback!="undefined"&&r.callback()});switch(r.type){case"alert":n.finishbuildAlert(e,r,i);break;case"confirm":n.finishbuildConfirm(e,r,i);break;case"quiz":n.finishbuildQuiz(e,r,i);break;case"prompt":n.finishbuildPrompt(e,r,i);break;case"signal":n.finishbuildSignal(e,r,i);break;default:throw"Unknown type: "+r.type}},finishbuildAlert:function(r,i,s){n.listen(t.getElementById("alert-ok-"+i.newid),"click",function(){n.destroy(i.type,i.newid),typeof i.callback!="undefined"&&i.callback()}),t.onkeyup=function(t){t||(t=e.event);if(t.keyCode===13||t.keyCode===32||t.keyCode===27)n.destroy(i.type,i.newid),typeof i.callback!="undefined"&&i.callback()}},finishbuildConfirm:function(r,i,s){n.listen(t.getElementById("confirm-cancel-"+i.newid),"click",function(){n.destroy(i.type,i.newid),i.callback(!1)}),n.listen(t.getElementById("confirm-ok-"+i.newid),"click",function(){n.destroy(i.type,i.newid),i.callback(!0)}),t.onkeyup=function(t){t||(t=e.event),t.keyCode===13||t.keyCode===32?(n.destroy(i.type,i.newid),i.callback(!0)):t.keyCode===27&&(n.destroy(i.type,i.newid),i.callback(!1))}},finishbuildQuiz:function(r,i,s){var o,u,a;n.listen(t.getElementById("quiz-cancel-"+i.newid),"click",function(){n.destroy(i.type,i.newid),i.callback(!1)}),(o=t.getElementById("quiz-ok1-"+i.newid))&&n.listen(o,"click",function(){n.destroy(i.type,i.newid),i.callback(o.innerHTML)}),(u=t.getElementById("quiz-ok2-"+i.newid))&&n.listen(u,"click",function(){n.destroy(i.type,i.newid),i.callback(u.innerHTML)}),(a=t.getElementById("quiz-ok3-"+i.newid))&&n.listen(a,"click",function(){n.destroy(i.type,i.newid),i.callback(a.innerHTML)}),t.onkeyup=function(t){t||(t=e.event),t.keyCode===27&&(n.destroy(i.type,i.newid),i.callback(!1))}},finishbuildPrompt:function(r,i,s){var o=t.getElementById("dialog-input-"+i.newid);setTimeout(function(){o.focus(),o.select()},100),n.listen(t.getElementById("prompt-cancel-"+i.newid),"click",function(){n.destroy(i.type,i.newid),i.callback(!1)}),n.listen(t.getElementById("prompt-ok-"+i.newid),"click",function(){n.destroy(i.type,i.newid),i.callback(o.value)}),t.onkeyup=function(t){t||(t=e.event),t.keyCode===13?(n.destroy(i.type,i.newid),i.callback(o.value)):t.keyCode===27&&(n.destroy(i.type,i.newid),i.callback(!1))}},finishbuildSignal:function(r,i,s){t.onkeyup=function(t){t||(t=e.event),t.keyCode===27&&(n.destroy(i.type,i.newid),typeof i.callback!="undefined"&&i.callback())},n.smoketimeout[i.newid]=setTimeout(function(){n.destroy(i.type,i.newid),typeof i.callback!="undefined"&&i.callback()},i.timeout)},destroy:function(e,r){var i=t.getElementById("smoke-out-"+r);if(e!=="quiz")var s=t.getElementById(e+"-ok-"+r);var o=t.getElementById(e+"-cancel-"+r);i.className="smoke-base",s&&(n.stoplistening(s,"click",function(){}),t.onkeyup=null);if(e==="quiz"){var u=t.getElementsByClassName("quiz-button");for(var a=0;a<u.length;a++)n.stoplistening(u[a],"click",function(){}),t.onkeyup=null}o&&n.stoplistening(o,"click",function(){}),n.i=0,i.innerHTML=""},alert:function(e,t,r){typeof r!="object"&&(r=!1);var i=n.newdialog();n.build(e,{type:"alert",callback:t,params:r,newid:i})},signal:function(e,t,r){typeof r!="object"&&(r=!1);var i=5e3;r.duration!=="undefined"&&(i=r.duration);var s=n.newdialog();n.build(e,{type:"signal",callback:t,timeout:i,params:r,newid:s})},confirm:function(e,t,r){typeof r!="object"&&(r=!1);var i=n.newdialog();n.build(e,{type:"confirm",callback:t,params:r,newid:i})},quiz:function(e,t,r){typeof r!="object"&&(r=!1);var i=n.newdialog();n.build(e,{type:"quiz",callback:t,params:r,newid:i})},prompt:function(e,t,r){typeof r!="object"&&(r=!1);var i=n.newdialog();return n.build(e,{type:"prompt",callback:t,params:r,newid:i})},listen:function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):!1},stoplistening:function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):!1}};n.init=!0,typeof module!="undefined"&&module.exports?module.exports=n:typeof define=="function"&&define.amd?define("smoke",[],function(){return n}):this.smoke=n})(window,document);var Holder=Holder||{};!function(e,t){function n(e,t){var n="complete",r="readystatechange",i=!1,s=i,o=!0,u=e.document,a=u.documentElement,f=u.addEventListener?"addEventListener":"attachEvent",l=u.addEventListener?"removeEventListener":"detachEvent",c=u.addEventListener?"":"on",h=function(o){(o.type!=r||u.readyState==n)&&(("load"==o.type?e:u)[l](c+o.type,h,i),!s&&(s=!0)&&t.call(e,null))},p=function(){try{a.doScroll("left")}catch(e){return setTimeout(p,50),void 0}h("poll")};if(u.readyState==n)t.call(e,"lazy");else{if(u.createEventObject&&a.doScroll){try{o=!e.frameElement}catch(d){}o&&p()}u[f](c+"DOMContentLoaded",h,i),u[f](c+r,h,i),e[f](c+"load",h,i)}}function r(e){e=e.match(/^(\W)?(.*)/);var t=document["getElement"+(e[1]?"#"==e[1]?"ById":"sByClassName":"sByTagName")](e[2]),n=[];return null!=t&&(n=t.length?t:0==t.length?t:[t]),n}function s(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n}function o(e,t,n){t=parseInt(t,10),e=parseInt(e,10);var r=Math.max(t,e),i=Math.min(t,e),s=1/12,o=Math.min(.75*i,.75*r*s);return{height:Math.round(Math.max(n.size,o))}}function u(e,t,n,r){var i=o(t.width,t.height,n),s=i.height,u=t.width*r,a=t.height*r,f=n.font?n.font:"sans-serif";p.width=u,p.height=a,e.textAlign="center",e.textBaseline="middle",e.fillStyle=n.background,e.fillRect(0,0,u,a),e.fillStyle=n.foreground,e.font="bold "+s+"px "+f;var l=n.text?n.text:Math.floor(t.width)+"x"+Math.floor(t.height),c=e.measureText(l).width;return c/u>=.75&&(s=Math.floor(.75*s*(u/c))),e.font="bold "+s*r+"px "+f,e.fillText(l,u/2,a/2,u),p.toDataURL("image/png")}function a(e,t,n,r){var i=n.dimensions,o=n.theme,a=n.text?decodeURIComponent(n.text):n.text,l=i.width+"x"+i.height;o=a?s(o,{text:a}):o,o=n.font?s(o,{font:n.font}):o,"image"==e?(t.setAttribute("data-src",r),t.setAttribute("alt",a?a:o.text?o.text+" ["+l+"]":l),(h||!n.auto)&&(t.style.width=i.width+"px",t.style.height=i.height+"px"),h?t.style.backgroundColor=o.background:t.setAttribute("src",u(d,i,o,g))):"background"==e?h||(t.style.backgroundImage="url("+u(d,i,o,g)+")",t.style.backgroundSize=i.width+"px "+i.height+"px"):"fluid"==e&&(t.setAttribute("data-src",r),t.setAttribute("alt",a?a:o.text?o.text+" ["+l+"]":l),t.style.height="%"==i.height.substr(-1)?i.height:i.height+"px",t.style.width="%"==i.width.substr(-1)?i.width:i.width+"px",("inline"==t.style.display||""==t.style.display)&&(t.style.display="block"),h?t.style.backgroundColor=o.background:(t.holderData=n,y.push(t),f(t)))}function f(e){var t;t=null==e.nodeType?y:[e];for(i in t){var n=t[i];if(n.holderData){var r=n.holderData;n.setAttribute("src",u(d,{height:n.clientHeight,width:n.clientWidth},r.theme,g))}}}function l(t,n){var r={theme:b.themes.gray},i=!1;for(sl=t.length,j=0;sl>j;j++){var s=t[j];e.flags.dimensions.match(s)?(i=!0,r.dimensions=e.flags.dimensions.output(s)):e.flags.fluid.match(s)?(i=!0,r.dimensions=e.flags.fluid.output(s),r.fluid=!0):e.flags.colors.match(s)?r.theme=e.flags.colors.output(s):n.themes[s]?r.theme=n.themes[s]:e.flags.text.match(s)?r.text=e.flags.text.output(s):e.flags.font.match(s)?r.font=e.flags.font.output(s):e.flags.auto.match(s)&&(r.auto=!0)}return i?r:!1}var c=!1,h=!1,p=document.createElement("canvas");if(document.getElementsByClassName||(document.getElementsByClassName=function(e){var t,n,r,i=document,s=[];if(i.querySelectorAll)return i.querySelectorAll("."+e);if(i.evaluate)for(n=".//*[contains(concat(' ', @class, ' '), ' "+e+" ')]",t=i.evaluate(n,i,null,0,null);r=t.iterateNext();)s.push(r);else for(t=i.getElementsByTagName("*"),n=new RegExp("(^|\\s)"+e+"(\\s|$)"),r=0;r<t.length;r++)n.test(t[r].className)&&s.push(t[r]);return s}),window.getComputedStyle||(window.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this}),Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e){var t=this.__proto__||this.constructor.prototype;return e in this&&(!(e in t)||t[e]!==this[e])}),p.getContext)if(p.toDataURL("image/png").indexOf("data:image/png")<0)h=!0;else var d=p.getContext("2d");else h=!0;var v=1,m=1;h||(v=window.devicePixelRatio||1,m=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1);var g=v/m,y=[],b={domain:"holder.js",images:"img",bgnodes:".holderjs",themes:{gray:{background:"#eee",foreground:"#aaa",size:12},social:{background:"#3a5a97",foreground:"#fff",size:12},industrial:{background:"#434A52",foreground:"#C2F200",size:12}},stylesheet:""};e.flags={dimensions:{regex:/^(\d+)x(\d+)$/,output:function(e){var t=this.regex.exec(e);return{width:+t[1],height:+t[2]}}},fluid:{regex:/^([0-9%]+)x([0-9%]+)$/,output:function(e){var t=this.regex.exec(e);return{width:t[1],height:t[2]}}},colors:{regex:/#([0-9a-f]{3,})\:#([0-9a-f]{3,})/i,output:function(e){var t=this.regex.exec(e);return{size:b.themes.gray.size,foreground:"#"+t[2],background:"#"+t[1]}}},text:{regex:/text\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},font:{regex:/font\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},auto:{regex:/^auto$/}};for(var w in e.flags)e.flags.hasOwnProperty(w)&&(e.flags[w].match=function(e){return e.match(this.regex)});e.add_theme=function(t,n){return null!=t&&null!=n&&(b.themes[t]=n),e},e.add_image=function(t,n){var i=r(n);if(i.length)for(var s=0,o=i.length;o>s;s++){var u=document.createElement("img");u.setAttribute("data-src",t),i[s].appendChild(u)}return e},e.run=function(t){var n=s(b,t),i=[],o=[],u=[];for("string"==typeof n.images?o=r(n.images):window.NodeList&&n.images instanceof window.NodeList?o=n.images:window.Node&&n.images instanceof window.Node&&(o=[n.images]),"string"==typeof n.bgnodes?u=r(n.bgnodes):window.NodeList&&n.elements instanceof window.NodeList?u=n.bgnodes:window.Node&&n.bgnodes instanceof window.Node&&(u=[n.bgnodes]),c=!0,d=0,p=o.length;p>d;d++)i.push(o[d]);var f=document.getElementById("holderjs-style");f||(f=document.createElement("style"),f.setAttribute("id","holderjs-style"),f.type="text/css",document.getElementsByTagName("head")[0].appendChild(f)),n.nocss||(f.styleSheet?f.styleSheet.cssText+=n.stylesheet:f.appendChild(document.createTextNode(n.stylesheet)));for(var h=new RegExp(n.domain+'/(.*?)"?\\)'),p=u.length,d=0;p>d;d++){var v=window.getComputedStyle(u[d],null).getPropertyValue("background-image"),m=v.match(h),g=u[d].getAttribute("data-background-src");if(m){var y=l(m[1].split("/"),n);y&&a("background",u[d],y,v)}else if(null!=g){var y=l(g.substr(g.lastIndexOf(n.domain)+n.domain.length+1).split("/"),n);y&&a("background",u[d],y,v)}}for(p=i.length,d=0;p>d;d++){var w=attr_data_src=v=null;try{w=i[d].getAttribute("src"),attr_datasrc=i[d].getAttribute("data-src")}catch(E){}if(null==attr_datasrc&&w&&w.indexOf(n.domain)>=0?v=w:attr_datasrc&&attr_datasrc.indexOf(n.domain)>=0&&(v=attr_datasrc),v){var y=l(v.substr(v.lastIndexOf(n.domain)+n.domain.length+1).split("/"),n);y&&(y.fluid?a("fluid",i[d],y,v):a("image",i[d],y,v))}}return e},n(t,function(){window.addEventListener?(window.addEventListener("resize",f,!1),window.addEventListener("orientationchange",f,!1)):window.attachEvent("onresize",f),c||e.run()}),"function"==typeof define&&define.amd&&define("Holder",[],function(){return e})}(Holder,window);"use strict";var OJApp=angular.module("OJApp",["ui.bootstrap","chart.js","ngRoute","ngSanitize","webStorageModule","lr.upload","angucomplete-alt"]);OJApp.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"page/main.html",controller:"mainController"}).when("/cad/comlist",{templateUrl:"cad/page/comlist.html",controller:"comListController"}).when("/cad/eachcom",{templateUrl:"cad/page/eachcom.html",controller:"eachComController"}).when("/cad/frcom",{templateUrl:"cad/page/frcom.html",controller:"frComController"}).when("/cad/rank",{templateUrl:"cad/page/rank.html",controller:"cadRankController"}).when("/dp/register",{templateUrl:"dp/page/dpregister.html",controller:"cadLoginController"}).when("/dp/register2",{templateUrl:"dp/page/dpregister2.html",controller:"cadLoginController"}).when("/dp/",{templateUrl:"dp/page/dplogin.html",controller:"cadLoginController"}).when("/dp/login",{templateUrl:"dp/page/dplogin.html",controller:"cadLoginController"}).when("/dp/testmain",{templateUrl:"dp/page/testmain.html",controller:"testMainController"}).when("/dp/testdetail",{templateUrl:"dp/page/testdetail.html",controller:"testDetailController"}).when("/dp/cadtesting/",{templateUrl:"dp/page/cadtesting.html",controller:"cadtestingController"}).when("/dp/profile/",{templateUrl:"dp/page/profile.html",controller:"profileController"}).when("/dp/findpwd",{templateUrl:"dp/page/findPwd.html",controller:"findCadPwdCtrl"}).when("/user",{templateUrl:"page/page.html",controller:"testshow"}).when("/rock&roll/:rrid",{templateUrl:"page/page.html",controller:"RockRoll"}).when("/loginok",{templateUrl:"page/page.html",controller:"LoginOk"}).when("/test",{templateUrl:"page/page.html",controller:"TestPage"}).when("/innertest",{templateUrl:"page/page.html",controller:"InnerTest"}).when("/test/:tid",{templateUrl:"page/page.html",controller:"TestPageTid"}).when("/testConfig",{templateUrl:"page/page.html",controller:"testConfig"}).when("/upgrade",{templateUrl:"page/page.html",controller:"Upgrade"}).when("/bank",{templateUrl:"page/page.html",controller:"TestBank"}).when("/invite",{templateUrl:"page/page.html",controller:"invite"}).when("/mybank",{templateUrl:"page/page.html",controller:"mytestbank"}).when("/profile",{templateUrl:"page/page.html",controller:"pInfo"}).when("/editor",{templateUrl:"page/page.html",controller:"aceEditor"}).when("/mchoice",{templateUrl:"page/page.html",controller:"mchoice"}).when("/mchoice/:r",{templateUrl:"page/page.html",controller:"mchoice"}).when("/adminhome",{templateUrl:"page/admin/adminhome.html",controller:"adminController"}).when("/testing/:url",{templateUrl:"page/preparetest.html",controller:"testingController"}).when("/report/show/:state",{templateUrl:"page/page.html",controller:"reportController"}).when("/report/list",{templateUrl:"page/page.html",controller:"reportListController"}).when("/publicReport/list/:url",{templateUrl:"page/testreport.html",controller:"publicReportListController"}).when("/report/detail",{templateUrl:"page/page.html",controller:"reportDetailController"}).when("/report/log",{templateUrl:"page/page.html",controller:"reportLogController"}).when("/oauthor",{templateUrl:"page/oauthor.html",controller:"oauthorController"}).when("/login",{templateUrl:"page/login.html",controller:"loginCtrl"}).when("/signup",{templateUrl:"page/signup.html",controller:"signupCtrl"}).when("/findPwd",{templateUrl:"page/findPwd.html",controller:"findPwdCtrl"}).when("/publictest/:url",{templateUrl:"page/page.html",controller:"publictestCtrl"}).when("/reset/:auth",{templateUrl:"page/findPwd.html",controller:"findPwdCtrl"}).when("/dp/reset/:auth",{templateUrl:"dp/page/findPwd.html",controller:"findCadPwdCtrl"}).when("/cad/signup",{templateUrl:"cad/page/signup.html",controller:"cadSignupCtrl"}).when("/cad/login",{templateUrl:"cad/page/login.html",controller:"cadLoginCtrl"}).otherwise({redirectTo:"/"})}]),OJApp.factory("Data",["webStorage",function(e){function t(){this._flag=0,this.flag=function(){if(this._flag==""||this._flag==null){this._flag=e.get("flag");if(this._flag==""||this._flag==null)this._flag=0,e.add("flag",0)}return this._flag},this.setFlag=function(t){e.remove("flag"),e.add("flag",t),this._flag=t},this._key1="",this.key1=function(){if(this._key1==""||this._key1==null)this._key1=e.get("key1");return this._key1},this.setKey1=function(t){e.remove("key1"),e.add("key1",t),this._key1=t},this._key2="",this.key2=function(){if(this._key2==""||this._key2==null)this._key1=e.get("key2");return this._key2},this.setKey2=function(t){e.remove("key2"),e.add("key2",t),this._key2=t},this._key3="",this.key3=function(){if(this._key3==""||this._key3==null)this._key3=e.get("key3");return this._key3},this.setKey3=function(t){e.remove("key3"),e.add("key3",t),this._key3=t},this._token="",this.token=function(){if(this._token==""||this._token==null)this._token=e.get("token");return this._token},this.setToken=function(t){e.remove("token"),e.add("token",t),this._token=t},this.removeToken=function(){e.remove("token"),this._token=""},this._mdToken="",this.mdToken=function(){if(this._mdToken==""||this._mdToken==null)this._mdToken=e.get("mdToken");return this._mdToken},this.setMdToken=function(t){e.remove("mdToken"),e.add("mdToken",t),this._mdToken=t},this.removeMdToken=function(){e.remove("mdToken"),this._mdToken=""},this._mdUid="",this.mdUid=function(){if(this._mdUid==""||this._mdUid==null)this._mdUid=e.get("mdUid");return this._mdUid},this.setMdUid=function(t){e.remove("mdUid"),e.add("mdUid",t),this._mdUid=t},this.removeMdUid=function(){e.remove("mdUid"),this._mdUid=""},this._invitedleft="",this.invitedleft=function(){if(this._invitedleft==""||this._invitedleft==null)this._invitedleft=e.get("invitedleft");return this._invitedleft},this.setInvitedleft=function(t){e.remove("invitedleft"),e.add("invitedleft",t),this._invitedleft=t},this._uid="",this.uid=function(){if(this._uid==""||this._uid==null)this._uid=e.get("uid");return this._uid},this.setUid=function(t){e.remove("uid"),e.add("uid",t),this._uid=t},this._ans="",this.ans=function(){if(this._ans==""||this._ans==null)this._ans=e.get("ans");return this._ans},this.setAns=function(t){e.remove("ans"),e.add("ans",t),this._ans=t},this._name="",this.name=function(){if(this._name==""||this._name==null)this._name=e.get("name");return this._name},this.setName=function(t){e.remove("name"),e.add("name",t),this._name=t},this._email="",this.email=function(){if(this._email==""||this._email==null)this._email=e.get("email");return this._email},this.setEmail=function(t){e.remove("email"),e.add("email",t),this._email=t},this._tid="",this.tid=function(){if(this._tid==""||this._tid==null)this._tid=e.get("tid");return this._tid},this.setTid=function(t){e.remove("tid"),e.add("tid",t),this._tid=t},this._tname="",this.tname=function(){if(this._tname==""||this._tname==null)this._tname=e.get("tname");return this._tname},this.setTname=function(t){e.remove("tname"),e.add("tname",t),this._tname=t},this._context="",this.context=function(){if(this._context==""||this._context==null)this._context=e.get("context");return this._context},this.setContext=function(t){e.remove("context"),e.add("context",t),this._context=t},this._answer="",this.answer=function(){if(this._answer==""||this._answer==null)this._answer=e.get("answer");return this._answer},this.setAnswer=function(t){e.remove("answer"),e.add("answer",t),this._answer=t},this._lastActive="",this.lastActive=function(){if(this._lastActive==""||this._lastActive==null)this._lastActive=e.get("lastActive");return this._lastActive},this.setLastActive=function(t){e.remove("lastActive"),e.add("lastActive",t),this._lastActive=t},this._qs="",this.qs=function(){if(this._qs==""||this._qs==null)this._qs=e.get("qs");return this._qs},this.setQs=function(t){e.remove("qs"),e.add("qs",t),this._qs=t},this._company="",this.company=function(){if(this._company==""||this._company==null)this._company=e.get("company");return this._company},this.setCompany=function(t){e.remove("company"),e.add("company",t),this._company=t},this._tel="",this.tel=function(){if(this._tel==""||this._tel==null)this._tel=e.get("tel");return this._tel},this.setTel=function(t){e.remove("tel"),e.add("tel",t),this._tel=t},this._privi="",this.privi=function(){if(this._privi==""||this._privi==null)this._privi=e.get("privi");return this._privi},this.setPrivi=function(t){e.remove("privi"),e.add("privi",t),this._privi=t},this._inviteid="",this.inviteid=function(){if(this._inviteid==""||this._inviteid==null)this._inviteid=e.get("inviteid");return this._inviteid},this.setInviteid=function(t){e.remove("inviteid"),e.add("inviteid",t),this._inviteid=t},this._tuid="",this.tuid=function(){if(this._tuid==""||this._tuid==null)this._tuid=e.get("tuid");return this._tuid},this.setTuid=function(t){e.remove("tuid"),e.add("tuid",t),this._tuid=t},this.clear=function(){e.clear();for(var t in this)typeof this[t]!="function"&&(this[t]="")}}return new t}]),OJApp.factory("CadData",["webStorage",function(e){function t(){this._token="",this.getToken=function(){if(this._token==""||this._token==null)this._token=e.get("token");return this._token},this.setToken=function(t){e.remove("token"),e.add("token",t),this._token=t},this._email="",this.getEmail=function(){if(this._email==""||this._email==null)this._email=e.get("email");return this._email},this.setEmail=function(t){e.remove("email"),e.add("email",t),this._email=t},this._testid="",this.getTestid=function(){if(this._testid==""||this._testid==null)this._testid=e.get("testid");return this._testid},this.setTestid=function(t){e.remove("testid"),e.add("testid",t),this._testid=t},this._testname="",this.getTestname=function(){if(this._testname==""||this._testname==null)this._testname=e.get("testname");return this._testname},this.setTestname=function(t){e.remove("testname"),e.add("testname",t),this._testname=t},this._rembme="",this.getRembme=function(){if(this._rembme==""||this._rembme==null)this._rembme=e.get("rembme");return this._rembme},this.setRembme=function(t){e.remove("rembme"),e.add("rembme",t),this._rembme=t},this.clear=function(){e.clear();for(var t in this)typeof this[t]!="function"&&(this[t]="")}}return new t}]);OJApp.controller("mainController",["$scope","$http","$routeParams","$location","Data","$modal",function(e,t,n,r,i,s){var o=n.code;e.video={},e.video.show=0,typeof o!="undefined"&&t({url:WEBROOT+"/user/oauthorlogin",method:"POST",data:{source:"mingdao",code:o}}).success(function(t){console.log("data................",t);if(t.state==1)e.Lemail=t.message.user.email,e.Lpwd=t.message.user.pwd,i.setMdToken(t.message.token),e.confirm(2);else if(t.state==2){i.setMdToken(t.message.token),i.setEmail(t.message.user.email),i.setCompany(t.message.user.company),i.setMdUid(t.message.user.mdUid);var n=MD_REDIRECT+"oauthor?title=请创建一个新账号来与明道账号绑定";window.location.href=n}else flashTip("非常抱歉，访问明道api超时，请稍后重试",function(e){e?window.location.href="http://findfool.com/#/":window.location.href="http://findfool.com/#/"},{ok:"确定",reverseButtons:!0})}).error(function(){console.log("error.......")});if(typeof i.lastActive()!="undefined"&&typeof i.email()!="undefined"){var u=(new Date).getTime(),a=i.lastActive();u-a<18e5&&(window.location.href="#/loginok")}e.confirm=function(n){if(e.Lemail&&e.Lpwd){if(n==1)var r=md5(e.Lpwd);else var r=e.Lpwd;t({url:WEBROOT+"/user/confirm",method:"POST",headers:{Authorization:i.token()},data:{email:e.Lemail,pwd:r,name:e.Lname}}).success(function(t){console.log("success"),e.state=t.state,i.clear();var n=e.Lemail;e.message=t.message,t["message"].handler_url!=null&&t.message.handler_url!==""&&(n=t.message.handler_url),i.setName(n),i.setEmail(e.Lemail),e.state?(i.setToken(t.token),i.setUid(e.message.uid),i.setPrivi(e.message.privilege),i.setTel(e.message.tel),i.setCompany(e.message.company),i.setInvitedleft(e.message.invited_left),i.setLastActive((new Date).getTime()),e.invitedleft=e.message.invited_left,window.location.href="#/loginok"):e.errmsg=t.message.msg}).error(function(){console.log("err")})}},e.register=function(e,t){var n=s.open({templateUrl:"page/registerModal.html",controller:"registerInstanceCtrl",size:"lg",resolve:{params:function(){var n={};return n.email=e,n.company=t,n}}})},e.login=function(){var e=s.open({templateUrl:"page/loginModal.html",controller:"loginInstanceCtrl",size:"lg",resolve:{}})},e.showVideo=function(){var e=s.open({templateUrl:"page/videoModal.html",controller:"videoInstanceCtrl",size:"lg",resolve:{}})},e.myInterval=2e3;var f=["自从用了FoolRank，腰不酸了，脖子不疼了，再也不用熬夜刷简历了","FoolRank大法好，退其它招聘平台保平安","程序猿再也不用每个平台填简历了"],l=e.slides=[];e.addSlide=function(e){l.push({image:"resource/static/carousel.png",text:f[e-1]})};for(var c=1;c<4;c++)e.addSlide(c);e.labels=["html5","css3","javascript","angularjs","node.js","object-c","java"],e.data=[[65,59,90,81,56,55,100],[58,48,40,19,96,27,78]],e.labelsScore1=["得分","总分"],e.dataScore1=[80,100],e.labelsScore2=["我的排名",""],e.dataScore2=[90,10],e.contactus=function(){i.email()?t({url:WEBROOT+"/contactus",method:"POST",headers:{Authorization:i.token()},data:{email:i.email(),name:i.name(),msg:e.msg}}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.thx="感谢您的提交")}).error(function(){alert("网络错误")}):e.Cemail&&t({url:WEBROOT+"/contactus",method:"POST",headers:{Authorization:i.token()},data:{email:e.Cemail,name:e.name,msg:e.msg}}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.thx="感谢您的提交")}).error(function(){alert("网络错误"),window.location.reload(!0)})},e.addadmin=function(){t({url:WEBROOT+"/user/add/admin",method:"POST",headers:{Authorization:i.token()},data:{email:e.email,pwd:e.pwd,name:e.name}}).success(function(t){e.state=t.state,e.message=t.message,e.state}).error(function(){alert("网络错误"),window.location.reload(!0)})},e.show=1,e.btn=function(){e.show=-(e.show-1)},e.enter=function(t){t.keyCode==13&&e.confirm(1)}}]),OJApp.controller("nav",["$scope","Data",function(e,t){e.invitedleft=t.invitedleft(),e.name=t.email();var n=window.location.hash;if(n=="#/test"||n=="#/innertest")e.isTestActive=!0;else if(n=="#/bank"||n=="#/mybank")e.isLibActive=!0;e.navTest=function(){e.template="testshow.html",e.ContentUs="contentUs.html",e.leftBar=""},e.navTestBank=function(){e.template="page/testBank.html",e.ContentUs="contentUs.html",e.leftBar="leftBar1.html"},e.navmyTestBank=function(){e.template="page/mytestBank.html",e.ContentUs="contentUs.html",e.leftBar="leftBar1.html"},e.navPersonal=function(){e.template="user.html",e.ContentUs="contentUs.html",e.leftBar=""},e.logout=function(){t.clear(),window.location.href="#/"}}]),OJApp.controller("Upgrade",["$scope",function(e){e.url="#/upgrade",e.template="page/upgrade.html",e.ContentUs="page/contentUs.html",e.leftBar=""}]),OJApp.controller("RockRoll",function(e,t){e.url="#/upgrade",e.template="rrtest.html",e.ContentUs="contentUs.html",e.leftBar="",e.rrid=t.rrid}),OJApp.controller("addQuestion",function(e){e.Qactive=1,e.Tactive=1,e.Qtype=[{name:"选择题",data:"1"},{name:"编程题",data:"2"},{name:"问答题",data:"3"}],e.TYPE=[{name:"网站题库",data:"1"},{name:"自定义试题",data:"2"}],e.goT=function(t){e.Tactive=t.getAttribute("data")},e.goQ=function(t){e.Qactive=t.getAttribute("data")}}),OJApp.controller("waitModalInstance",function(e){});OJApp.directive("customnav",function(){return{restrict:"AE",scope:!1,link:function(e,t,n,r){console.log("custom nav.........."),t.click(function(){console.log("click nav");var e=t.parent();e.addClass("active"),window.location.href=n.url})},replace:!1}});OJApp.directive("customcheckbox",function(){return{restrict:"A",scope:!1,link:function(e,t,n,r){var i="checked",s="disabled",o="checked",u="disabled",a=n.index;n.useranswer!=""&&typeof n.useranswer!="undefined"&&n.useranswer.charAt(a)==1&&(t.addClass(i),e.option.isright=!0),n.report==1?(typeof n.rightanswer!="undefined"&&n.rightanswer.charAt(a)==1&&t.append("<p class='greenFont'><label class='glyphicon glyphicon-ok'></label>正确答案</p>"),typeof n.score!="undefined"&&n.score!=0&&t.append("<p class='greenFont'><label class='glyphicon glyphicon-ok'></label>用例通过</p>")):typeof n.rightanswer!="undefined"&&n.rightanswer.charAt(a)==1&&t.addClass(i),t.children("textarea").click(function(e){e.stopPropagation()}),n.operation=="edit"?t.click(function(n){t.toggleClass(i),t.hasClass(i)?e.option.isright=!0:e.option.isright=!1,n.stopPropagation()}):t.children("textarea").attr("disabled","disabled")},replace:!1}}),OJApp.directive("customradiobox",function(){return{restrict:"A",scope:!1,link:function(e,t,n,r){var i="checked",s="disabled",o="checked",u="disabled",a=n.index;n.useranswer!=""&&typeof n.useranswer!="undefined"&&n.useranswer.charAt(a)==1&&(t.addClass(i),e.option.isright=!0),n.report==1?(typeof n.rightanswer!="undefined"&&n.rightanswer.charAt(a)==1&&t.append("<p class='greenFont'><label class='glyphicon glyphicon-ok'></label>正确答案</p>"),typeof n.score!="undefined"&&n.score!=0&&t.append("<p class='greenFont'><label class='glyphicon glyphicon-ok'></label>用例通过</p>")):typeof n.rightanswer!="undefined"&&n.rightanswer.charAt(a)==1&&t.addClass(i),t.children("textarea").click(function(e){e.stopPropagation()}),n.operation=="edit"?t.click(function(n){t.toggleClass(i),t.hasClass(i)?(e.option.isright=!0,e.$parent.$broadcast("alreadychecked",t)):e.option.isright=!1,n.stopPropagation()}):t.children("textarea").attr("disabled","disabled"),e.$on("alreadychecked",function(n,r){r!=t&&(e.option.isright=!1,t.hasClass(i)&&t.toggleClass(i))})},replace:!1}});OJApp.directive("abstract",function(){return{restrict:"AE",scope:!0,link:function(e,t,n){e.$watch("q.context",function(){var t=e.q.context;e.tmpContext=t.substring(t.indexOf("<p>")+3,t.indexOf("</p>")),t.indexOf("<p>")==-1&&(e.tmpContext=t.substring(0,t.indexOf("<br>"))),e.tmpContext==""&&(e.tmpContext=t),e.tmpContext=e.tmpContext.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<br>/,"")});if(typeof n.context!="undefined"){var r=n.context;e.tmpContext=r.substring(r.indexOf("<p>")+3,r.indexOf("</p>")),r.indexOf("<p>")==-1&&(e.tmpContext=r.substring(0,r.indexOf("<br>"))),e.tmpContext==""&&(e.tmpContext=r),e.tmpContext=e.tmpContext.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<br>/,"")}else e.tmpContext=""},replace:!0,template:"<td>{{tmpContext}}</td>"}});OJApp.directive("aceeditor",["$timeout",function(e){var t=function(e,t){var n=e.renderer.lineHeight,r=e.getSession().getLength();$(t).height(r*n),e.resize()};return{restrict:"A",require:"?ngModel",scope:!0,link:function(n,r,i,s){var o=r[0],u=ace.edit(o);u.setTheme("ace/theme/twilight"),u.getSession().setMode("ace/mode/"+i.language),u.setShowPrintMargin(!1),s.$render=function(){u.setValue(s.$viewValue),t(u,r)},u.on("change",function(){e(function(){n.$apply(function(){var e=u.getValue();s.$setViewValue(e)})}),t(u,r)})}}}]);OJApp.directive("simditor",["$timeout",function(e){return{restrict:"A",require:"?ngModel",scope:!0,link:function(t,n,r,i){var s={textarea:n,toolbar:["color","ol","ul","blockquote","code","table","link","image","hr","indent","outdent"],toolbarFloatOffset:0};r.operation=="view"&&(s.toolbarHidden=!0);var o=new Simditor(s);typeof r.minheight!="undefined"&&n.prev().css("min-height",r.minheight),r.operation=="view"&&n.prev().attr("contenteditable",!1),i.$render=function(){o.setValue(i.$viewValue)},n.click(function(e){e.stopPropagation()}),o.on("valuechanged",function(){r.operation=="edit"&&e(function(){t.$apply(function(){var e=o.getValue();i.$setViewValue(e)})})})}}}]);OJApp.directive("adddot",function(){return{restrict:"AE",scope:!0,link:function(e,t,n){typeof e.problem.useranswer!="undefined"&&e.problem.useranswer!=""&&e.problem.useranswer!="0000"&&t.addClass("dot"),e.$on("adddot",function(e,r){r-1==n.index&&t.addClass("dot")})}}});OJApp.directive("timer",["$timeout",function(e){return{restrict:"AE",scope:!0,link:function(e,t,n){typeof e.time.remain!="undefined"&&t.countdown(e.time.remain,function(t){var n=$(this);switch(t.type){case"seconds":case"minutes":case"hours":case"days":case"weeks":case"daysLeft":n.find("span."+t.type).html(t.value);break;case"finished":e.$emit("cdfinished")}}),e.$on("countdown",function(n,r){console.log("countdown.............."),t.countdown(r,function(t){var n=$(this);switch(t.type){case"seconds":case"minutes":case"hours":case"days":case"weeks":case"daysLeft":n.find("span."+t.type).html(t.value);break;case"finished":e.$emit("cdfinished")}})})}}}]);OJApp.directive("solutionbtn",function(){return{restrict:"AE",scope:{},link:function(e,t,n){t.click(function(){var e=$(".logohead");e.animate({height:"-=600"}),t.parent().animate({height:"-=600"}),t.parents("div.logohead").hide()})}}});function time(e,t,n,r){t==0?(e.removeAttr("disabled"),e.html("免费获取验证码"),t=120):(t==120&&($.ajaxSetup({contentType:"application/json"}),$.post(WEBROOT+"/user/getvertifycode",JSON.stringify({mobile:r}),function(e){n.$emit("vertifycode",e.message)})),e.attr("disabled",!0),e.html("重新发送("+t+")"),t--,setTimeout(function(){time(e,t,n,r)},1e3))}OJApp.directive("countbutton",function(){return{restrict:"AE",scope:!0,link:function(e,t,n){var r=120;t.click(function(){if(typeof e.mobile=="undefined"||e.mobile=="")return e.$emit("mobileError","手机号不得为空"),!1;if(!/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e.mobile))return e.$emit("mobileError","手机号格式不正确"),!1;time(t,r,e,e.mobile)})}}});function enableButton(e){e.removeAttr("disabled")}OJApp.directive("delaybutton",["$timeout",function(e){return{restrict:"AE",scope:!0,link:function(t,n,r){n.click(function(){n.attr("disabled",!0),e(function(){enableButton(n)},3e3)})}}}]);OJApp.directive("camera",function(){return{restrict:"AE",scope:!0,link:function(e,t,n){var r=320,i=240,s=t.get(0).getContext("2d"),o=document.getElementById("video"),u=null;e.$on("takeVideo",function(t,n){isSupportH5Video();try{document.createElement("canvas").getContext("2d"),console.log("浏览器支持HTML5 CANVAS")}catch(r){console.log("浏览器不支持HTML5 CANVAS")}setupCamera(o,e)}),e.$on("takePicture",function(e){s.drawImage(o,0,0,r,i),console.log("执行takePicture")}),e.$on("updatePicture",function(t,n){var o=s.getImageData(0,0,r,i),u=canvas.toDataURL("image/jpeg",.7).substr(23);$.ajax({url:WEBROOT+"/uploadimg",type:"POST",contentType:"application/json",data:JSON.stringify({imgData:u,email:e.email,invitedid:e.invitedid,state:n}),method:"POST",dataType:"json",success:function(t){t.state==0?e.$emit("baseImgSave"):t.state==1&&e.$emit("baseImgRecapture")},error:function(){console.log("服务器异常")}})})}}});var setupCamera=function(e,t){var n=function(e){console.log("Video capture error: ",e.code);if(e.name=="PermissionDeniedError"||e.code=="PermissionDeniedError")smoke.alert("不小心点拒绝了吧。请重启浏览器或重启机器来重新开启摄像头。"),t.$emit("cameraErr")},r=function(n){e.src=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(n):n,e.play(),console.log("cameraerr open success"),t.$emit("cameraOK")};window.URL=window.URL||window.webkitURL||window.msURL||window.oURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;try{console.dir(navigator.getUserMedia),navigator.getUserMedia({video:!0},r,n)}catch(i){console.log(i),navigator.getUserMedia("video",r,n)}},isSupportH5Video=function(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,isChromiumVersionLower()?!1:navigator.getUserMedia?navigator.getUserMedia.length=="0"?!1:!0:!1},isChromiumVersionLower=function(){var e=navigator.userAgent,t=e.match(/AppleWebKit\/.* Chrome\/([\d.]+).* Safari\//);if(!t)return!1;var n=t[1].split(".");return parseInt(n[0])<18||parseInt(n[0])==18&&parseInt(n[1])==0&&parseInt(n[2])<966};OJApp.directive("customvideo",function(){return{restrict:"AE",scope:!0,link:function(e,t,n){e.$watch("videoplay",function(){typeof e.videoplay!="undefined"&&t[0].play()}),e.$on("videoplay",function(){console.log("video play............"),t[0].play()}),e.$on("videostop",function(){t[0].end()})}}});OJApp.directive("star",function(){return{restrict:"AE",scope:{},link:function(e,t,n){var r=0;n.num>0&&n.num<=.2?r=1:n.num>.2&&n.num<=.4?r=2:n.num>.4&&n.num<=.6?r=3:n.num>.6&&n.num<=.8?r=4:n.num>.8&&(r=5),e.context="resource/static/"+r+"star.png",e.size="col-md-"+n.size+" col-xs-"+(parseInt(n.size)+2),console.log(e.size)},replace:!0,template:"<img class='{{size}}' ng-src={{context}} style='margin-bottom=5px;'>"}});function flashTip(e){var t=document.createElement("span");t.setAttribute("class","tipContent"),t.innerHTML=e;var n=document.createElement("div");n.setAttribute("id","hint"),n.setAttribute("class","tipBox"),n.appendChild(t),document.body.appendChild(n),setTimeout("removeTip()",2e3)}function removeTip(){document.body.removeChild(document.body.lastChild)}function loadingTip(){var e=document.createElement("div");e.setAttribute("id","container"),e.setAttribute("class","loadingTip-container");var t=document.createElement("div");t.setAttribute("class","loadingTip-content");var n=document.createElement("img");n.setAttribute("src","./resource/static/loadingTip.gif");var r=document.createElement("p");r.innerHTML="正在处理...",t.appendChild(n),t.appendChild(r),e.appendChild(t),document.body.appendChild(e)};OJApp.controller("testshow",["$scope","$http","$Data",function(e,t,n){e.template="testshow.html",e.ContentUs="contentUs.html",e.leftBar="",e.name=n.name(),e.local==1?t({url:WEBROOT+"./data/TestManage.json",method:"GET",data:{testID:e.tests[e.active-1].id}}).success(function(t){e.questions=t.qs}):t({url:WEBROOT+"./data/TestManage.json",method:"GET",data:{testID:e.tests[e.active-1].id}}).success(function(t){e.questions=t.qs}),e.Invite=function(t){e.active=t.getAttribute("data"),e.tid=e.tests[e.active-1].id,e.active=t.getAttribute("data"),e.name=e.tests[e.active-1].name,e.template="invite.html",e.leftBar="leftBar.html"},e.MultInvite=function(t){e.active=t.getAttribute("data"),e.tid=e.tests[e.active-1].id,e.active=t.getAttribute("data"),e.name=e.tests[e.active-1].name,e.template="MutleInvite.html",e.leftBar="leftBar.html"},e.Report=function(t){e.active=t.getAttribute("data"),e.tid=e.tests[e.active-1].id,e.active=t.getAttribute("data"),e.name=e.tests[e.active-1].name,e.leftBar="leftBar.html",e.template="ReportPage"},e.addKUtest=function(t){e.active=t.getAttribute("data"),e.tid=e.tests[e.active-1].id,e.active=t.getAttribute("data"),e.name=e.tests[e.active-1].name,e.leftBar="leftBar.html",e.template="addQuestion.html"},e.questionss=[[{id:"1",name:"xzt1"},{id:"2",name:"xzt2"},{id:"3",name:"xzt3"},{id:"4",name:"xzt4"}],[{id:"1",name:"bct1"},{id:"2",name:"bct2"},{id:"3",name:"bct3"},{id:"4",name:"bct4"}],[{id:"1",name:"wdt1"},{id:"2",name:"wdt2"},{id:"3",name:"wdt3"},{id:"4",name:"wdt4"}]],e.active=1,e.show=1,e.Qtype=[{name:"选择题",data:"1"},{name:"编程题",data:"2"},{name:"问答题",data:"3"}],e.question=e.questionss[0]}]);OJApp.controller("reportController",["$scope","$http","Data","$routeParams",function(e,t,n,r){function o(e,t){return e.score-t.score}function u(e,t){return e.finishtime-t.finishtime}e.showReport=1,e.ContentUs="page/contentUs.html",e.template="page/testreport.html",e.leftBar="page/testlistleftbar.html";var i=r.state,s=n.tid();e.tname=n.tname(),t({url:WEBROOT+"/report/list",method:"POST",data:{testid:s,state:i}}).success(function(t){e.invites=t,console.log(t)}).error(function(){console.log("get data failed")}),e.getScore=function(e){return e.score+"/"+e.totalScore},e.getState=function(e){if(e.state==0)return"已发送";if(e.state==1)return"进行中";if(e.state==2)return"已完成"},e.isScoreDown=!1,e.reversalScoreSort=function(){e.invites.sort(o),e.isScoreDown&&e.invites.reverse(),e.isScoreDown=!e.isScoreDown},e.isTimeDown=!1,e.reversalTimeSort=function(){e.invites.sort(u),e.isTimeDown&&e.invites.reverse(),e.isTimeDown=!e.isTimeDown},e.viewReport=function(e){n.setTid(e.testid),n.setInviteid(e.iid),n.setTuid(e.uid),window.location.href="#/report/list"}}]),OJApp.controller("reportListController",["$scope","$http","Data","$routeParams",function(e,t,n,r){e.showReport=2,e.listNav=1,e.detailNav=0,e.logNav=0,e.ContentUs="page/contentUs.html",e.template="page/testreport.html",e.leftBar="page/testlistleftbar.html",e.tname=n.tname();var i=n.tid(),s=n.inviteid(),o=n.tuid();e.userInfo=[],e.printPDF=function(){var e=new jsPDF("p","pt","a4");e.addHTML(document.getElementById("pdf"),function(){e.save("report.pdf")})},t({url:WEBROOT+"/report/overall",method:"POST",data:{testid:i,iid:s,uid:o}}).success(function(n){e.score=n.score,e.rank=n.rank,e.user=n.user,e.labels=n.dimension.name,e.data=n.dimension.val,e.setNum=e.labels.length,e.faceproblmes=n.dimension.faceproblem,e.names=n.dimension.name,e.namenums=[],e.showFacePro=[];for(var r=0;r<e.data[0].length;r++){var s={};s.name=e.names[r],s.num=e.data[1][r]/e.data[0][r],s.faceproblem=e.faceproblmes[r],s.num<=.4?s.contents=initialstr[s.name][0]:s.num<=.8?s.contents=initialstr[s.name][1]:s.num<=1&&(s.contents=initialstr[s.name][2]),e.namenums.push(s),e.showFacePro[r]=0}e.levelLabels=n.levelDimension.name,e.levelData=n.levelDimension.val;var o=e.data[0],u=e.data[1];e.descStr=[];for(var r=0;r<o.length;r++){var a=e.labels[r]+":"+u[r]/o[r]*100+"%";e.descStr.push(a)}var f=n.score.split("/");e.labelsScore=["用户成绩","总分"],e.dataScore=[parseInt(f[0]),parseInt(f[1])];var l=n.rank.split("/");e.labelsRank=["用户排名","总人数"],e.dataRank=[parseInt(l[0]),parseInt(l[1])],e.imgs=n.imgs,t({url:WEBROOT+"/testing/getLabels",method:"POST",data:{email:e.user.email,testid:i}}).success(function(t){e.userInfo=t.message})}).error(function(){console.log("get data failed")})}]),OJApp.controller("publicReportListController",["$scope","$http","$routeParams",function(e,t,n){e.showReport=2,e.listNav=1,e.detailNav=0;var r=strDec(n.url,"1","2","3").split("|"),i=r[0],s=r[1],o=r[2];e.userInfo=[],e.printPDF=function(){var e=new jsPDF("p","pt","a4");e.addHTML(document.getElementById("pdf"),function(){e.save("report.pdf")})},t({url:WEBROOT+"/report/overall",method:"POST",data:{testid:s,iid:i,uid:o}}).success(function(n){e.score=n.score,e.rank=n.rank,e.user=n.user,e.labels=n.dimension.name,e.data=n.dimension.val,e.setNum=e.labels.length,e.contents=n.dimension.content,e.faceproblmes=n.dimension.faceproblem,e.names=n.dimension.name,e.namenums=[],e.showFacePro=[];for(var r=0;r<e.data[0].length;r++){var i={};i.name=e.names[r],i.num=e.data[1][r]/e.data[0][r],i.faceproblem=e.faceproblmes[r],e.namenums.push(i),e.showFacePro[r]=0}e.levelLabels=n.levelDimension.name,e.levelData=n.levelDimension.val;var o=e.data[0],u=e.data[1];e.descStr=[];for(var r=0;r<o.length;r++){var a=e.labels[r]+":"+u[r]/o[r]*100+"%";e.descStr.push(a)}var f=n.score.split("/");e.labelsScore=["用户成绩","总分"],e.dataScore=[parseInt(f[0]),parseInt(f[1])];var l=n.rank.split("/");e.labelsRank=["用户排名","总人数"],e.dataRank=[parseInt(l[0]),parseInt(l[1])],e.imgs=n.imgs,t({url:WEBROOT+"/testing/getLabels",method:"POST",data:{email:e.user.email,testid:s}}).success(function(t){e.userInfo=t.message})}).error(function(){console.log("get data failed")})}]),OJApp.controller("reportDetailController",["$scope","$http","Data","$routeParams","$modal",function(e,t,n,r,i){e.showReport=3,e.listNav=0,e.logNav=0,e.detailNav=1,e.ContentUs="page/contentUs.html",e.template="page/testreport.html",e.leftBar="page/testlistleftbar.html";var s=n.tid(),o=n.inviteid(),u=n.tuid();e.tname=n.tname(),t({url:WEBROOT+"/report/detail",method:"POST",data:{testid:s,iid:o,uid:u}}).success(function(t){e.questions=t}).error(function(){console.log("get data failed")}),e.judge=function(t){if(t.type==1)return t.useranswer==t.rightanswer?"正确":"错误";t.type==2},e.viewQuestion=function(r,s,o){if(s.type==1)var u=jQuery.extend(!0,{},s),a=i.open({templateUrl:"page/myModalContent.html",controller:"ModalInstanceCtrl",size:r,resolve:{params:function(){var e={};return e.operation=o.operation,e.title=o.title,e.question=u,e.report=1,e}}});else if(s.type==2){var f={problemid:s.qid,inviteId:n.inviteid()};t({url:WEBROOT+"/report/getprodetail",method:"POST",data:f}).success(function(t){s.answer=t.resultInfos,s.useranswer=t.useranswer,s.language=e.lgs[t.language];var n=i.open({templateUrl:"page/proModalContent.html",controller:"proModalInstanceCtrl",size:r,resolve:{params:function(){var e={};return e.operation=o.operation,e.title=o.title,e.question=s,e.report=1,e}}})}).error(function(){console.log("get data failed")})}else if(s.type==3)var a=i.open({templateUrl:"page/proModalContent.html",controller:"proModalInstanceCtrl",size:r,resolve:{params:function(){var e={};return e.operation=o.operation,e.title=o.title,e.question=s,e.report=1,e}}})},e.lgs={0:"c_cpp",1:"c_cpp",3:"java",9:"csharp"}}]),OJApp.controller("reportLogController",["$scope","$http","Data",function(e,t,n){e.showReport=4,e.listNav=0,e.logNav=1,e.detailNav=0,e.ContentUs="page/contentUs.html",e.template="page/testreport.html",e.leftBar="page/testlistleftbar.html",e.tname=n.tname(),t({url:WEBROOT+"/report/log",method:"POST",data:{inviteid:n.inviteid()}}).success(function(t){for(var n=0;n<t.length;n++){var r=new Date(t[n].time);t[n].year=r.getFullYear(),t[n].month=r.getMonth()+1,t[n].day=r.getDate(),t[n].hour=r.getHours(),t[n].minute=r.getMinutes()}e.logs=t}).error(function(){console.log("get data failed")})}]),OJApp.controller("publicReportListController",["$scope","$http","$routeParams",function(e,t,n){e.showReport=2,e.listNav=1,e.detailNav=0,e.tname=Data.tname();var r=strDec(n.url,"1","2","3").split("|"),i=r[0],s=r[1],o=r[2];e.userInfo=[],e.printPDF=function(){var e=new jsPDF("p","pt","a4");e.addHTML(document.getElementById("pdf"),function(){e.save("report.pdf")})},t({url:WEBROOT+"/report/overall",method:"POST",data:{testid:s,iid:i,uid:o}}).success(function(n){e.score=n.score,e.rank=n.rank,e.user=n.user,e.labels=n.dimension.name,e.data=n.dimension.val,e.setNum=e.labels.length,e.contents=n.dimension.content,e.faceproblmes=n.dimension.faceproblem,e.names=n.dimension.name,e.namenums=[],e.showFacePro=[];for(var r=0;r<e.data[0].length;r++){var i={};i.name=e.names[r],i.num=e.data[1][r]/e.data[0][r],i.faceproblem=e.faceproblmes[r],e.namenums.push(i),e.showFacePro[r]=0}e.levelLabels=n.levelDimension.name,e.levelData=n.levelDimension.val;var o=e.data[0],u=e.data[1];e.descStr=[];for(var r=0;r<o.length;r++){var a=e.labels[r]+":"+u[r]/o[r]*100+"%";e.descStr.push(a)}var f=n.score.split("/");e.labelsScore=["用户成绩","总分"],e.dataScore=[parseInt(f[0]),parseInt(f[1])];var l=n.rank.split("/");e.labelsRank=["用户排名","总人数"],e.dataRank=[parseInt(l[0]),parseInt(l[1])],e.imgs=n.imgs,t({url:WEBROOT+"/testing/getLabels",method:"POST",data:{email:e.user.email,testid:s}}).success(function(t){e.userInfo=t.message})}).error(function(){console.log("get data failed")})}]);OJApp.controller("ModalInstanceCtrl",["$rootScope","$scope","$http","$modalInstance","Data","params",function(e,t,n,r,i,s){t.type=s.type,t.question=s.question,t.operation=s.operation,t.title=s.title,t.report=s.report,t.saveQustion=function(){var s=t.question.answer,o="";for(var u=0;u<s.length;u++)s[u].isright==1||s[u].isright=="true"?o+=1:o+=0;t.question.rightanswer=o;var a={quizid:t.tid,user:{uid:i.uid()},question:t.question};console.log("question..........",t.question),n({url:WEBROOT+"/question/add",method:"POST",headers:{Authorization:i.token()},data:a}).success(function(n){console.log("更新试题....."),e.$broadcast("questionModify",t.question)}).error(function(e){console.log("获取数据错误")}),r.dismiss("cancel")},t.cancel=function(){r.dismiss("cancel")}}]);"use strict";OJApp.controller("testingController",["$scope","$http","Data","$routeParams","$timeout","$sce","$compile","$interval",function(e,t,n,r,i,s,o,u){var a=strDec(r.url,"1","2","3").split("|");e.email=a[0],e.tid=a[1];var f;e.tuser={},e.loginUser={},e.schools=[],e.question={},e.programCode={},e.answerCount={total:0,sum:0},e.time={},e.time.remain=1,e.monitor=1,e.quiz={},e.btnShow=1,e.btn={},e.btn.Show=1,e.btnZone=0,e.showCamera=1,e.showCZone=1,e.showPanel=1,e.pictureOK=0,e.openCamera=0,e.isCameraOk={},e.isCameraOk.ok=0,e.userInfo=[],t({url:WEBROOT+"/testing/checkurl",method:"POST",data:{email:e.email,testid:e.tid}}).success(function(t){t.state==0?t.message==1?e.show=5:flashTip(t.message):t.state==2?e.show=6:t.state==3?e.show=7:e.show=1}).error(function(){console.log("get data failed")}),e.takePicture=function(){e.$broadcast("takePicture"),e.btn.Show=2,e.monitor=2},e.updatePicture=function(){smoke.confirm("你确定要提交该照片？提交后不可修改！",function(t){t&&(e.$apply(function(){e.btn.Show=3}),e.$broadcast("updatePicture","1"))},{ok:"是",cancel:"否",classname:"custom-class",reverseButtons:!0})},e.$on("baseImgSave",function(){e.pictureOK=1}),e.$on("baseImgRecapture",function(){smoke.alert("照片不清晰，人脸无法识别，请重新拍摄清晰的照片"),e.$apply(function(){e.cancelPicture()})}),e.cancelPicture=function(){e.btn.Show=1,e.monitor=1},e.showVideo=function(){e.showCZone=2,e.$broadcast("takeVideo")},e.$on("cameraErr",function(){console.log("show camera")}),e.randomTakePicture=function(t){var n=1,r=n*60;console.log("intervalTime="+r),u(function(){var t=Math.floor(Math.random()*r);console.log("randomTime="+t),i(function(){console.log("take picture"),e.$broadcast("takePicture"),e.$broadcast("updatePicture","0")},t*1e3)},r*1e3)},e.btnZone={},e.btnZone.hide=0,e.cameraZone={},e.cameraZone.show=0,e.$on("cameraOK",function(){if(e.cameraAgain=="again")return e.startTest(),!1;e.$apply(function(){e.isCameraOk.ok=1,e.btnZone.hide=1,e.cameraZone.show=1}),console.log("cameraOk")}),e.$on("video",function(){e.showVideo()}),e.cPanel={},e.login=function(){t({url:WEBROOT+"/testing/checkpwd",method:"POST",data:{email:e.email,pwd:e.loginUser.pwd,testid:e.tid}}).success(function(n){if(n.state==0){if(n.message!=1)return n.message==2?(flashTip("用户名、密码不匹配"),!1):(flashTip("用户不存在"),!1);e.show=5}else n.state==2?(e.invitedid=n.message.invitedid,e.openCamera=n.message.openCamera,e.errMsg="",e.openCamera==1&&(e.showCZone=3),e.show=2,t({url:WEBROOT+"/testing/getLabels",method:"POST",data:{email:e.email,testid:e.tid}}).success(function(t){e.userInfo=t.message,e.userInfo.length==0&&(e.openCamera==1||e.openCamera==2)&&(e.show=3)})):(flashTip("务必开启摄像头已开始考试"),e.$broadcast("takeVideo"),e.invitedid=n.message[0].inviteId,console.log("inviteid.......",e.invitedid),e.cameraAgain="again")}).error(function(){console.log("login failed")})},e.changeClass=function(e){var t=e.methods.widget();t.removeClass("ui-menu ui-corner-all ui-widget-content").addClass("dropdown-menu")},e.schoolOption={options:{html:!0,minLength:1,onlySelect:!0,outHeight:20,source:function(t,n){e.schools.length||e.schools.push({label:"未发现",value:null}),n(e.schools)}}},e.submitUserInfo=function(){if(e.pictureOK!=1&&(e.openCamera==0||e.openCamera==2))return smoke.alert("请先拍照"),!1;for(var n in e.userInfo)if(e.userInfo[n].value=="")return e.errMsg="输入不得为空",!1;var r={email:e.email,testid:e.tid,userInfo:e.userInfo};t({url:WEBROOT+"/testing/submituserinfo",method:"POST",data:r}).success(function(t){t.state==0?e.errMsg="错误":(e.show=3,e.testInfo=t.message)}).error(function(){console.log("login failed")})},e.genExtraInfo=function(t){e.answerCount.total=e.tProblems.length;for(var n=0;n<e.tProblems.length;n++)typeof e.tProblems[n].useranswer!=null&&e.tProblems[n].useranswer!=""&&e.tProblems[n].useranswer!="0000"&&e.tProblems[n].useranswer!="00000"&&e.answerCount.sum++;var r=t.message.invite.begintime;r=(new Date(r.replace(/\-/g,"/"))).getTime();var s=t.message.invite.duration*60*1e3;e.time.remain=r+s,e.$broadcast("countdown",e.time.remain);var o=(new Date).getTime(),u=e.time.remain-o;e.randomTakePicture(u/60/1e3),i(e.endTest,u)},e.stop=function(){flashTip("测试已结束"),e.show=5},e.startTest=function(){var n={email:e.email,testid:e.tid};t({url:WEBROOT+"/testing/starttest",method:"POST",data:n}).success(function(t){if(t.state==0)return e.show=5,!1;if(t.state!=0){e.tProblems=t.message.problems,e.submitAndFetch(e.tProblems[0],1),e.genExtraInfo(t),e.show=4,e.sumArry=[];for(var n=0;n<e.tProblems.length;n++)e.tProblems[n].useranswer!=""&&e.tProblems[n].useranswer!="0000"?e.sumArry[n]=1:e.sumArry[n]=0;var r=t.message.invite.duration*60*1e3}else t.message==1?e.show=5:alert(t.message)}).error(function(){console.log("login failed")})},e.intervalTakePicture=function(){u(function(){e.$broadcast("takePicture"),e.$broadcast("updatePicture","0")},3e4)},e.submitAndFetch=function(n,r){var i="";if(e.question.type==1){if(typeof e.question.answer!="undefined")for(var s in e.question.answer)e.question.answer[s].isright==1?i+=1:i+=0}else e.question.type==3&&(i=e.question.useranswer);var o={testid:e.tid,email:e.email,nowProblemId:n.problemid,problemid:e.question.qid,useranswer:i,index:r};t({url:WEBROOT+"/testing/submit",method:"POST",data:o}).success(function(t){if(t.state==0)return e.show=5,!1;t.message.type==1?e.questionType=1:t.message.type==2?e.questionType=2:t.message.type==3&&(e.questionType=3),e.question=t.message}).error(function(){console.log("login failed")})},e.fetchProblem=function(n,r){console.log("index.............",r);var i={testid:e.tid,email:e.email,problemId:n.problemid,index:r+1};t({url:WEBROOT+"/testing/fetchProblem",method:"POST",data:i}).success(function(t){if(t.state==0)return e.show=5,!1;t.message.type==1?e.questionType=1:t.message.type==2?e.questionType=2:t.message.type==3&&(e.questionType=3),e.question=t.message}).error(function(){console.log("login failed")})},e.getNext=function(t){var n=0;for(var r=0;r<e.tProblems.length;r++)if(e.tProblems[r].problemid==t.qid){n=r+1,e.sumArry[r]==0&&(e.sumArry[r]=1,e.answerCount.sum++,e.$broadcast("adddot",n));break}n<e.tProblems.length?e.submitAndFetch(e.tProblems[n],n+1):(e.submitAndFetch(e.tProblems[n-1],n+1),flashTip("以至最后一题，请仔细检查"))},e.run=function(n){var r={};n=="test"?r.submit=0:n=="submit"&&(r.submit=1),r.problem_id=e.question.qid,r.language=e.lg.context.lan,e.queryNum=5,r.email=e.email,r.testid=e.tid,r.solution=e.programCode.context,t({url:WEBROOT+"/solution/run",method:"POST",data:r}).success(function(t){if(e.state==0)return e.show=5,!1;e.state="success",e.solution_id=t.message.msg,i(e.query,2e3),e.RESULT=s.trustAsHtml(e.result)}).error(function(){e.state="Try again",e.result="fail"})},e.query=function(){var n=new Object;n.solution_id=e.solution_id,--e.queryNum,t({url:WEBROOT+"/solution/query",method:"POST",data:n}).success(function(t){var n;if(t.message.length==0&&e.queryNum>0)n=i(e.query,2e3);else{i.cancel(n),e.result={},e.result.content="";var r=t.message;r.length==1&&(e.result.content=r[0].test_case_result);for(var o=0;o<r.length;o++)e.result.content+="测试用例"+o+":期望输出:"+r[o].testCaseExpected+";实际输出:"+r[o].test_case_result+"\n";e.result.display=s.trustAsHtml(e.result.content)}}).error(function(){e.result.content+="<br>Try again"})},e.finishTest=function(){smoke.confirm("你确定完成测试吗？",function(t){t&&(e.run("submit"),e.endTest())},{ok:"是",cancel:"否",reverseButtons:!0})},e.endTest=function(){var n={email:e.email,testid:e.tid};t({url:WEBROOT+"/testing/finishtest",method:"POST",data:n}).success(function(t){t.state==0?e.show=5:alert(t.message)}).error(function(){})},e.lgs=[{name:"C",demo:"resource/static/c.c",CodeType:"c_cpp",lan:0},{name:"C++",demo:"resource/static/cpp.cpp",CodeType:"c_cpp",lan:1},{name:"Java",demo:"resource/static/java.java",CodeType:"java",lan:3},{name:"php",demo:"resource/static/php.php",CodeType:"php",lan:7}],e.lg={},e.lg.context=e.lgs[0];var l={C:"#include <stdio.h>\r\n int main(){\r\n 	return 0;\r\n}","C++":"using namespace std; \r\n #include <iostream>\r\n int main(){\r\n 	return 0;\r\n}",Java:"public class Solution {\r\n    public static void main(String[] args) {\r\n    }\r\n}",php:"<?php \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n   ?>","C#":'public void Solution() {\r\n    Console.WriteLine("Hello World");\r\n}'};e.programCode.context=l.C,e.$watch("lg.context",function(){e.programCode.context=l[e.lg.context.name]})}]),OJApp.controller("pagCtrl",["$scope",function(e){e.totalItems=41}]);OJApp.controller("InnerTest",["$scope","$http","Data","$modal",function(e,t,n,r){e.url="#/innertest",e.active=1,e.template="page/innerTest.html",e.ContentUs="page/contentUs.html",e.leftBar="page/testsleftbar.html",e.addtest={},e.addtest.user={},e.addtest.testtime=70,e.panel={},e.panel.isShow=!0,e.panel.isGuide=!1,e.panel.body=1,e.panel.isBack=!1,e.panel.trace=[],e.test={},e.test.isNewTest=!1,e.guide={},e.guide.show=1,e.guideTxt={},e.guideTxt.webDevelope="web开发即网站开发，从技术上分为前端和后端，前端为展示给用户的界面，后端为业务逻辑，用于处理业务动作。前端的技术包括HTML，Javascript等；后端需掌握包括Java，Php，数据库，Linux等技术",e.guideTxt.webBase="web后台功能主要是响应用户的访问，为用户提供网络服务，一般使用Java、PHP等技术。此外，还必须还必须掌握必要的框架，比如spring，thinkphp等等。为了操作数据库还需掌握数据库知识，如果没有专业的运维人员，还需掌握Linux等技术",e.guideTxt.IOS="这里的IOS开发指APP前台开发，后台开发与网站后台开发相同。IOS开发一般采用Object_C,苹果公司现已推出了最新的开发语言Swift，同时，目前也流行采取开发网页的形式，然后通过第三方工具将网页封装成IOS应用，因为网页同时也可以封装成Android应用，所以这种方式正越来越流行",e.guideTxt.Android="Android开发一般采用java语言，采用google提供的Android API。但目前也流行采取开发网页的形式，然后通过第三方工具将网页封装成Android应用，因为网页同时也可以封装成IOS应用，所以这种方式正越来越流行",e.guideArray={webFront:"前端介绍： 最新流行的热门职业。需要具备良好的沟通能力，需要与产品经理、UI设计师、项目经理、最终用户的沟通。传统意义上的前端开发需掌握HTML, Css, Javascript, Jquery。而随着移动端网页封装开发及angularjs等MVC框架的兴起，前端开发正处于越来越重要的位置。需掌握的基本技能包括html,css,javascript。以及一些javascript类库，包括jQuery， Anuglarjs等等。",java:"java服务端工程师需掌握java，spring,Linux,数据库等技能",php:"php服务端工程师不仅需掌握PHP语言，还必须掌握thinkphp，linux，数据库等知识",allStack:"Full Stack developer：是指掌握多种技能，并能利用多种技能独立完成产品的人。互联网项目，需要用到后端开发、前端开发、界面设计、产品设计、数据库、各种移动客户端、三屏兼容、restFul API设计和OAuth等等，比较前卫的项目，还会用到Single Page Application、Web Socket、HTML5/CSS3这些技术以及像第三方开发像微信公众号微博应用等等",object_c:"	",android:"Android的原生开发语言，主要使用google的API"},e.showpage=1,e.genQuiz=function(e){loadingTip(),t({url:WEBROOT+"/test/genquiz",method:"POST",headers:{Authorization:n.token()},data:{quizName:e}}).success(function(e){removeTip(),window.location.href="#/test"}).error(function(e){console.log("genQuizFailed")})},e.viewInnQuiz=function(r){e.name=r,console.log("data........",r),e.showpage=2,t({url:WEBROOT+"/test/gettemp",method:"POST",headers:{Authorization:n.token()},data:{quizName:r}}).success(function(t){if(t.state!=0)return smoke.alert(t.message),!1;e.getTest(t.message)})},e.displayQuestionDetails=function(t){for(i in e.qs)e.isDisplay[i]=!1;e.isDisplay[t]=!0},e.hideQuestionDetails=function(t){e.isDisplay[t]=!1},e.getTest=function(r){if(r==0)return smoke.alert("quiz不得为空"),!1;var s=new Object;s.user=new Object,s.user.uid=n.uid(),s.quizid=r,t({url:WEBROOT+"/test/manage",method:"POST",headers:{Authorization:n.token()},data:s}).success(function(t){e.state=t.state,e.message=t.message,console.log(e.message);if(e.state){e.qs=e.message.qs,e.isDisplay=new Array(e.qs.length);for(i in e.isDisplay)e.isDisplay[i]=!1;e.testtime=e.message.testtime,e.extraInfo=e.message.extraInfo,e.emails=e.message.emails,e.name=e.message.name}}).error(function(e){flashTip("获取数据错误")})},e.tshow=function(){t({url:WEBROOT+"/test/show",method:"POST",headers:{Authorization:n.token()},data:{uid:n.uid()}}).success(function(t){e.state=t.state,e.message=t.message;if(e.state){e.tests=e.message.tests;for(var n=0;n<e.tests.length;n++)e.tests[n].data=n;console.log(e.tests)}}).error(function(e){console.log("服务器错误")})},e.tshow(),e.getType=function(e){return e==1?"选择题":e==2?"编程题":e==3?"简答题":"no"},e.goBack=function(){e.showpage=1}}]);OJApp.controller("leftBarController",["$scope","Data",function(e,t){e.$watch("Data.tname()",function(){e.tname=t.tname()}),e.tid=t.tid();var n=window.location.hash;if(n=="#/test")e.isTestActive=!0;else if(n=="#/innertest")e.isInnertestActive=!0;else if(n=="#/mybank")e.isMybankActive=!0;else if(n="#bank")e.isBankActive=!0;e.lBar={},e.showQuestions=function(){e.question=!0,console.log("tid............",t.tid()),window.location.href="#/test/"+t.tid()},e.commonSet=function(){e.set=!0,window.location.href="#/testConfig"},e.invited=function(t){t==1?e.lBar.state1=!0:t==2?e.lBar.state2=!0:t==3&&(e.lBar.state3=!0),window.location.href="#/report/show/"+t}}]);OJApp.controller("adminController",["$scope","$http","upload",function(e,t,n){e.showImport=!1,e.showImportForm=function(){e.showImport=!0},e.onSuccess=function(e){e.state==0?flashTip(e.msg):flashTip("恭喜你，导入成功")}}]);OJApp.controller("testConfig",["$scope","$http","Data","$modal",function(e,t,n,r){e.url="#/testConfig",e.active=1,e.template="page/testconfig.html",e.ContentUs="page/contentUs.html",e.leftBar="page/testlistleftbar.html",e.defaultTags=[],e.customTags=[],e.tid=n.tid(),e.labels=[],e.emails=[],e.angmodel=[],e.angmodel.labeladded="",e.angmodel.emailadded="",e.name=n.tname(),e.updateTestLabels=function(){t({url:WEBROOT+"/label/getlabels",method:"POST",data:{testid:e.tid}}).success(function(t){e.labels=t.message}).error(function(){console.log("get data failed")})},e.orseclected=function(e){return e==1?!0:!1},e.setStyle=function(t){if(e.orseclected(t)==0)return console.log(t),"btn btn-info btn-xs dropdown-toggle";if(e.orseclected(t)==1)return"btn  btn-xs disabled "},e.updateQuizEmails=function(){t({url:WEBROOT+"/quizemail/getemails",method:"POST",data:{testid:e.tid}}).success(function(t){e.emails=t.message}).error(function(){console.log("get data failed")})},e.updateTestLabels(),e.updateQuizEmails(),e.saveConfig=function(){t({url:WEBROOT+"/label/saveconfig",method:"POST",data:{testid:e.tid,labels:e.labels}}).success(function(e){}).error(function(){console.log("get data failed")})},e.istype=function(e){return e.labeltype==0?!0:!1},e.deleteLable=function(n){t({url:WEBROOT+"/label/deletelable",method:"POST",data:{testid:e.tid,labelname:n.labelname}}).success(function(e){}).error(function(){console.log("get data failed")})},e.saveConfigOne=function(t,n){n==1?(t.isSelected=!0,e.saveConfig()):(t.isSelected=!1,e.deleteLable(t),e.saveConfig())},e.addLabel=function(){t({url:WEBROOT+"/label/addlabel",method:"POST",data:{testid:e.tid,label:e.angmodel.labeladded}}).success(function(t){flashTip("添加成功"),e.updateTestLabels(),e.angmodel.labeladded=""}).error(function(){console.log("get data failed")})},e.addEmail=function(){t({url:WEBROOT+"/quizemail/addemail",method:"POST",data:{testid:e.tid,email:e.angmodel.emailadded}}).success(function(t){t.state==1?(flashTip("添加成功"),e.updateQuizEmails(),e.angmodel.emailadded=""):(e.angmodel.emailadded="",flashTip(t.message))}).error(function(){console.log("get data failed")})}}]);OJApp.controller("contactController",["$scope","$http","Data",function(e,t,n){e.tname=n.tname(),e.suggest={},e.contact={},e.contact.show=1,e.addSuggest=function(){e.suggest.uid=n.uid(),t({url:WEBROOT+"/suggest/add",method:"POST",headers:{Authorization:n.token()},data:e.suggest}).success(function(t){flashTip("感谢您宝贵的建议!"),e.contact.show=1}).error(function(e){flashTip("获取数据错误")})}}]);OJApp.controller("proModalInstanceCtrl",["$scope","$http","$modalInstance","Data","params",function(e,t,n,r,i){e.question=i.question,e.operation=i.operation,e.title=i.title,e.report=i.report,console.log("question......",e.question),e.cancel=function(){n.dismiss("cancel")}}]);OJApp.controller("guideModalCtrl",["$scope","$http","modalInstance","Data","params",function(e,t,n,r,i){e.title=i.title,e.content=i.content,e.data=i.data,e.genQuiz=function(){t({url:WEBROOT+"/test/genquiz",method:"POST",headers:{Authorization:r.token()},data:{quizName:e.data}}).success(function(e){flashTip("创建测试成功"),location.reload()}).error(function(e){console.log("genQuizFailed")})},e.cancel=function(){n.dismiss("cancel")}}]);OJApp.controller("pInfo",["$scope","$http","Data",function(e,t,n){e.url="#/profile",e.template="page/profile.html",e.ContentUs="page/contentUs.html",e.leftBar="page/testsleftbar.html",e.user={},e.tempUser={},e.user.company="",e.user.name="",e.user.tel="",e.assist=0,e.pwd={},e.pwd.show=0,e.getInfo=function(){t({url:WEBROOT+"/user/setting/query",method:"POST",headers:{Authorization:n.token()},data:{uid:n.uid()}}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.user=e.message,n.setCompany(e.user.company),n.setName(e.user.name),n.setTel(e.user.tel),n.setEmail(e.user.email))}).error(function(e){console.log("获取用户信息错误")})},e.getInfo(),e.modifyProfile=function(){e.assist=1,e.tempUser.name=e.user.name,e.tempUser.company=e.user.company,e.tempUser.tel=e.user.tel},e.saveProfile=function(r,i,s,o,u){e.name=r,e.company=i,e.tel=s,t({url:WEBROOT+"/user/setting/set",method:"POST",headers:{Authorization:n.token()},data:{uid:n.uid(),company:e.tempUser.company,tel:e.tempUser.tel}}).success(function(t){e.state=t.state,e.state&&(e.user=t.message,e.assist=0)}).error(function(e){})},e.cancelProfile=function(){e.assist=0,e.tempUser={}},e.modifyPwd=function(){t({url:WEBROOT+"/user/setting/setpwd",method:"POST",headers:{Authorization:n.token()},data:{uid:n.uid(),oldPwd:md5(e.pwd.old),newPwd:md5(e.pwd.now)}}).success(function(t){e.state=t.state,e.state?(e.pwd.show=0,flashTip("修改成功"),e.pwd.old="",e.pwd.now=""):flashTip("密码错误")}).error(function(e){}),e.renewpasswd?e.newPWD=md5(e.newpwd):e.newPWD=md5(e.pwd),e.PWD=md5(e.pwd)}}]);OJApp.controller("loginCtrl",["$scope","$http","Data",function(e,t,n){e.errorMsg={},e.verifyQtn={},e.mdLogin=function(){var e="https://api.mingdao.com/oauth2/authorize?app_key=EB56F580B240&redirect_uri="+MD_REDIRECT;window.location.href=e},e.confirm=function(r){if(e.Lemail&&e.Lpwd){if(r==1)var i=md5(e.Lpwd);else var i=e.Lpwd;t({url:WEBROOT+"/user/confirm",method:"POST",headers:{Authorization:n.token()},data:{email:e.Lemail,pwd:i,name:e.Lname}}).success(function(t){console.log("success"),e.state=t.state,n.clear();var r=e.Lemail;e.message=t.message,t["message"].handler_url!=null&&t.message.handler_url!==""&&(r=t.message.handler_url),n.setName(r),n.setEmail(e.Lemail),e.state?(n.setToken(t.token),n.setUid(e.message.uid),n.setPrivi(e.message.privilege),n.setTel(e.message.tel),n.setCompany(e.message.company),n.setInvitedleft(e.message.invited_left),n.setLastActive((new Date).getTime()),e.invitedleft=e.message.invited_left,window.location.href="#/loginok"):e.errmsg=t.message.msg}).error(function(){console.log("err")})}}}]);OJApp.controller("signupCtrl",["$scope","$http","Data",function(e,t,n){e.Remail,e.company,e.errorMsg={},e.verifyQtn={},e.$on("mobileError",function(t,n){e.$apply(function(){e.errorMsg.mobile=n})}),e.$on("vertifycode",function(t,n){e.$apply(function(){e.verifyQtn.answer=n})}),e.mdLogin=function(){var e="https://api.mingdao.com/oauth2/authorize?app_key=EB56F580B240&redirect_uri="+MD_REDIRECT;window.location.href=e},e.addhr=function(){if(e.Remail&&e.Rpwd&&e.Rrepwd&&e.verifyAns)if(e.Rpwd==e.Rrepwd)if(e.verifyAns==e.verifyQtn.answer){var r=/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!r.test(e.Remail))return e.errorEmail="请输入正确的email格式",!1;var i=e.Remail.split("@")[1],s=["126.com","163.com","sina.com","21cn.com","sohu.com","yahoo.com.cn","yahoo.com","tom.com","qq.com","etang.com","eyou.com","56.com","x.cn","chinaren.com","sogou.com","citiz.com","hotmail.com","msn.com","gmail.com","aim.com","aol.com","mail.com","walla.com","inbox.com","live.com","googlemail.com","ask.com","163.net","263.net","3721.net","yeah.net","aliyun.com"];if($.inArray(i,s)>-1)return e.errorEmail="请使用公司邮箱注册！",!1;t({url:WEBROOT+"/user/add/hr",method:"POST",headers:{Authorization:n.token()},data:{email:e.Remail,pwd:md5(e.Rpwd),name:e.name,company:e.company,tel:e.mobile}}).success(function(t){e.state=t.state,e.message=t.message,e.state?(n.setUid(e.message.uid),n.setToken(t.token),n.setPrivi(e.message.privilege),n.setTel(e.message.tel),n.setCompany(e.message.company),n.setInvitedleft(e.message.invited_left),n.setName(e.message.email),n.setEmail(e.message.email),window.location.href="#/test"):(alert(e.message.msg),window.location.reload(!0))}).error(function(){alert("网络错误"),window.location.reload(!0)})}else e.errorMsg.general="验证问题答案错误";else e.errorMsg.general="密码不相同";else e.errorMsg.general="所有选项均不可为空"}}]);OJApp.controller("findCadPwdCtrl",["$scope","$http","CadData","$routeParams","$window",function(e,t,n,r,i){e.refreshQuestion=function(){t({url:WEBROOT+"/user/getVerifyQtn",method:"POST"}).success(function(t){e.content=t.message})},e.refreshQuestion(),e.request=function(){e.email&&e.answer?t({url:WEBROOT+"/cad/setting/resetpwdapply",method:"POST",data:{email:e.email,content:e.content,answer:e.answer}}).success(function(t){if(t.state!=0)return e.errmsg=t.message,!1;e.errmsg="已向您邮箱发送重置密码信息",e.refreshQuestion(),e.isMessage=1}):e.errmsg="输入均不得为空"},e.submit=function(){if(typeof e.pwd=="undefined"||typeof e.confirmpwd=="undefined"||e.pwd==""||e.confirmpwd=="")return e.errmsg="输入不得为空",e.errmsg="输入不得为空",!1;if(e.pwd!=e.confirmpwd)return e.errmsg="两次密码不同",!1;var n=md5(e.pwd),r=md5(e.confirmpwd);t({url:WEBROOT+"/cad/setting/resetpwd",method:"POST",data:{email:e.email,pwd:n,confirmpwd:r}}).success(function(t){t.state==0?(e.errmsg="重置密码成功",e.successStage=1,e.submitStage=0):e.errmsg=t.message}).error(function(){e.errmsg="重置密码失败"})},e.checkUrl=function(){t({url:WEBROOT+"/cad/setting/checkurl",method:"POST",data:{url:r.auth}}).success(function(t){e.email=t.message,e.requestStage=0,e.submitStage=1}).error(function(t){e.requestStage=0,e.submitStage=1,e.errmsg="链接地址无效"})},e.isMessage=0,e.successStage==0,r.auth?e.checkUrl():(e.requestStage=1,e.submitStage=0)}]);OJApp.controller("oauthorController",["$scope","$http","Data","$routeParams",function(e,t,n,r){e.template="page/oauthor.html",e.ContentUs="",e.leftBar="",e.errorMsg={},e.verifyQtn={},console.log("title",r.title),e.title=r.title,e.name=n.name(),e.Remail=n.email(),e.company=n.company(),e.mdUid=n.mdUid(),e.$on("mobileError",function(t,n){e.$apply(function(){e.errorMsg.mobile=n})}),e.$on("vertifycode",function(t,n){e.$apply(function(){e.verifyQtn.answer=n})}),e.addhr=function(){e.Rpwd&&e.verifyAns&&e.mobile?e.verifyAns==e.verifyQtn.answer?t({url:WEBROOT+"/user/add/hr",method:"POST",headers:{Authorization:n.token()},data:{email:e.Remail,pwd:md5(e.Rpwd),name:e.name,company:e.company,tel:e.mobile,mdUid:e.mdUid}}).success(function(t){e.state=t.state,e.message=t.message,e.state?(n.setUid(e.message.uid),n.setToken(t.token),n.setPrivi(e.message.privilege),n.setTel(e.message.tel),n.setCompany(e.message.company),n.setInvitedleft(e.message.invited_left),n.setName(e.message.email),window.location.href="#/test"):(alert(e.message.msg),window.location.reload(!0))}).error(function(){alert("网络错误"),window.location.reload(!0)}):e.errorMsg.general="验证问题答案错误":e.errorMsg.general="选项均不可为空"},e.cancel=function(){window.location.href="http://foolrank.com"}}]);OJApp.controller("videoInstanceCtrl",["$scope","modalInstance",function(e,t){e.videoplay=0,e.cancel=function(){t.dismiss("cancel")}}]);OJApp.controller("viewtempCtrl",["$scope","$http","$modalInstance","Data","params",function(e,t,n,r,s){e.quizName=s.quizName,t({url:WEBROOT+"/test/gettemp",method:"POST",headers:{Authorization:r.token()},data:{quizName:e.quizName}}).success(function(t){if(t.state!=0)return smoke.alert(t.message),!1;e.testManage(t.message)}),e.getTypeName=function(e){return e==1?"选择题":e==2?"编程题":e==3?"简答题":"no"},e.displayQuestionDetails=function(t){for(i in e.qs)e.isDisplay[i]=!1;e.isDisplay[t]=!0},e.hideQuestionDetails=function(t){e.isDisplay[t]=!1},e.testManage=function(n){if(n==0)return smoke.alert("quiz不得为空"),!1;var s=new Object;s.user=new Object,s.user.uid=r.uid(),s.quizid=n,t({url:WEBROOT+"/test/manage",method:"POST",headers:{Authorization:r.token()},data:s}).success(function(t){e.state=t.state,e.message=t.message;if(e.state){e.qs=e.message.qs,e.isDisplay=new Array(e.qs.length);for(i in e.isDisplay)e.isDisplay[i]=!1;e.testtime=e.message.testtime,e.extraInfo=e.message.extraInfo,e.emails=e.message.emails,e.name=e.message.name}}).error(function(e){flashTip("获取数据错误")}),e.template="page/testlist.html",e.myu=1},e.cancel=function(){n.dismiss("cancel")}}]);$(window).load(function(){function e(){var e=document.getElementsByClassName("main-block2"),t=document.getElementsByClassName("main-block3-img");for(var n=0;n<e.length;n++)e[n].style.height="auto",e[n].offsetHeight>t[n].offsetHeight?t[n].style.height=e[n].offsetHeight+"px":e[n].style.height=t[n].offsetHeight+"px"}window.setInterval(function(){e()},1e3),e(),window.onresize=function(){e()}});OJApp.controller("cadLoginController",["$scope","$http","CadData",function(e,t,n){e.tuser={},e.rembme=n.getRembme();if(e.rembme){var r=n.getEmail();r!=null&&(window.location.href="#/dp/testmain")}e.$watch("rembme",function(){e.rembme?n.setRembme(!0):n.setRembme(!1)}),e.$on("vertifycode",function(t,n){e.$apply(function(){e.verifyCode=n})}),e.$on("mobileError",function(t,n){e.$apply(function(){e.errmsg=n})}),e.preRegister=function(){if(!e.tuser.email||!e.tuser.pwd||!e.mobile||!e.verifyAns)return e.errmsg="输入皆不可为空",!1;e.tuser.tel=e.mobile;var r=jQuery.extend(!0,{},e.tuser);r.pwd=md5(e.tuser.pwd),t({url:WEBROOT+"/cad/preregister",method:"POST",data:r}).success(function(t){t.state!=0?e.errmsg=t.message:(n.setEmail(t.message),window.location.href="#/dp/register2")}).error(function(){console.log("get data failed")})},e.degrees=[{id:0,name:"大专"},{id:1,name:"本科"},{id:2,name:"硕士研究生"},{id:3,name:"博士研究生"}],e.gratimes=[{id:0,time:"2014"},{id:1,time:"2015"},{id:2,time:"2016"},{id:3,time:"2017"}],e.tuser.degree="本科",e.tuser.gratime="2016",e.register=function(){if(!e.tuser.username||!e.tuser.school||!e.tuser.discipline||!e.tuser.degree||!e.tuser.gratime)return e.errmsg="输入皆不可为空",!1;e.tuser.email=n.getEmail(),t({url:WEBROOT+"/cad/register",method:"POST",headers:{Authorization:n.getToken()},data:e.tuser}).success(function(t){t.state!=0?e.errmsg=t.message:(n.setEmail(t.message),window.location.href="#/dp/testmain")}).error(function(){console.log("get data failed")})},e.login=function(){if(typeof e.cad=="undefined"||typeof e.cad.email=="undefined"||typeof e.cad.pwd=="undefined"||!e.cad.email||!e.cad.pwd)return e.errmsg="输入皆不可为空",!1;e.cad.pwd=md5(e.cad.pwd),t({url:WEBROOT+"/cad/login",method:"POST",headers:{Authorization:n.getToken()},data:e.cad}).success(function(t){t.state!=0?e.errmsg=t.message:t.state==4?(n.setEmail(t.message),window.location.href="#/dp/register2"):(n.setToken(t.message.token),n.setEmail(t.message.email),window.location.href="#/dp/testmain")}).error(function(){console.log("get data failed")})}}]);OJApp.controller("testMainController",["$scope","$http","CadData","$location",function(e,t,n,r){e.showtext=0,e.email=n.getEmail();if(e.email==""||typeof e.email=="undefined"||e.email==null)window.location.href="#/dp";t({url:WEBROOT+"/cadquiz/getlevel",method:"POST",data:{email:n.getEmail()}}).success(function(t){e.level=t.message}),e.cadInfo={},e.openTest=function(r,i){if(e.level<i)return i==2?smoke.alert("想挑战我？请积分超过300分后再来哦～"):i==3&&smoke.alert("想跟我玩？继续玩小红小白，凑够500分再来"),!1;t({url:WEBROOT+"/cadquiz/gettest",method:"POST",data:{testname:r}}).success(function(e){if(e.state!=0)return smoke.alert(e.message),!1;n.setTestid(e.message),n.setTestname(r),window.location.href="#/dp/testdetail"})},e.logout=function(){n.clear(),window.location.href="#/dp"}}]),OJApp.controller("testDetailController",["$scope","$http","CadData","$location",function(e,t,n,r){e.email=n.getEmail();if(e.email==""||typeof e.email=="undefined"||e.email==null)window.location.href="#/dp";e.testname=n.getTestname(),e.testsrc="resource/static/"+e.testname+".png",e.testdes="在"+e.testname+"中",t({url:WEBROOT+"/cadquiz/preparetest",method:"POST",data:{testid:n.getTestid(),email:n.getEmail()}}).success(function(n){if(n.state==101)smoke.alert(n.message),window.location.href="#/dp/testmain";else if(n.state!=0)e.errmsg=n.message;else{var r=n.message.percent;e.percent=r,e.cads=n.message.cads,e.state=n.message.state,r>=90?e.slogan="我伙呆！您打败了全国"+r+"%的挑战者，你还是人类吗？":r>=70&&r<90?e.slogan="您打败了全国"+r+"％的挑战者，你这么NB，你的小伙伴们造吗！":r>=50&&r<69?e.slogan="您打败了全国"+r+"%的挑战者，何弃疗！药不能停！再接再厉！":r==0?e.slogan="您还未开始做题，来！证明你自己！":e.slogan="您打败了全国"+r+"％的挑战者，蛋白质肯定不是你，快让我们见识你的实力！",t({url:WEBROOT+"/user/wxjsk/config",method:"POST",data:{url:"http://foolrank.com/"}}).success(function(e){wxdata=e.message,wx.config({debug:!1,appId:wxdata.wxappid,timestamp:wxdata.timestamp,nonceStr:wxdata.nonceStr,signature:wxdata.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]})});var i={imgUrl:"http://foolrank.com/resource/static/dpgeek.jpg",link:"http://evt.dianping.com/event/campus15/",title:"我在点评挑战赛中打败了"+e.percent+"%的好友，你还不快来！",desc:"战斗的大幕已经拉开，年轻的Geek们，是时候展现真正的技术了。我们期待你披荆斩棘，创造奇迹！",type:"link"};wx.ready(function(){wx.onMenuShareTimeline({title:i.title,link:i.link,imgUrl:i.imgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,type:i.type,dataUrl:"",success:function(){},error:function(){}}),wx.onMenuShareQQ({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,success:function(){},error:function(){}}),wx.onMenuShareWeibo({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,success:function(){},error:function(){}})})}}).error(function(){console.log("get data failed")}),e.startTest=function(){if(e.state==1)return smoke.alert("太牛＊了，题库已被你虐残了！换个题库玩玩吧！"),!1;window.location.href="#/dp/cadtesting"}}]),OJApp.controller("profileController",["$scope","$http","CadData",function(e,t,n){e.email=n.getEmail();if(e.email==""||typeof e.email=="undefined"||e.email==null)window.location.href="#/dp";e.edit={},e.edit.profile=0,e.edit.pwd=!1,e.pwd={},t({url:WEBROOT+"/cad/getcadinfo",method:"POST",data:{email:n.getEmail()}}).success(function(t){t.state!=0?e.errmsg=t.message:e.cad=t.message}),e.modifyCad=function(){e.edit.profile=1,e.tempCad=e.cad},e.saveCad=function(){t({url:WEBROOT+"/cad/modifycadinfo",method:"POST",data:e.tempCad}).success(function(t){t.state!=0?e.errmsg=t.message:(e.cad=e.tempCad,e.errmsg="修改成功",e.edit.profile=0)})},e.savePwd=function(){t({url:WEBROOT+"/cad/modifypwd",method:"POST",data:{email:n.getEmail(),oldpwd:md5(e.pwd.old),newpwd:md5(e.pwd.newpd)}}).success(function(t){t.state!=0?e.errmsg=t.message:(e.errmsg="修改成功",e.edit.pwd=!1)})}}]);OJApp.controller("cadtestingController",["$scope","$http","CadData",function(e,t,n){e.time={},e.showtext=1,e.email=n.getEmail();if(e.email==""||typeof e.email=="undefined"||e.email==null)window.location.href="#/dp";t({url:WEBROOT+"/cadquiz/starttest",method:"POST",data:{testid:n.getTestid(),email:n.getEmail()}}).success(function(t){t.state==101?(smoke.alert(t.message),window.location.href="#/dp/testmain"):t.state!=0?(smoke.alert(t.message),window.location.href="#/dp/testdetail"):(e.question=t.message.question,e.getQuestionStar(e.question),e.cadInfo=t.message.cadInfo,e.countdown(e.question.limittime))}).error(function(){console.log("get data failed")}),e.countdown=function(t){var n=(new Date).getTime(),r=n+t*1e3;console.log("limittime....",t),e.$broadcast("countdown",r)},e.$on("cdfinished",function(){e.firsttime=0,e.submit()}),e.firsttime=1,e.submit=function(){var r=e.question.answer,i=r.length;for(var s=0;s<i;s++)for(var o=s+1;o<i;o++)if(r[o].caseId<r[s].caseId){var u=r[s];r[s]=r[o],r[o]=u}var a="";for(var s=0;s<i;s++)r[s].isright?a+="1":a+="0";if(a=="0000"&&e.firsttime==1)return e.firsttime=0,smoke.alert("你还没有答题哦，怎么就提交了？如果这题不会，可以选择跳过～"),!1;t({url:WEBROOT+"/cadquiz/answerQuestion",method:"POST",data:{testid:n.getTestid(),problemid:e.question.qid,email:n.getEmail(),useranswer:a}}).success(function(t){t.state==101?(smoke.alert(t.message),window.location.href="#/dp/testmain"):t.state==1?(smoke.alert(t.message),window.location.href="#/dp/testdetail"):(e.question=t.message.question,e.getQuestionStar(e.question),e.cadInfo=t.message.cadInfo,e.countdown(e.question.limittime))}).error(function(){console.log("get data failed")}),e.firsttime=1},e.getQuestionStar=function(t){var n="";t.level==1?n="dp1star":t.level==2?n="dp2star":t.level==3&&(n="dp3star"),e.questionStar="resource/static/"+n+".png"},e.getNext=function(){t({url:WEBROOT+"/cadquiz/getquestion",method:"POST",data:{testid:n.getTestid(),email:n.getEmail()}}).success(function(t){t.state==101?(smoke.alert(t.message),window.location.href="#/dp/testmain"):t.state!=0?e.errmsg=t.message:(e.question=t.message,e.getQuestionStar(e.question),e.countdown(e.question.limittime))}).error(function(){console.log("get data failed")})},e.comment={},e.submitComment=function(){if(typeof e.comment.txt=="undefined"||e.comment.txt.replace(/\s+/g,"")=="")return flashTip("吐槽不可为空"),!1;t({url:WEBROOT+"/comment/add",method:"POST",data:{email:n.getEmail(),pid:0,content:e.comment.txt,stype:2,sid:e.question.qid}}).success(function(t){flashTip("吐槽成功，感谢您的吐槽!"),e.showtext=0}).error(function(){console.log("get data failed")})}}]);OJApp.controller("findPwdCtrl",["$scope","$http","Data","$routeParams","$window",function(e,t,n,r,i){e.refreshQuestion=function(){t({url:WEBROOT+"/user/getVerifyQtn",method:"POST"}).success(function(t){e.content=t.message})},e.refreshQuestion(),e.request=function(){e.email&&e.answer&&t({url:WEBROOT+"/user/setting/resetpwdapply",method:"POST",data:{email:e.email,content:e.content,answer:e.answer}}).success(function(t){if(t.state!=0)return flashTip(t.message),!1;flashTip("已向您邮箱发送重置密码信息"),e.isMessage=1})},e.submit=function(){if(typeof e.pwd=="undefined"||typeof e.confirmpwd=="undefined"||e.pwd==""||e.confirmpwd=="")return e.errmsg="输入不得为空",flashTip("输入不得为空"),!1;if(e.pwd!=e.confirmpwd)return flashTip("两次密码不同"),!1;var n=md5(e.pwd),r=md5(e.confirmpwd);t({url:WEBROOT+"/user/setting/resetpwd",method:"POST",data:{email:e.email,pwd:n,confirmpwd:r}}).success(function(t){t.state==0?(flashTip("重置密码成功"),e.successStage=1,e.submitStage=0):flashTip(t.message)}).error(function(){flashTip("重置密码失败")})},e.checkUrl=function(){t({url:WEBROOT+"/user/setting/checkurl",method:"POST",data:{url:r.auth}}).success(function(t){e.email=t.message,e.requestStage=0,e.submitStage=1}).error(function(t){e.requestStage=0,e.submitStage=1,flashTip("链接地址无效")})},e.isMessage=0,e.successStage==0,r.auth?e.checkUrl():(e.requestStage=1,e.submitStage=0)}]);OJApp.controller("MyTestBank",["$scope",function(e){e.url="#/mybank",e.template="page/mytestBank.html",e.ContentUs="page/contentUs.html",e.leftBar="page/libleftBar.html",e.active=1,e.show=1}]),OJApp.controller("mytestbank",["$scope","$http","Data","$sce","$modal",function(e,t,n,r,s){e.url="#/mybank",e.template="page/mytestBank.html",e.ContentUs="page/contentUs.html",e.leftBar="page/libleftBar.html",e.active=1,e.show=1,e.active=1,e.show=1,e.token={},e.token.data=n.token(),e.Qtype=[{name:"选择题",data:"1"},{name:"简答题",data:"3"}],e.page=1,e.keyword="",e.tag="",e.context="",e.reciveData=new Object,e.reciveData.selectedSets=null,e.reciveData.totalPage=1,e.reciveData.pageNum=10,e.reciveData.type=1,e.reciveData.keyword="",e.reciveData.pagelist=new Array,e.reciveData.frontPage=!1,e.reciveData.rearPage=!1,e.reciveData.currentPage=1,e.reciveData.index=1,e.reciveData.choosedQ=null,e.progrma=new Object,e.progrma.show=!1,e.newQuestion=new QuestionMeta,e.myu=1,e.reciveData.choosedQlist=new Array,e.editorOptions={language:"ru",uiColor:"#000000"},e.onSuccess=function(e){e.state==0&&flashTip(e.msg)},e.$on("questionModify",function(t,n){e.reciveData.questions[e.modifyQsIndex]=n}),e.modifyQuestionInTest=function(e,t,n,r){var i=s.open({templateUrl:"page/myModalContent.html",controller:"ModalInstanceCtrl",size:e,resolve:{params:function(){var e={};return e.operation=n.operation,e.title=n.title,e.question=t,e.index=r,e}}})},e.computePage=function(){var t=Math.ceil(e.reciveData.totalPage/e.reciveData.pageNum);t=t==0?1:t,e.reciveData.index=t,t<=1&&(e.reciveData.frontPage=!1,e.reciveData.rearPage=!1),e.reciveData.currentPage>=t?(e.reciveData.currentPage=t,e.reciveData.rearPage=!1,e.reciveData.frontPage=!0):e.reciveData.currentPage<=1?(e.reciveData.currentPage=1,e.reciveData.rearPage=!0,e.reciveData.frontPage=!1):(e.reciveData.rearPage=!0,e.reciveData.frontPage=!0),e.reciveData.pagelist=new Array;for(i=1;i<=t;i++){var n=new Object;n.current=!1,n.index=i,e.reciveData.pagelist.push(n)}e.reciveData.pagelist[e.reciveData.currentPage-1].current=!0},e.getQuestions=function(r){t({url:WEBROOT+"/search/my",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,e.message=t.message,e.state?(e.reciveData.totalPage=e.message.totalPage,e.reciveData.pageNum=e.message.pageNum,e.reciveData.questions=e.message.questions,e.computePage()):(e.reciveData.totalPage=1,e.reciveData.pageNum=0,e.reciveData.questions=null)}).error(function(e){})},e.oneAtATime=!0,e.showContent=function(e){console.log("qid........."+e);var t="panel"+e;t=!0},e.gettrustContext=function(e){var t="<span>内容:";t+=e.context+"</span><br/>",t+="<span>&nbsp;&nbsp;&nbsp;标签:",t+=e.tag+"</span><br/> <span>";for(var n=0;n<e.answer.length;n++)t+="<p>"+n+":",t+=e.answer[n].text,t+="</p>";return t+="</span>",r.trustAsHtml(t)},e.queryQuestions=function(t){e.reciveData.currentPage=t;for(i=0;i<e.reciveData.pagelist.length;i++)e.reciveData.pagelist[i].current=!1;e.reciveData.pagelist[t-1].current=!0;var r=new Object;r.user=new Object,r.user.uid=n.uid(),r.type=e.reciveData.type,r.keyword=e.reciveData.keyword,r.page=t,r.pageNum=e.reciveData.pageNum,e.getQuestions(r)},e.computePage(),e.queryQuestions(1),e.GoPage=function(t){e.show=1,e.keyword="",e.tag="",e.context="",e.active=t,e.reciveData.type=e.active,e.newQuestion=new QuestionMeta,e.queryQuestions(1)},e.showAddPage=function(t){e.active=t,e.show=0,e.context="",e.tag=""},e.isNum=function(e){if(e==null||e=="")return;var t=/^\+?[0-9][0-9]*$/;t.test(e)||(flashTip("必须是数字！"),e=0)},e.pushQuestion=function(r){t({url:WEBROOT+"/question/add",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,t["token"]!=""&&t["token"]!=null&&n.setToken(t.token),e.message=t.message,e.state?(flashTip("添加成功"),e.show="1",e.queryQuestions(1),e.newQuestion=new QuestionMeta):flashTip("添加失败")}).error(function(e){})},e.addQuestion=function(){e.newQuestion.type=parseInt(e.active);if(e.newQuestion.answer==""&&e.newQuestion.type==1)return flashTip("请输入至少一个选项"),!1;if(e.active=="1")for(a in e.newQuestion.answer)a.isright=a.isright==0?"0":"1";var t=e.newQuestion.tag;t==""?e.newQuestion.tag=[]:t.split(",").length>=t.split("，")?e.newQuestion.tag=t.split(","):e.newQuestion.tag=t.split("，"),e.newQuestion.setid=CUSTOM_SET,sendData={user:{uid:n.uid()},quizId:e.tid,question:e.newQuestion},e.pushQuestion(sendData)},e.cancel=function(){e.show="1"},e.resetQuestion=function(){e.newQuestion.name="",e.newQuestion.context="",e.newQuestion.answer=null,e.newQuestion.tag="",e.newQuestion.type=e.active},e.searchmy=function(e){},e.addOne=function(){var t={};e.active=="1"?t.isright=!1:t.isright="",e.newQuestion.addAnswer(t)},e.removeOne=function(t){e.newQuestion.removeAnswer(t)},e.InsertQuestion=function(){var r=[];console.log(e.qs);for(q in e.qs)r.push(e.qs[q].qid);r.push(e.reciveData.choosedQ.qid);var i=[];$.each(r,function(e,t){$.inArray(t,i)===-1&&i.push(t)}),t({url:WEBROOT+"/test/manage/submite",method:"POST",headers:{Authorization:n.token()},data:{user:{uid:n.uid()},quizid:e.tid,qids:i}}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.tid=e.message.quizid,window.location.href="#/test/"+e.tid)}).error(function(e){})},e.addOnelist=function(t){var n=e.reciveData.choosedQlist.indexOf(t);n>-1?e.reciveData.choosedQlist.splice(n,1):(e.myu==1&&(e.reciveData.choosedQ=t,e.reciveData.choosedQlist=new Array),e.reciveData.choosedQlist.push(t))}}]);function Answers(){this.text="",this.isright="",this.score=4}function QuestionMeta(){this.context="",this.answer=null,this.tag="",this.name="",this.type="",this.qid="",this.setid="",this.addAnswer=function(e){this.answer==null&&(this.answer=new Array),this.answer.push(e)},this.removeAnswer=function(e){this.answer.splice(e,1)},this.reset=function(){this.context="",this.answer=null,this.tag="",this.name="",this.type="",this.qid="",this.setid=""},this.copyObj=function(e){this.context=e.context,this.answer=e.answer,this.tag=e.tag,this.name=e.name,this.type=e.type,this.qid=e.qid,this.setid=e.setid}}OJApp.controller("TestBank",["$scope","$http","Data","$sce","$modal",function(e,t,n,r,s){e.url="#/bank",e.template="page/testBank.html",e.ContentUs="page/contentUs.html",e.leftBar="page/libleftBar.html",e.active=1,e.show=1,e.privi=n.privi(),e.reciveData={},e.reciveData.selectedSets=null,e.reciveData.totalPage=1,e.reciveData.pageNum=10,e.reciveData.type=1,e.reciveData.keyword="",e.reciveData.pagelist=new Array,e.reciveData.frontPage=!1,e.reciveData.rearPage=!1,e.reciveData.currentPage=1,e.reciveData.index=1,e.reciveData.choosedQ=null,e.reciveData.choosedQlist=new Array,e.reciveData.setObj=null,e.progrma=new Object,e.progrma.show=!1,e.newQuestion=new QuestionMeta,e.sendQuestion=new QuestionMeta,e.tag="",e.myu=1,e.Qtype=[{name:"选择题",data:"1"},{name:"编程题",data:"2"}],e.domainType=1,e.modifyQuestionInTest=function(e,t,n){var r=jQuery.extend(!0,{},t),i=s.open({templateUrl:"page/myModalContent.html",controller:"ModalInstanceCtrl",size:e,resolve:{params:function(){var e={};return e.operation=n.operation,e.title=n.title,e.question=r,e}}})},e.editorOptions={language:"ru",uiColor:"#000000"},e.editorOptions1={language:"ru",uiColor:"#000000"},e.editorOptions2={language:"ru",uiColor:"#000000"},e.computePage=function(){var t=Math.ceil(e.reciveData.totalPage/e.reciveData.pageNum);t=t==0?1:t,e.reciveData.index=t,t<=1&&(e.reciveData.frontPage=!1,e.reciveData.rearPage=!1),e.reciveData.currentPage>=t?(e.reciveData.currentPage=t,e.reciveData.rearPage=!1,e.reciveData.frontPage=!0):e.reciveData.currentPage<=1?(e.reciveData.currentPage=1,e.reciveData.rearPage=!0,e.reciveData.frontPage=!1):(e.reciveData.rearPage=!0,e.reciveData.frontPage=!0),e.reciveData.pagelist=new Array;for(i=1;i<=t;i++){var n=new Object;n.current=!1,n.index=i,e.reciveData.pagelist.push(n)}e.reciveData.pagelist[e.reciveData.currentPage-1].current=!0},e.getSets=function(){var r=new Object;r.uid=n.uid(),t({url:WEBROOT+"/search/sets",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,e.message=t.message;if(e.state){e.reciveData.sets=e.message,e.problemSet=[];for(var n=0;n<e.reciveData.sets.length;n++){var r=e.reciveData.sets[n].problemSets;for(var i=0;i<r.length;i++)e.problemSet.push(r[i])}}}).error(function(e){})},e.gettrustContext=function(e){var t="<span>内容:";t+=e.context+"</span><br/>",t+="<span>&nbsp;&nbsp;&nbsp;标签:",t+=e.tag+"</span><br/> <span>";for(var n=0;n<e.answer.length;n++)t+="<p>"+n+":",t+=e.answer[n].text,t+="</p>";return t+="</span>",r.trustAsHtml(t)},e.getQuestions=function(r){t({url:WEBROOT+"/search/site",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,e.message=t.message,e.state?(e.reciveData.totalPage=e.message.totalPage,e.reciveData.questions=e.message.questions,e.computePage()):(e.reciveData.totalPage=1,e.reciveData.pageNum=0,e.reciveData.questions=null)}).error(function(e){})},e.showQuestions=function(t){e.reciveData.selectedSets=t,e.queryQuestions(1)},e.queryQuestions=function(t){e.set.show=0,e.reciveData.currentPage=t;for(i=0;i<e.reciveData.pagelist.length;i++)e.reciveData.pagelist[i].current=!1;e.reciveData.pagelist[t-1].current=!0;var r=new Object;r.user=new Object,r.user.uid=n.uid(),r.type=e.reciveData.type,e.reciveData.type!="2"&&e.reciveData.selectedSets!=null&&(r.setid=e.reciveData.selectedSets.problemSetId),r.keyword=e.reciveData.keyword,r.page=t,r.pageNum=e.reciveData.pageNum,e.getQuestions(r),e.showSet=0},e.getSets(),e.computePage(),e.set={},e.set.show=1,e.goPage=function(t){console.log("data.............",t),e.show=1,e.context="",e.keyword="",e.active=t,e.reciveData.type=e.active,e.tag="",e.newQuestion.reset(),e.set.show=1,e.reciveData.selectedSets={},e.reciveData.setObj=null},e.AddPage=function(t){e.active=t.getAttribute("data"),e.show=0,e.newQuestion.reset(),e.reciveData.keyword=""},e.isNum=function(e){if(e==null||e=="")return;var t=/^\+?[0-9][0-9]*$/;t.test(e)||(alert("必须是数字！"),e=0)},e.pushQuestion=function(r){t({url:WEBROOT+"/question/add",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,t["token"]!=""&&t["token"]!=null&&n.setToken(t.token),e.message=t.message,e.state?(alert("添加成功"),e.show="1",e.queryQuestions(1),e.newQuestion.reset(),e.reciveData.setObj=null):alert("添加失败")}).error(function(e){})},e.searchmy=function(e){},e.addOne=function(){var t=new Answers;e.active=="1"?t.isright=!1:t.isright="",e.newQuestion.addAnswer(t)},e.removeOne=function(t){e.newQuestion.removeAnswer(t)},e.InsertQuestion=function(){var r=[];console.log(e.qs);for(q in e.qs)r.push(e.qs[q].qid);r.push(e.reciveData.choosedQ.qid);var i=[];$.each(r,function(e,t){$.inArray(t,i)===-1&&i.push(t)}),t({url:WEBROOT+"/test/manage/submite",method:"POST",headers:{Authorization:n.token()},data:{user:{uid:n.uid()},quizid:e.tid,qids:i}}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.tid=e.message.quizid,window.location.href="#/test/"+e.tid)}).error(function(e){})},e.addOnelist=function(t){var n=e.reciveData.choosedQlist.indexOf(t);n>-1?e.reciveData.choosedQlist.splice(n,1):(e.myu==1&&(e.reciveData.choosedQ=t,e.reciveData.choosedQlist=new Array),e.reciveData.choosedQlist.push(t))}}]);OJApp.controller("TestPage",["$scope","$http","Data","$modal",function(e,t,n,r){e.url="#/test",e.active=1,e.template="page/testshow.html",e.ContentUs="page/contentUs.html",e.leftBar="page/testsleftbar.html",e.addtest={},e.addtest.user={},e.addtest.testtime=70,e.panel={},e.panel.isShow=!0,e.panel.isGuide=!0,e.panel.body=0,e.panel.isBack=!1,e.panel.trace=[],e.test={},e.test.isNewTest=!1,e.guide={},e.guide.show=0,e.genQuiz=function(e){t({url:WEBROOT+"/test/genquiz",method:"POST",headers:{Authorization:n.token()},data:{quizName:e}}).success(function(e){flashTip("创建测试成功"),location.reload()}).error(function(e){flashTip("genQuizFailed")})},e.viewGuideModal=function(t){console.log("view guide modal.........",t);var n=r.open({templateUrl:"page/guideModal.html",controller:"guideModalCtrl",resolve:{params:function(){var n={};return n.title="技能介绍",n.content=e.guideArray[t],n.data=t,n}}})},e.goNext=function(t){e.panel.trace.push(e.panel.body),e.panel.body=t,e.panel.isBack=!0},e.goBack=function(){var t=e.panel.trace.pop();e.panel.body=t,e.panel.trace.length!=0?e.panel.isBack=!0:e.panel.isBack=!1},e.tshow=function(){t({url:WEBROOT+"/test/show",method:"POST",headers:{Authorization:n.token()},data:{uid:n.uid()}}).success(function(t){e.state=t.state,e.message=t.message;if(e.state){e.tests=e.message.tests;for(var n=0;n<e.tests.length;n++)e.tests[n].data=n}}).error(function(e){console.log("服务器错误")})},e.tshow(),e.report=function(e){n.setTid(e.quizid),n.setTname(e.name),window.location.href="#/report/show/2"},e.inviteUser=function(e){n.setTid(e.quizid),n.setTname(e.name),window.location.href="#/invite"},e.pushTest=function(){if(e.addtest.name==""){alert("名字不允许为空");return}e.addtest.user.uid=n.uid(),t({url:WEBROOT+"/test/add",method:"POST",headers:{Authorization:n.token()},data:e.addtest}).success(function(t){e.state=t.state,e.message=t.message,e.state?(n.setTid(e.message.msg),n.setTname(e.addtest.name),e.testManage(),window.location.href="#/test/"+e.message.msg):flashTip("error:"+e.message.msg)}).error(function(e){})},e.testManage=function(){var r=new Object;r.user=new Object,r.user.uid=n.uid(),r.quizid=n.tid(),t({url:WEBROOT+"/test/manage",method:"POST",headers:{Authorization:n.token()},data:r}).success(function(t){e.state=t.state,e.message=t.message,e.state&&(e.qs=e.message.qs,e.testtime=e.message.testtime,e.extraInfo=e.message.extraInfo,e.emails=e.message.emails)}).error(function(t){alert("现在使用的是展示数据"),e.qs=[{qid:6,name:"测试选择",type:0,tag:[],context:"在下面的选项中选出正确的一项",answer:[]},{qid:9,name:"第二个测试",type:0,tag:["测试","选择题"],context:"选择下面正确的一项",answer:[{text:"1+1=2",isright:"1",score:4},{text:"1+1=3",isright:"0",score:0},{text:"1+1=4",isright:"0",score:0}]}],e.testtime=70,e.extraInfo="1,2",e.emails="ss@ss.com,sd@ss.com"})}}]);OJApp.controller("invite",["$scope","$http","Data",function(e,t,n){e.url="#/invite",e.template="page/invite.html",e.ContentUs="page/contentUs.html",e.leftBar="page/testlistleftbar.html"}]),OJApp.controller("Excel",["$scope","$http","Data",function(e,t,n){function i(e,t){var n=new Worker("resource/js/xls/xlsworker.js");n.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data);break;case"xls":t(e.data.d)}},n.postMessage(e)}function s(e){var t={};return e.SheetNames.forEach(function(n){var r=XLS.utils.sheet_to_row_object_array(e.Sheets[n]);r.length>0&&(t[n]=r)}),t}function o(t){typeof Worker!="undefined"&&XLS.SSF.load_table(t.SSF);var n="";n=s(t),e.$apply(function(){$.merge(e.xlsusers,n.Sheet1),e.xlsusers.shift()})}function u(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files,n,s;for(n=0,s=t[n];n!=t.length;++n){var u=new FileReader;u.onload=function(e){var t=e.target.result;if(r&&typeof Worker!="undefined")i(t,o);else{var n=XLS.read(t,{type:"binary"});o(n)}},u.readAsBinaryString(s)}}function a(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}e.duration=70,e.camera={},e.camera.selected=0,e.options=[{id:0,content:"必须开启"},{id:1,content:"不开启"}],e.subject="笔试邀请",e.content="     我们非常荣幸能收到您的简历，做为优秀的候选人之一，我们诚挚的邀请您参加测试，使我们能进一步了解您的能力。",e.xlsusers=[{username:"",email:"",tel:"",test:n.tname(),openCamera:""}],e.addOne=function(t){var n=e.xlsusers.indexOf(t);e.active=="notSelect"?e.xlsusers.splice(n+1,0,{username:"",email:"",tel:"",test:""}):e.xlsusers.splice(n+1,0,{username:"",email:"",tel:"",test:e.active})},e.removeOne=function(t){var n=e.xlsusers.indexOf(t);n>-1&&e.xlsusers.splice(n,1)},e.removeTest=function(e){},e.clean=function(){e.content=""},e.testlist=[],e.testlist.push(n.tname()),e.tnamelist={},e.upload=function(r,i){t({url:WEBROOT+"/test/manage/invite",method:"POST",headers:{Authorization:n.token()},data:{user:{uid:n.uid()},subject:e.subject,duration:e.duration,replyTo:e.replyTo,quizid:n.tid(),invite:i,context:e.content,starttime:e.startTime,deadtime:e.endTime}}).success(function(t){e.state=t.state,e.message=t.message,e.state?(removeTip(),flashTip("邀请成功")):flashTip(e.message.msg)}).error(function(e){})},e.sent=function(){for(tid in e.testlist){var t=[];for(var n in e.xlsusers){if(e.xlsusers[n].email=="")return smoke.alert("邮箱不可为空"),!1;e.xlsusers[n].openCamera=e.camera.selected,t.push(e.xlsusers[n])}loadingTip(),e.upload(e.testlist[tid],t)}};var r=!0,f=document.getElementById("drop");f.addEventListener&&(f.addEventListener("dragenter",a,!1),f.addEventListener("dragover",a,!1),f.addEventListener("drop",u,!1))}]),OJApp.filter("filterTest",function(){return function(e,t){var n=[];return t=="notSelect"&&(t=""),angular.forEach(e,function(e){e.test==t&&n.push(e)}),n}});OJApp.controller("TestPageTid",["$scope","$rootScope","$routeParams","$http","$modal","Data","$timeout",function(e,t,n,r,s,o,u){e.url="#/test",e.ContentUs="page/contentUs.html",e.template="page/testlist.html",e.leftBar="page/testlistleftbar.html",e.tid=n.tid,e.modifyQsIndex="",e.contain={},e.contain.show=1,o.setTid(e.tid),e.showDefault=!1,e.showCustom=!1,e.showButton=!0,e.test={},e.test.addAction=!0,e.set={},e.getTypeName=function(e){return e==1?"选择题":e==2?"编程题":e==3?"简答题":"no"},e.testManage=function(){var t=new Object;t.user=new Object,t.user.uid=o.uid(),t.quizid=o.tid(),r({url:WEBROOT+"/test/manage",method:"POST",headers:{Authorization:o.token()},data:t}).success(function(t){e.state=t.state,e.message=t.message,console.log(e.message);if(e.state){e.qs=e.message.qs,e.isDisplay=new Array(e.qs.length);for(i in e.isDisplay)e.isDisplay[i]=!1;e.testtime=e.message.testtime,e.extraInfo=e.message.extraInfo,e.emails=e.message.emails,e.name=e.message.name,o.setTname(e.name)}}).error(function(e){flashTip("获取数据错误")}),e.template="page/testlist.html",e.myu=1},e.testManage(),e.CommonSetting=function(t){e.template="page/commonsetting.html",e.ContentUs="page/contentUs.html"},e.Invite=function(e){window.location.href="#/invite"},e.MultInvite=function(t){window.location.href="#/invite",e.active=t.getAttribute("data"),e.name=e.tests[e.active].name,e.tid=e.tests[e.active].quizid,o.setTid(e.tid),o.setTname(e.name)},e.Report=function(t){e.leftBar="page/leftBar.html",e.template="page/report.html",e.active=t.getAttribute("data"),e.name=e.tests[e.active].name,e.tid=e.tests[e.active].quizid,o.setTid(e.tid),o.setTname(e.name)},e.panel={},e.panel.show="",e.showDefaultPanel=function(){e.panel.show="default",e.set.show=1},e.showCustomPanel=function(){e.panel.show="custom"},e.addQuestionToTest=function(t,n){var i=0;for(var s=0;s<e.qs.length;s++)e.qs[s].type==2&&i++;if(t.type==2&&i>0)return flashTip("为保证考试时间，只能添加一道编程题"),!1;var u={quizid:e.tid,problemid:t.qid};r({url:WEBROOT+"/test/addquestion",method:"POST",headers:{Authorization:o.token()},data:u}).success(function(n){n.message=="success"?e.qs.push(t):flashTip(n.message)}).error(function(e){})},e.modifyQuestionInTest=function(t,n,r,i){var o=jQuery.extend(!0,{},n);e.modifyQsIndex=i;var u=s.open({templateUrl:"page/myModalContent.html",controller:"ModalInstanceCtrl",size:t,resolve:{params:function(){var e={};return e.operation=r.operation,e.title=r.title,e.question=o,e.type=n.type,e.index=i,e}}})},e.$on("questionModify",function(e,t){console.log("testpagetid")}),e.deleteQuestionFromTest=function(t){var n={quizid:e.tid,problemid:t.qid};r({url:WEBROOT+"/test/delquestion",method:"POST",headers:{Authorization:o.token()},data:n}).success(function(n){flashTip("试题已从测试中删除");for(var r=0;r<e.qs.length;r++)e.qs[r].qid==t.qid&&e.qs.splice(r,1)}).error(function(e){flashTip("获取数据错误")})},e.expandAll=function(){console.log("expandall .....",e.isDisplay.length);for(t in e.isDisplay)e.isDisplay[t]=!0;for(var t=0;t<e.isDisplay.length;t++)e.isDisplay[t]=!0},e.displayQuestionDetails=function(t){e.isDisplay[t]=!0},e.hideQuestionDetails=function(t){e.isDisplay[t]=!1},e.isAdded=function(t){for(i in e.qs)if(e.qs[i].qid==t)return!0;return!1},e.moveUp=function(t){if(t==0)flashTip("已是第一题，不可前移");else{var n=e.qs[t];e.qs[t]=e.qs[t-1],e.qs[t-1]=n}},e.moveDown=function(t){if(t>=e.qs.length-1)flashTip("已是最后一题，不可后移");else{var n=e.qs[t];e.qs[t]=e.qs[t+1],e.qs[t+1]=n}}}]);OJApp.controller("LoginOk",["$scope","$http","Data","$sce",function(e,t,n,r){e.url="#/loginOk",e.template="loginOk.html",e.ContentUs="contentUs.html",e.leftBar="leftBar1.html";var i=n.flag();i==0?(n.setFlag(1),window.location.reload()):n.setFlag(0),window.location.href="#/test"}]);!function(e){"use strict";function t(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function n(e,t){return e<<t|e>>>32-t}function r(e,r,i,s,o,u){return t(n(t(t(r,e),t(s,u)),o),i)}function i(e,t,n,i,s,o,u){return r(t&n|~t&i,e,t,s,o,u)}function s(e,t,n,i,s,o,u){return r(t&i|n&~i,e,t,s,o,u)}function o(e,t,n,i,s,o,u){return r(t^n^i,e,t,s,o,u)}function u(e,t,n,i,s,o,u){return r(n^(t|~i),e,t,s,o,u)}function a(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,a,f,l,c,h=1732584193,p=-271733879,d=-1732584194,v=271733878;for(r=0;r<e.length;r+=16)a=h,f=p,l=d,c=v,h=i(h,p,d,v,e[r],7,-680876936),v=i(v,h,p,d,e[r+1],12,-389564586),d=i(d,v,h,p,e[r+2],17,606105819),p=i(p,d,v,h,e[r+3],22,-1044525330),h=i(h,p,d,v,e[r+4],7,-176418897),v=i(v,h,p,d,e[r+5],12,1200080426),d=i(d,v,h,p,e[r+6],17,-1473231341),p=i(p,d,v,h,e[r+7],22,-45705983),h=i(h,p,d,v,e[r+8],7,1770035416),v=i(v,h,p,d,e[r+9],12,-1958414417),d=i(d,v,h,p,e[r+10],17,-42063),p=i(p,d,v,h,e[r+11],22,-1990404162),h=i(h,p,d,v,e[r+12],7,1804603682),v=i(v,h,p,d,e[r+13],12,-40341101),d=i(d,v,h,p,e[r+14],17,-1502002290),p=i(p,d,v,h,e[r+15],22,1236535329),h=s(h,p,d,v,e[r+1],5,-165796510),v=s(v,h,p,d,e[r+6],9,-1069501632),d=s(d,v,h,p,e[r+11],14,643717713),p=s(p,d,v,h,e[r],20,-373897302),h=s(h,p,d,v,e[r+5],5,-701558691),v=s(v,h,p,d,e[r+10],9,38016083),d=s(d,v,h,p,e[r+15],14,-660478335),p=s(p,d,v,h,e[r+4],20,-405537848),h=s(h,p,d,v,e[r+9],5,568446438),v=s(v,h,p,d,e[r+14],9,-1019803690),d=s(d,v,h,p,e[r+3],14,-187363961),p=s(p,d,v,h,e[r+8],20,1163531501),h=s(h,p,d,v,e[r+13],5,-1444681467),v=s(v,h,p,d,e[r+2],9,-51403784),d=s(d,v,h,p,e[r+7],14,1735328473),p=s(p,d,v,h,e[r+12],20,-1926607734),h=o(h,p,d,v,e[r+5],4,-378558),v=o(v,h,p,d,e[r+8],11,-2022574463),d=o(d,v,h,p,e[r+11],16,1839030562),p=o(p,d,v,h,e[r+14],23,-35309556),h=o(h,p,d,v,e[r+1],4,-1530992060),v=o(v,h,p,d,e[r+4],11,1272893353),d=o(d,v,h,p,e[r+7],16,-155497632),p=o(p,d,v,h,e[r+10],23,-1094730640),h=o(h,p,d,v,e[r+13],4,681279174),v=o(v,h,p,d,e[r],11,-358537222),d=o(d,v,h,p,e[r+3],16,-722521979),p=o(p,d,v,h,e[r+6],23,76029189),h=o(h,p,d,v,e[r+9],4,-640364487),v=o(v,h,p,d,e[r+12],11,-421815835),d=o(d,v,h,p,e[r+15],16,530742520),p=o(p,d,v,h,e[r+2],23,-995338651),h=u(h,p,d,v,e[r],6,-198630844),v=u(v,h,p,d,e[r+7],10,1126891415),d=u(d,v,h,p,e[r+14],15,-1416354905),p=u(p,d,v,h,e[r+5],21,-57434055),h=u(h,p,d,v,e[r+12],6,1700485571),v=u(v,h,p,d,e[r+3],10,-1894986606),d=u(d,v,h,p,e[r+10],15,-1051523),p=u(p,d,v,h,e[r+1],21,-2054922799),h=u(h,p,d,v,e[r+8],6,1873313359),v=u(v,h,p,d,e[r+15],10,-30611744),d=u(d,v,h,p,e[r+6],15,-1560198380),p=u(p,d,v,h,e[r+13],21,1309151649),h=u(h,p,d,v,e[r+4],6,-145523070),v=u(v,h,p,d,e[r+11],10,-1120210379),d=u(d,v,h,p,e[r+2],15,718787259),p=u(p,d,v,h,e[r+9],21,-343485551),h=t(h,a),p=t(p,f),d=t(d,l),v=t(v,c);return[h,p,d,v]}function f(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function c(e){return f(a(l(e),8*e.length))}function h(e,t){var n,r,i=l(e),s=[],o=[];for(s[15]=o[15]=void 0,i.length>16&&(i=a(i,8*e.length)),n=0;16>n;n+=1)s[n]=909522486^i[n],o[n]=1549556828^i[n];return r=a(s.concat(l(t)),512+8*t.length),f(a(o.concat(r),640))}function p(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function d(e){return unescape(encodeURIComponent(e))}function v(e){return c(d(e))}function m(e){return p(v(e))}function g(e,t){return h(d(e),d(t))}function y(e,t){return p(g(e,t))}function b(e,t,n){return t?n?g(t,e):y(t,e):n?v(e):m(e)}"function"==typeof define&&define.amd?define(function(){return b}):e.md5=b}(this);function strEnc(e,t,n,r){var i=e.length,s="",o,u,a,f,l,c;t!=null&&t!=""&&(o=getKeyBytes(t),f=o.length),n!=null&&n!=""&&(u=getKeyBytes(n),l=u.length),r!=null&&r!=""&&(a=getKeyBytes(r),c=a.length);if(i>0)if(i<4){var h=strToBt(e),p;if(t!=null&&t!=""&&n!=null&&n!=""&&r!=null&&r!=""){var d,v,m,g;d=h;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);for(g=0;g<c;g++)d=enc(d,a[g]);p=d}else if(t!=null&&t!=""&&n!=null&&n!=""){var d,v,m;d=h;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);p=d}else if(t!=null&&t!=""){var d,v=0;d=h;for(v=0;v<f;v++)d=enc(d,o[v]);p=d}s=bt64ToHex(p)}else{var y=parseInt(i/4),b=i%4,w=0;for(w=0;w<y;w++){var E=e.substring(w*4+0,w*4+4),S=strToBt(E),p;if(t!=null&&t!=""&&n!=null&&n!=""&&r!=null&&r!=""){var d,v,m,g;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);for(g=0;g<c;g++)d=enc(d,a[g]);p=d}else if(t!=null&&t!=""&&n!=null&&n!=""){var d,v,m;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);p=d}else if(t!=null&&t!=""){var d,v;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);p=d}s+=bt64ToHex(p)}if(b>0){var x=e.substring(y*4+0,i),S=strToBt(x),p;if(t!=null&&t!=""&&n!=null&&n!=""&&r!=null&&r!=""){var d,v,m,g;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);for(g=0;g<c;g++)d=enc(d,a[g]);p=d}else if(t!=null&&t!=""&&n!=null&&n!=""){var d,v,m;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);for(m=0;m<l;m++)d=enc(d,u[m]);p=d}else if(t!=null&&t!=""){var d,v;d=S;for(v=0;v<f;v++)d=enc(d,o[v]);p=d}s+=bt64ToHex(p)}}return s}function strDec(e,t,n,r){var i=e.length,s="",o,u,a,f,l,c;t!=null&&t!=""&&(o=getKeyBytes(t),f=o.length),n!=null&&n!=""&&(u=getKeyBytes(n),l=u.length),r!=null&&r!=""&&(a=getKeyBytes(r),c=a.length);var h=parseInt(i/16),p=0;for(p=0;p<h;p++){var d=e.substring(p*16+0,p*16+16),v=hexToBt64(d),m=new Array(64),g=0;for(g=0;g<64;g++)m[g]=parseInt(v.substring(g,g+1));var y;if(t!=null&&t!=""&&n!=null&&n!=""&&r!=null&&r!=""){var b,w,E,S;b=m;for(w=c-1;w>=0;w--)b=dec(b,a[w]);for(E=l-1;E>=0;E--)b=dec(b,u[E]);for(S=f-1;S>=0;S--)b=dec(b,o[S]);y=b}else if(t!=null&&t!=""&&n!=null&&n!=""){var b,w,E,S;b=m;for(w=l-1;w>=0;w--)b=dec(b,u[w]);for(E=f-1;E>=0;E--)b=dec(b,o[E]);y=b}else if(t!=null&&t!=""){var b,w,E,S;b=m;for(w=f-1;w>=0;w--)b=dec(b,o[w]);y=b}s+=byteToString(y)}return s}function getKeyBytes(e){var t=new Array,n=e.length,r=parseInt(n/4),i=n%4,s=0;for(s=0;s<r;s++)t[s]=strToBt(e.substring(s*4+0,s*4+4));return i>0&&(t[s]=strToBt(e.substring(s*4+0,n))),t}function strToBt(e){var t=e.length,n=new Array(64);if(t<4){var r=0,i=0,s=0,o=0;for(r=0;r<t;r++){var u=e.charCodeAt(r);for(i=0;i<16;i++){var a=1,f=0;for(f=15;f>i;f--)a*=2;n[16*r+i]=parseInt(u/a)%2}}for(s=t;s<4;s++){var u=0;for(o=0;o<16;o++){var a=1,f=0;for(f=15;f>o;f--)a*=2;n[16*s+o]=parseInt(u/a)%2}}}else for(r=0;r<4;r++){var u=e.charCodeAt(r);for(i=0;i<16;i++){var a=1;for(f=15;f>i;f--)a*=2;n[16*r+i]=parseInt(u/a)%2}}return n}function bt4ToHex(e){var t;switch(e){case"0000":t="0";break;case"0001":t="1";break;case"0010":t="2";break;case"0011":t="3";break;case"0100":t="4";break;case"0101":t="5";break;case"0110":t="6";break;case"0111":t="7";break;case"1000":t="8";break;case"1001":t="9";break;case"1010":t="A";break;case"1011":t="B";break;case"1100":t="C";break;case"1101":t="D";break;case"1110":t="E";break;case"1111":t="F"}return t}function hexToBt4(e){var t;switch(e){case"0":t="0000";break;case"1":t="0001";break;case"2":t="0010";break;case"3":t="0011";break;case"4":t="0100";break;case"5":t="0101";break;case"6":t="0110";break;case"7":t="0111";break;case"8":t="1000";break;case"9":t="1001";break;case"A":t="1010";break;case"B":t="1011";break;case"C":t="1100";break;case"D":t="1101";break;case"E":t="1110";break;case"F":t="1111"}return t}function byteToString(e){var t="";for(i=0;i<4;i++){var n=0;for(j=0;j<16;j++){var r=1;for(m=15;m>j;m--)r*=2;n+=e[16*i+j]*r}n!=0&&(t+=String.fromCharCode(n))}return t}function bt64ToHex(e){var t="";for(i=0;i<16;i++){var n="";for(j=0;j<4;j++)n+=e[i*4+j];t+=bt4ToHex(n)}return t}function hexToBt64(e){var t="";for(i=0;i<16;i++)t+=hexToBt4(e.substring(i,i+1));return t}function enc(e,t){var n=generateKeys(t),r=initPermute(e),i=new Array(32),s=new Array(32),o=new Array(32),u=0,a=0,f=0,l=0,c=0;for(f=0;f<32;f++)i[f]=r[f],s[f]=r[32+f];for(u=0;u<16;u++){for(a=0;a<32;a++)o[a]=i[a],i[a]=s[a];var h=new Array(48);for(l=0;l<48;l++)h[l]=n[u][l];var p=xor(pPermute(sBoxPermute(xor(expandPermute(s),h))),o);for(c=0;c<32;c++)s[c]=p[c]}var d=new Array(64);for(u=0;u<32;u++)d[u]=s[u],d[32+u]=i[u];return finallyPermute(d)}function dec(e,t){var n=generateKeys(t),r=initPermute(e),i=new Array(32),s=new Array(32),o=new Array(32),u=0,a=0,f=0,l=0,c=0;for(f=0;f<32;f++)i[f]=r[f],s[f]=r[32+f];for(u=15;u>=0;u--){for(a=0;a<32;a++)o[a]=i[a],i[a]=s[a];var h=new Array(48);for(l=0;l<48;l++)h[l]=n[u][l];var p=xor(pPermute(sBoxPermute(xor(expandPermute(s),h))),o);for(c=0;c<32;c++)s[c]=p[c]}var d=new Array(64);for(u=0;u<32;u++)d[u]=s[u],d[32+u]=i[u];return finallyPermute(d)}function initPermute(e){var t=new Array(64);for(i=0,m=1,n=0;i<4;i++,m+=2,n+=2)for(j=7,k=0;j>=0;j--,k++)t[i*8+k]=e[j*8+m],t[i*8+k+32]=e[j*8+n];return t}function expandPermute(e){var t=new Array(48);for(i=0;i<8;i++)i==0?t[i*6+0]=e[31]:t[i*6+0]=e[i*4-1],t[i*6+1]=e[i*4+0],t[i*6+2]=e[i*4+1],t[i*6+3]=e[i*4+2],t[i*6+4]=e[i*4+3],i==7?t[i*6+5]=e[0]:t[i*6+5]=e[i*4+4];return t}function xor(e,t){var n=new Array(e.length);for(i=0;i<e.length;i++)n[i]=e[i]^t[i];return n}function sBoxPermute(e){var t=new Array(32),n="",r=[[14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7],[0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8],[4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0],[15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13]],i=[[15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10],[3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5],[0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15],[13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9]],s=[[10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8],[13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1],[13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7],[1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12]],o=[[7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15],[13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9],[10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4],[3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14]],u=[[2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9],[14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6],[4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14],[11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3]],a=[[12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11],[10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8],[9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6],[4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13]],f=[[4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1],[13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6],[1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2],[6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12]],l=[[13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7],[1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2],[7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8],[2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11]];for(m=0;m<8;m++){var c=0,h=0;c=e[m*6+0]*2+e[m*6+5],h=e[m*6+1]*2*2*2+e[m*6+2]*2*2+e[m*6+3]*2+e[m*6+4];switch(m){case 0:n=getBoxBinary(r[c][h]);break;case 1:n=getBoxBinary(i[c][h]);break;case 2:n=getBoxBinary(s[c][h]);break;case 3:n=getBoxBinary(o[c][h]);break;case 4:n=getBoxBinary(u[c][h]);break;case 5:n=getBoxBinary(a[c][h]);break;case 6:n=getBoxBinary(f[c][h]);break;case 7:n=getBoxBinary(l[c][h])}t[m*4+0]=parseInt(n.substring(0,1)),t[m*4+1]=parseInt(n.substring(1,2)),t[m*4+2]=parseInt(n.substring(2,3)),t[m*4+3]=parseInt(n.substring(3,4))}return t}function pPermute(e){var t=new Array(32);return t[0]=e[15],t[1]=e[6],t[2]=e[19],t[3]=e[20],t[4]=e[28],t[5]=e[11],t[6]=e[27],t[7]=e[16],t[8]=e[0],t[9]=e[14],t[10]=e[22],t[11]=e[25],t[12]=e[4],t[13]=e[17],t[14]=e[30],t[15]=e[9],t[16]=e[1],t[17]=e[7],t[18]=e[23],t[19]=e[13],t[20]=e[31],t[21]=e[26],t[22]=e[2],t[23]=e[8],t[24]=e[18],t[25]=e[12],t[26]=e[29],t[27]=e[5],t[28]=e[21],t[29]=e[10],t[30]=e[3],t[31]=e[24],t}function finallyPermute(e){var t=new Array(64);return t[0]=e[39],t[1]=e[7],t[2]=e[47],t[3]=e[15],t[4]=e[55],t[5]=e[23],t[6]=e[63],t[7]=e[31],t[8]=e[38],t[9]=e[6],t[10]=e[46],t[11]=e[14],t[12]=e[54],t[13]=e[22],t[14]=e[62],t[15]=e[30],t[16]=e[37],t[17]=e[5],t[18]=e[45],t[19]=e[13],t[20]=e[53],t[21]=e[21],t[22]=e[61],t[23]=e[29],t[24]=e[36],t[25]=e[4],t[26]=e[44],t[27]=e[12],t[28]=e[52],t[29]=e[20],t[30]=e[60],t[31]=e[28],t[32]=e[35],t[33]=e[3],t[34]=e[43],t[35]=e[11],t[36]=e[51],t[37]=e[19],t[38]=e[59],t[39]=e[27],t[40]=e[34],t[41]=e[2],t[42]=e[42],t[43]=e[10],t[44]=e[50],t[45]=e[18],t[46]=e[58],t[47]=e[26],t[48]=e[33],t[49]=e[1],t[50]=e[41],t[51]=e[9],t[52]=e[49],t[53]=e[17],t[54]=e[57],t[55]=e[25],t[56]=e[32],t[57]=e[0],t[58]=e[40],t[59]=e[8],t[60]=e[48],t[61]=e[16],t[62]=e[56],t[63]=e[24],t}function getBoxBinary(e){var t="";switch(e){case 0:t="0000";break;case 1:t="0001";break;case 2:t="0010";break;case 3:t="0011";break;case 4:t="0100";break;case 5:t="0101";break;case 6:t="0110";break;case 7:t="0111";break;case 8:t="1000";break;case 9:t="1001";break;case 10:t="1010";break;case 11:t="1011";break;case 12:t="1100";break;case 13:t="1101";break;case 14:t="1110";break;case 15:t="1111"}return t}function generateKeys(e){var t=new Array(56),n=new Array;n[0]=new Array,n[1]=new Array,n[2]=new Array,n[3]=new Array,n[4]=new Array,n[5]=new Array,n[6]=new Array,n[7]=new Array,n[8]=new Array,n[9]=new Array,n[10]=new Array,n[11]=new Array,n[12]=new Array,n[13]=new Array,n[14]=new Array,n[15]=new Array;var r=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];for(i=0;i<7;i++)for(j=0,k=7;j<8;j++,k--)t[i*8+j]=e[8*k+i];var i=0;for(i=0;i<16;i++){var s=0,o=0;for(j=0;j<r[i];j++){s=t[0],o=t[28];for(k=0;k<27;k++)t[k]=t[k+1],t[28+k]=t[29+k];t[27]=s,t[55]=o}var u=new Array(48);u[0]=t[13],u[1]=t[16],u[2]=t[10],u[3]=t[23],u[4]=t[0],u[5]=t[4],u[6]=t[2],u[7]=t[27],u[8]=t[14],u[9]=t[5],u[10]=t[20],u[11]=t[9],u[12]=t[22],u[13]=t[18],u[14]=t[11],u[15]=t[3],u[16]=t[25],u[17]=t[7],u[18]=t[15],u[19]=t[6],u[20]=t[26],u[21]=t[19],u[22]=t[12],u[23]=t[1],u[24]=t[40],u[25]=t[51],u[26]=t[30],u[27]=t[36],u[28]=t[46],u[29]=t[54],u[30]=t[29],u[31]=t[39],u[32]=t[50],u[33]=t[44],u[34]=t[32],u[35]=t[47],u[36]=t[43],u[37]=t[48],u[38]=t[38],u[39]=t[55],u[40]=t[33],u[41]=t[52],u[42]=t[45],u[43]=t[41],u[44]=t[49],u[45]=t[35],u[46]=t[28],u[47]=t[31];switch(i){case 0:for(m=0;m<48;m++)n[0][m]=u[m];break;case 1:for(m=0;m<48;m++)n[1][m]=u[m];break;case 2:for(m=0;m<48;m++)n[2][m]=u[m];break;case 3:for(m=0;m<48;m++)n[3][m]=u[m];break;case 4:for(m=0;m<48;m++)n[4][m]=u[m];break;case 5:for(m=0;m<48;m++)n[5][m]=u[m];break;case 6:for(m=0;m<48;m++)n[6][m]=u[m];break;case 7:for(m=0;m<48;m++)n[7][m]=u[m];break;case 8:for(m=0;m<48;m++)n[8][m]=u[m];break;case 9:for(m=0;m<48;m++)n[9][m]=u[m];break;case 10:for(m=0;m<48;m++)n[10][m]=u[m];break;case 11:for(m=0;m<48;m++)n[11][m]=u[m];break;case 12:for(m=0;m<48;m++)n[12][m]=u[m];break;case 13:for(m=0;m<48;m++)n[13][m]=u[m];break;case 14:for(m=0;m<48;m++)n[14][m]=u[m];break;case 15:for(m=0;m<48;m++)n[15][m]=u[m]}}return n};(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};this.FacePP=function(){function t(n,r,i){var s,o,u,a,f,l=this;this.apiKey=n,this.apiSecret=r,i==null&&(i={}),this.sessionCheck=e(this.sessionCheck,this),s={apiURL:"https://apicn.faceplusplus.com/v2",sessionInterval:500,requestTimeout:1e4,ajaxAdapter:"FormData"in window?"jQuery":"jQuery",concurrency:2};for(o in s)i[o]==null&&(i[o]=s[o]);this.apiURL=i.apiURL.replace(t.RE_TRIM,""),this.sessionInterval=i.sessionInterval,this.requestTimeout=i.requestTimeout,this.requestAdapter=t.adapter[i.ajaxAdapter],(a=i.concurrency)>0&&(u=[],f=function(){var e,n,r,i;a>0&&u.length>0&&(--a,i=u.shift(),e=i[0],r=i[1],n=i[2],t.prototype.request.call(l,e,r,function(e,t){++a,setTimeout(f,0),n(e,t)}))},this.request=function(e,t,n){u.push([e,t,n]),f()})}return t.RE_TRIM=/^\/+|\/+$/g,t.prototype.request=function(e,n,r){var i;n.api_key=this.apiKey,n.api_secret=this.apiSecret,i=this.apiURL+"/"+e.replace(t.RE_TRIM,""),this.requestAdapter(i,n,{timeout:this.requestTimeout},r)},t.prototype.sessionCheck=function(e,t){var n=this;this.request("info/get_session",{session_id:e},function(r,i){r?t(r,i):i.status==="FAILED"?t(i.result.error_code||-1,i.result):i.status==="INQUEUE"?setTimeout(n.sessionCheck,n.sessionInterval,e,t):t(null,i.result)})},t.prototype.requestAsync=function(e,t,n){var r=this;t.async="true",this.request(e,t,function(e,t){e?n(e,t):setTimeout(r.sessionCheck,r.sessionInterval,t.session_id,n)})},t.adapter={jQuery:function(e,t,n,r){var i,s;s=0;for(i in t)s+=t[i].length||0;jQuery.ajax({url:e,dataType:"jsonp",crossDomain:!0,data:t,method:s<1024?"GET":"POST",timeout:n.timeout,error:function(e){var t;if(t=e.responseText)try{t=JSON.parse(t)}catch(n){}r((t!=null?t.error_code:void 0)||-1,t)},success:function(e){r(null,e)}})},XMLHttpRequest:function(e,t,n,r){var i,s,o,u,a,f;o=!1;for(u in t)if(t[u]instanceof Blob){o=!0;break}f=new XMLHttpRequest,f.onreadystatechange=function(){var e;if(this.readyState===4){this.onreadystatechange=null;if(e=this.responseText)try{e=JSON.parse(e)}catch(t){}this.status===200?r(null,e):r(e.error_code||-1,e)}},"timeout"in f&&(f.timeout=n.timeout),f.open("POST",e,!0);if(o){s=new FormData;for(u in t)s.append(u,t[u]);f.send(s)}else{f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i=encodeURIComponent,a=[];for(u in t)a.push(""+i(u)+"="+i(t[u]));f.send(a.join("&"))}}},t}()}).call(this);(function(e,t){typeof define=="function"&&define.amd?define("simple-module",["jquery"],function(n){return e.returnExportsGlobal=t(n)}):typeof exports=="object"?module.exports=t(require("jquery")):e.SimpleModule=t(jQuery)})(this,function(e){var t,n=[].slice;return t=function(){function t(t){var n,r,i,s,o,u,a;this.opts=e.extend({},this.opts,t),(o=this.constructor)._connectedClasses||(o._connectedClasses=[]),i=function(){var e,t,r,i;r=this.constructor._connectedClasses,i=[];for(e=0,t=r.length;e<t;e++)n=r[e],s=n.pluginName.charAt(0).toLowerCase()+n.pluginName.slice(1),n.prototype._connected&&(n.prototype._module=this),i.push(this[s]=new n);return i}.call(this);if(this._connected)this.opts=e.extend({},this.opts,this._module.opts);else{this._init();for(u=0,a=i.length;u<a;u++)r=i[u],typeof r._init=="function"&&r._init()}this.trigger("initialized")}return t.extend=function(e){var t,n,r;if(e==null||typeof e!="object")return;for(t in e)n=e[t],t!=="included"&&t!=="extended"&&(this[t]=n);return(r=e.extended)!=null?r.call(this):void 0},t.include=function(e){var t,n,r;if(e==null||typeof e!="object")return;for(t in e)n=e[t],t!=="included"&&t!=="extended"&&(this.prototype[t]=n);return(r=e.included)!=null?r.call(this):void 0},t.connect=function(e){if(typeof e!="function")return;if(!e.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");e.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(e);if(e.pluginName)return this[e.pluginName]=e},t.prototype.opts={},t.prototype._init=function(){},t.prototype.on=function(){var t,r;return t=1<=arguments.length?n.call(arguments,0):[],(r=e(this)).on.apply(r,t),this},t.prototype.one=function(){var t,r;return t=1<=arguments.length?n.call(arguments,0):[],(r=e(this)).one.apply(r,t),this},t.prototype.off=function(){var t,r;return t=1<=arguments.length?n.call(arguments,0):[],(r=e(this)).off.apply(r,t),this},t.prototype.trigger=function(){var t,r;return t=1<=arguments.length?n.call(arguments,0):[],(r=e(this)).trigger.apply(r,t),this},t.prototype.triggerHandler=function(){var t,r;return t=1<=arguments.length?n.call(arguments,0):[],(r=e(this)).triggerHandler.apply(r,t)},t.prototype._t=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.constructor)._t.apply(t,e)},t._t=function(){var e,t,r,i;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],r=((i=this.i18n[this.locale])!=null?i[t]:void 0)||"",e.length>0?(r=r.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(t,n,r){return r?n+e[parseInt(r)-1]:n+e.shift()}),r.replace(/%%s/g,"%s")):r},t.i18n={"zh-CN":{}},t.locale="zh-CN",t}(),t});(function(e,t){typeof define=="function"&&define.amd?define("simple-hotkeys",["jquery","simple-module"],function(n,r){return e.returnExportsGlobal=t(n,r)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module")):(e.simple=e.simple||{},e.simple.hotkeys=t(jQuery,SimpleModule))})(this,function(e,t){var n,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};return n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.count=0,n.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n.aliases={escape:"esc","delete":"del","return":"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},n.normalize=function(e){var t,n,r,i,s,o;i=e.toLowerCase().replace(/\s+/gi,"").split("+");for(t=s=0,o=i.length;s<o;t=++s)n=i[t],i[t]=this.aliases[n]||n;return r=i.pop(),i.sort().push(r),i.join("_")},n.prototype.opts={el:document},n.prototype._init=function(){return this.id=++this.constructor.count,this._map={},this._delegate=typeof this.opts.el=="string"?document:this.opts.el,e(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,function(e){return function(t){var n;return(n=e._getHander(t))!=null?n.call(e,t):void 0}}(this))},n.prototype._getHander=function(e){var t,n;if(!(t=this.constructor.keyNameMap[e.which]))return;return n="",e.altKey&&(n+="alt_"),e.ctrlKey&&(n+="control_"),e.metaKey&&(n+="meta_"),e.shiftKey&&(n+="shift_"),n+=t.toLowerCase(),this._map[n]},n.prototype.respondTo=function(e){return typeof e=="string"?this._map[this.constructor.normalize(e)]!=null:this._getHander(e)!=null},n.prototype.add=function(e,t){return this._map[this.constructor.normalize(e)]=t,this},n.prototype.remove=function(e){return delete this._map[this.constructor.normalize(e)],this},n.prototype.destroy=function(){return e(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},n}(t),r=function(e){return new n(e)},r});(function(e,t){typeof define=="function"&&define.amd?define("simple-uploader",["jquery","simple-module"],function(n,r){return e.returnExportsGlobal=t(n,r)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module")):(e.simple=e.simple||{},e.simple.uploader=t(jQuery,SimpleModule))})(this,function(e,t){var n,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};return n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.count=0,n.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},n.prototype._init=function(){return this.files=[],this.queue=[],this.id=++n.count,this.on("uploadcomplete",function(t){return function(n,r){return t.files.splice(e.inArray(r,t.files),1),t.queue.length>0&&t.files.length<t.opts.connectionCount?t.upload(t.queue.shift()):t.uploading=!1}}(this)),e(window).on("beforeunload.uploader-"+this.id,function(e){return function(t){if(!e.uploading)return;return t.originalEvent.returnValue=e._t("leaveConfirm"),e._t("leaveConfirm")}}(this))},n.prototype.generateId=function(){var e;return e=0,function(){return e+=1}}(),n.prototype.upload=function(t,n){var r,i,s,o;n==null&&(n={});if(t==null)return;if(e.isArray(t)||t instanceof FileList)for(s=0,o=t.length;s<o;s++)r=t[s],this.upload(r,n);else if(e(t).is("input:file"))i=e(t).attr("name"),i&&(n.fileKey=i),this.upload(e.makeArray(e(t)[0].files),n);else if(!t.id||!t.obj)t=this.getFile(t);if(!t||!t.obj)return;e.extend(t,n);if(this.files.length>=this.opts.connectionCount){this.queue.push(t);return}if(this.triggerHandler("beforeupload",[t])===!1)return;return this.files.push(t),this._xhrUpload(t),this.uploading=!0},n.prototype.getFile=function(e){var t,n,r;return e instanceof window.File||e instanceof window.Blob?(t=(n=e.fileName)!=null?n:e.name,{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:t,size:(r=e.fileSize)!=null?r:e.size,ext:t?t.split(".").pop().toLowerCase():"",obj:e}):null},n.prototype._xhrUpload=function(t){var n,r,i,s;n=new FormData,n.append(t.fileKey,t.obj),n.append("original_filename",t.name);if(t.params){s=t.params;for(r in s)i=s[r],n.append(r,i)}return t.xhr=e.ajax({url:t.url,data:n,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t;return t=e.ajaxSettings.xhr(),t&&(t.upload.onprogress=function(e){return function(t){return e.progress(t)}}(this)),t},progress:function(e){return function(n){if(!n.lengthComputable)return;return e.trigger("uploadprogress",[t,n.loaded,n.total])}}(this),error:function(e){return function(n,r,i){return e.trigger("uploaderror",[t,n,r])}}(this),success:function(n){return function(r){return n.trigger("uploadprogress",[t,t.size,t.size]),n.trigger("uploadsuccess",[t,r]),e(document).trigger("uploadsuccess",[t,r,n])}}(this),complete:function(e){return function(n,r){return e.trigger("uploadcomplete",[t,n.responseText])}}(this)})},n.prototype.cancel=function(e){var t,n,r,i;if(!e.id){i=this.files;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.id===e*1){e=t;break}}}return this.trigger("uploadcancel",[e]),e.xhr&&e.xhr.abort(),e.xhr=null},n.prototype.readImageFile=function(t,n){var r,i;if(!e.isFunction(n))return;return i=new Image,i.onload=function(){return n(i)},i.onerror=function(){return n()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(r=new FileReader,r.onload=function(e){return i.src=e.target.result},r.readAsDataURL(t)):n()},n.prototype.destroy=function(){var t,n,r,i;this.queue.length=0,i=this.files;for(n=0,r=i.length;n<r;n++)t=i[n],this.cancel(t);return e(window).off(".uploader-"+this.id),e(document).off(".uploader-"+this.id)},n.i18n={"zh-CN":{leaveConfirm:"正在上传文件，如果离开上传会自动取消"}},n.locale="zh-CN",n}(t),r=function(e){return new n(e)},r});(function(e,t){typeof define=="function"&&define.amd?define("simditor",["jquery","simple-module","simple-hotkeys","simple-uploader"],function(n,r,i,s){return e.Simditor=t(n,r,i,s)}):typeof exports=="object"?module.exports=t(require("jquery"),require("simple-module"),require("simple-hotkeys"),require("simple-uploader")):e.Simditor=t(jQuery,SimpleModule,simple.hotkeys,simple.uploader)})(this,function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H=function(e,t){function r(){this.constructor=e}for(var n in t)B.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},B={}.hasOwnProperty,j=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},F=[].slice;return T=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="Selection",n.prototype._init=function(){return this.editor=this._module,this.sel=document.getSelection()},n.prototype.clear=function(){var e;try{return this.sel.removeAllRanges()}catch(t){e=t}},n.prototype.getRange=function(){return!this.editor.inputManager.focused||!this.sel.rangeCount?null:this.sel.getRangeAt(0)},n.prototype.selectRange=function(e){return this.clear(),this.sel.addRange(e),!this.editor.inputManager.focused&&(this.editor.util.browser.firefox||this.editor.util.browser.msie)&&this.editor.body.focus(),e},n.prototype.rangeAtEndOf=function(t,n){var r,i,s;n==null&&(n=this.getRange());if(n==null||!n.collapsed)return;t=e(t)[0],r=n.endContainer,i=this.editor.util.getNodeLength(r);if(n.endOffset===i-1&&!!e(r).contents().last().is("br")||n.endOffset===i)return t===r?!0:e.contains(t,r)?(s=!0,e(r).parentsUntil(t).addBack().each(function(t){return function(t,n){var r,i;i=e(n).parent().contents().filter(function(){return this===n||this.nodeType!==3||!!this.nodeValue}),r=i.last();if(!(r.get(0)===n||r.is("br")&&r.prev().get(0)===n))return s=!1,!1}}(this)),s):!1;return!1},n.prototype.rangeAtStartOf=function(t,n){var r,i;n==null&&(n=this.getRange());if(n==null||!n.collapsed)return;return t=e(t)[0],i=n.startContainer,n.startOffset!==0?!1:t===i?!0:e.contains(t,i)?(r=!0,e(i).parentsUntil(t).addBack().each(function(t){return function(t,n){var i;i=e(n).parent().contents().filter(function(){return this===n||this.nodeType!==3||!!this.nodeValue});if(i.first().get(0)!==n)return r=!1}}(this)),r):!1},n.prototype.insertNode=function(t,n){n==null&&(n=this.getRange());if(n==null)return;return t=e(t)[0],n.insertNode(t),this.setRangeAfter(t,n)},n.prototype.setRangeAfter=function(t,n){n==null&&(n=this.getRange());if(n==null)return;return t=e(t)[0],n.setEndAfter(t),n.collapse(!1),this.selectRange(n)},n.prototype.setRangeBefore=function(t,n){n==null&&(n=this.getRange());if(n==null)return;return t=e(t)[0],n.setEndBefore(t),n.collapse(!1),this.selectRange(n)},n.prototype.setRangeAtStartOf=function(t,n){return n==null&&(n=this.getRange()),t=e(t).get(0),n.setEnd(t,0),n.collapse(!1),this.selectRange(n)},n.prototype.setRangeAtEndOf=function(t,n){var r,i,s,o,u,a;return n==null&&(n=this.getRange()),i=e(t),t=i.get(0),i.is("pre")?(s=i.contents(),s.length>0?(o=s.last(),u=o.text(),u.charAt(u.length-1)==="\n"?n.setEnd(o[0],this.editor.util.getNodeLength(o[0])-1):n.setEnd(o[0],this.editor.util.getNodeLength(o[0]))):n.setEnd(t,0)):(a=this.editor.util.getNodeLength(t),t.nodeType!==3&&a>0&&(r=e(t).contents().last(),r.is("br")?a-=1:r[0].nodeType!==3&&this.editor.util.isEmptyNode(r)&&(r.append(this.editor.util.phBr),t=r[0],a=0)),n.setEnd(t,a)),n.collapse(!1),this.selectRange(n)},n.prototype.deleteRangeContents=function(e){var t,n;return e==null&&(e=this.getRange()),n=e.cloneRange(),t=e.cloneRange(),n.collapse(!0),t.collapse(!1),!e.collapsed&&this.rangeAtStartOf(this.editor.body,n)&&this.rangeAtEndOf(this.editor.body,t)?(this.editor.body.empty(),e.setStart(this.editor.body[0],0),e.collapse(!0),this.selectRange(e)):e.deleteContents(),e},n.prototype.breakBlockEl=function(t,n){var r;return n==null&&(n=this.getRange()),r=e(t),n.collapsed?(n.setStartBefore(r.get(0)),n.collapsed?r:r.before(n.extractContents())):r},n.prototype.save=function(t){var n,r,i;t==null&&(t=this.getRange());if(this._selectionSaved)return;return r=t.cloneRange(),r.collapse(!1),i=e("<span/>").addClass("simditor-caret-start"),n=e("<span/>").addClass("simditor-caret-end"),r.insertNode(n[0]),t.insertNode(i[0]),this.clear(),this._selectionSaved=!0},n.prototype.restore=function(){var e,t,n,r,i,s,o;return this._selectionSaved?(i=this.editor.body.find(".simditor-caret-start"),e=this.editor.body.find(".simditor-caret-end"),i.length&&e.length?(s=i.parent(),o=s.contents().index(i),t=e.parent(),n=t.contents().index(e),s[0]===t[0]&&(n-=1),r=document.createRange(),r.setStart(s.get(0),o),r.setEnd(t.get(0),n),i.remove(),e.remove(),this.selectRange(r)):(i.remove(),e.remove()),this._selectionSaved=!1,r):!1},n}(t),l=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="Formatter",n.prototype.opts={allowedTags:null,allowedAttributes:null},n.prototype._init=function(){return this.editor=this._module,this._allowedTags=this.opts.allowedTags||["br","a","img","b","strong","i","u","font","p","ul","ol","li","blockquote","pre","h1","h2","h3","h4","hr"],this._allowedAttributes=this.opts.allowedAttributes||{img:["src","alt","width","height","data-image-src","data-image-size","data-image-name","data-non-image"],a:["href","target"],font:["color"],pre:["data-lang","class"],p:["data-indent"],h1:["data-indent"],h2:["data-indent"],h3:["data-indent"],h4:["data-indent"]},this.editor.body.on("click","a",function(e){return function(e){return!1}}(this))},n.prototype.decorate=function(e){return e==null&&(e=this.editor.body),this.editor.trigger("decorate",[e])},n.prototype.undecorate=function(t){return t==null&&(t=this.editor.body.clone()),this.editor.trigger("undecorate",[t]),e.trim(t.html())},n.prototype.autolink=function(t){var n,r,i,s,o,u,a,f,l,c,h;t==null&&(t=this.editor.body),u=[],r=function(n){return n.contents().each(function(n,i){var s,o;s=e(i);if(s.is("a")||s.closest("a, pre",t).length)return;if(s.contents().length)return r(s);if((o=s.text())&&/https?:\/\/|www\./ig.test(o))return u.push(s)})},r(t),f=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/ig;for(i=0,o=u.length;i<o;i++){n=u[i],c=n.text(),l=[],a=null,s=0;while((a=f.exec(c))!==null)l.push(document.createTextNode(c.substring(s,a.index))),s=f.lastIndex,h=/^(http(s)?:\/\/|\/)/.test(a[0])?a[0]:"http://"+a[0],l.push(e('<a href="'+h+'" rel="nofollow"></a>').text(a[0])[0]);l.push(document.createTextNode(c.substring(s))),n.replaceWith(e(l))}return t},n.prototype.format=function(t){var n,r,i,s,o,u,a,f,l,c;t==null&&(t=this.editor.body);if(t.is(":empty"))return t.append("<p>"+this.editor.util.phBr+"</p>"),t;l=t.contents();for(i=0,o=l.length;i<o;i++)a=l[i],this.cleanNode(a,!0);c=t.contents();for(s=0,u=c.length;s<u;s++){f=c[s],n=e(f);if(n.is("br"))typeof r!="undefined"&&r!==null&&(r=null),n.remove();else if(this.editor.util.isBlockNode(f))n.is("li")?r&&r.is("ul, ol")?r.append(f):(r=e("<ul/>").insertBefore(f),r.append(f)):r=null;else{if(!r||r.is("ul, ol"))r=e("<p/>").insertBefore(f);r.append(f)}}return t},n.prototype.cleanNode=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;i=e(t);if(i.length>0){if(i[0].nodeType===3){y=i.text().replace(/(\r\n|\n|\r)/gm,""),y?(b=document.createTextNode(y),i.replaceWith(b)):i.remove();return}f=i.contents(),l=i.is('[class^="simditor-"]');if(i.is(this._allowedTags.join(","))||l){i.is("a")&&(r=i.find("img")).length>0&&(i.replaceWith(r),i=r,f=null),i.is("img")&&i.hasClass("uploading")&&i.remove();if(!l){u=this._allowedAttributes[i[0].tagName.toLowerCase()],m=e.makeArray(i[0].attributes);for(c=0,p=m.length;c<p;c++)a=m[c],u!=null&&(g=a.name,j.call(u,g)>=0)||i.removeAttr(a.name)}}else i[0].nodeType===1&&!i.is(":empty")?i.is("div, article, dl, header, footer, tr")?(i.append("<br/>"),f.first().unwrap()):i.is("table")?(s=e("<p/>"),i.find("tr").each(function(t){return function(t,n){return s.append(e(n).text()+"<br/>")}}(this)),i.replaceWith(s),f=null):i.is("thead, tfoot")?(i.remove(),f=null):i.is("th")?(o=e("<td/>").append(i.contents()),i.replaceWith(o)):f.first().unwrap():(i.remove(),f=null);if(n&&f!=null&&!i.is("pre"))for(h=0,d=f.length;h<d;h++)v=f[h],this.cleanNode(v,!0);return null}return},n.prototype.clearHtml=function(t,n){var r,i,s;return n==null&&(n=!0),r=e("<div/>").append(t),i=r.contents(),s="",i.each(function(t){return function(r,o){var u,a;if(o.nodeType===3)return s+=o.nodeValue;if(o.nodeType===1){u=e(o),a=u.contents(),a.length>0&&(s+=t.clearHtml(a));if(n&&r<i.length-1&&u.is("br, p, div, li, tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2, h3, h4, header"))return s+="\n"}}}(this)),s},n.prototype.beautify=function(t){var n;return n=function(e){return!!(e.is("p")&&!e.text()&&e.children(":not(br)").length<1)},t.each(function(t){return function(t,r){var i;return i=e(r),i.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty')&&i.remove(),n(i)&&i.remove(),i.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()}}(this))},n}(t),v=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return H(r,t),r.pluginName="InputManager",r.prototype.opts={pasteImage:!1},r.prototype._modifierKeys=[16,17,18,91,93,224],r.prototype._arrowKeys=[37,38,39,40],r.prototype._init=function(){var t;this.editor=this._module,this.throttledTrigger=this.editor.util.throttle(function(e){return function(){var t;return t=1<=arguments.length?F.call(arguments,0):[],setTimeout(function(){var n;return(n=e.editor).trigger.apply(n,t)},10)}}(this),300),this.opts.pasteImage&&typeof this.opts.pasteImage!="string"&&(this.opts.pasteImage="inline"),this._keystrokeHandlers={},this.hotkeys=n({el:this.editor.body}),this._pasteArea=e("<div/>").css({width:"1px",height:"1px",overflow:"hidden",position:"fixed",right:"0",bottom:"100px"}).attr({tabIndex:"-1",contentEditable:!0}).addClass("simditor-paste-area").appendTo(this.editor.el),e(document).on("selectionchange.simditor"+this.editor.id,function(e){return function(t){if(!e.focused)return;return e._selectionTimer&&(clearTimeout(e._selectionTimer),e._selectionTimer=null),e._selectionTimer=setTimeout(function(){return e.editor.trigger("selectionchanged")},20)}}(this)),this.editor.on("valuechanged",function(t){return function(){!t.editor.util.closestBlockEl()&&t.focused&&(t.editor.selection.save(),t.editor.formatter.format(),t.editor.selection.restore()),t.editor.body.find("hr, pre, .simditor-table").each(function(n,r){var i,s;i=e(r);if(i.parent().is("blockquote")||i.parent()[0]===t.editor.body[0]){s=!1,i.next().length===0&&(e("<p/>").append(t.editor.util.phBr).insertAfter(i),s=!0),i.prev().length===0&&(e("<p/>").append(t.editor.util.phBr).insertBefore(i),s=!0);if(s)return setTimeout(function(){return t.editor.trigger("valuechanged")},10)}}),t.editor.body.find("pre:empty").append(t.editor.util.phBr);if(!t.editor.util.support.onselectionchange&&t.focused)return t.editor.trigger("selectionchanged")}}(this)),this.editor.on("selectionchanged",function(e){return function(t){return e.editor.undoManager.update()}}(this)),this.editor.body.on("keydown",e.proxy(this._onKeyDown,this)).on("keypress",e.proxy(this._onKeyPress,this)).on("keyup",e.proxy(this._onKeyUp,this)).on("mouseup",e.proxy(this._onMouseUp,this)).on("focus",e.proxy(this._onFocus,this)).on("blur",e.proxy(this._onBlur,this)).on("paste",e.proxy(this._onPaste,this)).on("drop",e.proxy(this._onDrop,this)).on("input",e.proxy(this._onInput,this)),this.editor.util.browser.firefox&&(this.addShortcut("cmd+left",function(e){return function(t){return t.preventDefault(),e.editor.selection.sel.modify("move","backward","lineboundary"),!1}}(this)),this.addShortcut("cmd+right",function(e){return function(t){return t.preventDefault(),e.editor.selection.sel.modify("move","forward","lineboundary"),!1}}(this)),this.addShortcut("cmd+a",function(e){return function(t){var n,r,i,s;n=e.editor.body.children();if(n.length>0)return r=n.first().get(0),i=n.last().get(0),s=document.createRange(),s.setStart(r,0),s.setEnd(i,e.editor.util.getNodeLength(i)),e.editor.selection.selectRange(s),!1;return}}(this))),t=this.editor.util.os.mac?"cmd+enter":"ctrl+enter",this.addShortcut(t,function(e){return function(t){return e.editor.el.closest("form").find("button:submit").click(),!1}}(this));if(this.editor.textarea.attr("autofocus"))return setTimeout(function(e){return function(){return e.editor.focus()}}(this),0)},r.prototype._onFocus=function(e){return this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,this.lastCaretPosition=null,setTimeout(function(e){return function(){return e.editor.triggerHandler("focus"),e.editor.trigger("selectionchanged")}}(this),0)},r.prototype._onBlur=function(e){var t;return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=(t=this.editor.undoManager.currentState())!=null?t.caret:void 0,this.editor.triggerHandler("blur")},r.prototype._onMouseUp=function(e){if(!this.editor.util.support.onselectionchange)return setTimeout(function(e){return function(){return e.editor.trigger("selectionchanged")}}(this),0)},r.prototype._onKeyDown=function(t){var n,r,i,s;if(this.editor.triggerHandler(t)===!1)return!1;if(this.hotkeys.respondTo(t))return;if(t.which in this._keystrokeHandlers){s=typeof (n=this._keystrokeHandlers[t.which])["*"]=="function"?n["*"](t):void 0;if(s)return this.editor.trigger("valuechanged"),!1;this.editor.util.traverseUp(function(n){return function(r){var i,o;if(r.nodeType!==document.ELEMENT_NODE)return;i=(o=n._keystrokeHandlers[t.which])!=null?o[r.tagName.toLowerCase()]:void 0,s=typeof i=="function"?i(t,e(r)):void 0;if(s===!0||s===!1)return!1}}(this));if(s)return this.editor.trigger("valuechanged"),!1}if((r=t.which,j.call(this._modifierKeys,r)>=0)||(i=t.which,j.call(this._arrowKeys,i)>=0))return;if(this.editor.util.metaKey(t)&&t.which===86)return;return this.editor.util.support.oninput||this.throttledTrigger("valuechanged",["typing"]),null},r.prototype._onKeyPress=function(e){if(this.editor.triggerHandler(e)===!1)return!1},r.prototype._onKeyUp=function(t){var n,r;if(this.editor.triggerHandler(t)===!1)return!1;if(!this.editor.util.support.onselectionchange&&(r=t.which,j.call(this._arrowKeys,r)>=0)){this.editor.trigger("selectionchanged");return}(t.which===8||t.which===46)&&this.editor.util.isEmptyNode(this.editor.body)&&(this.editor.body.empty(),n=e("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(n))},r.prototype._onPaste=function(t){var n,r,i,s,o,u,a,f,l;if(this.editor.triggerHandler(t)===!1)return!1;a=this.editor.selection.deleteRangeContents(),a.collapsed||a.collapse(!0),n=this.editor.util.closestBlockEl(),r=n.is("pre, table");if(t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length>0){o=t.originalEvent.clipboardData.items[0];if(/^image\//.test(o.type)&&!r){i=o.getAsFile();if(i==null||!this.opts.pasteImage)return;return i.name||(i.name="Clipboard Image.png"),l={},l[this.opts.pasteImage]=!0,(f=this.editor.uploader)!=null&&f.upload(i,l),!1}}return u=function(t){return function(i){var s,o,u,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;if(t.editor.triggerHandler("pasting",[i])===!1)return;if(!i)return;if(r)if(n.is("table")){E=i.split("\n"),d=E.pop();for(c=0,v=E.length;c<v;c++)w=E[c],t.editor.selection.insertNode(document.createTextNode(w)),t.editor.selection.insertNode(e("<br/>"));t.editor.selection.insertNode(document.createTextNode(d))}else{i=e("<div/>").text(i),N=i.contents();for(h=0,m=N.length;h<m;h++)x=N[h],t.editor.selection.insertNode(e(x)[0],a)}else if(n.is(t.editor.body))for(p=0,g=i.length;p<g;p++)x=i[p],t.editor.selection.insertNode(x,a);else{if(i.length<1)return;if(i.length===1)if(i.is("p")){u=i.contents();if(u.length===1&&u.is("img")){s=u;if(/^data:image/.test(s.attr("src"))){if(!t.opts.pasteImage)return;o=t.editor.util.dataURLtoBlob(s.attr("src")),o.name="Clipboard Image.png",l={},l[t.opts.pasteImage]=!0,(C=t.editor.uploader)!=null&&C.upload(o,l);return}if(s.is('img[src^="webkit-fake-url://"]'))return}for(S=0,y=u.length;S<y;S++)x=u[S],t.editor.selection.insertNode(x,a)}else if(n.is("p")&&t.editor.util.isEmptyNode(n))n.replaceWith(i),t.editor.selection.setRangeAtEndOf(i,a);else if(i.is("ul, ol"))if(i.find("li").length===1){i=e("<div/>").text(i.text()),k=i.contents();for(T=0,b=k.length;T<b;T++)x=k[T],t.editor.selection.insertNode(e(x)[0],a)}else n.is("li")?(n.parent().after(i),t.editor.selection.setRangeAtEndOf(i,a)):(n.after(i),t.editor.selection.setRangeAtEndOf(i,a));else n.after(i),t.editor.selection.setRangeAtEndOf(i,a);else n.is("li")&&(n=n.parent()),t.editor.selection.rangeAtStartOf(n,a)?f="before":t.editor.selection.rangeAtEndOf(n,a)?f="after":(t.editor.selection.breakBlockEl(n,a),f="before"),n[f](i),t.editor.selection.setRangeAtEndOf(i.last(),a)}return t.editor.trigger("valuechanged")}}(this),r?(t.preventDefault(),this.editor.util.browser.msie?s=window.clipboardData.getData("Text"):s=t.originalEvent.clipboardData.getData("text/plain"),u(s)):(this.editor.selection.save(a),this._pasteArea.focus(),this.editor.util.browser.msie&&this.editor.util.browser.version===10&&(t.preventDefault(),this._pasteArea.html(window.clipboardData.getData("Text"))),setTimeout(function(t){return function(){return t._pasteArea.is(":empty")?s=null:(s=e("<div/>").append(t._pasteArea.contents()),s.find("table colgroup").remove(),t.editor.formatter.format(s),t.editor.formatter.decorate(s),t.editor.formatter.beautify(s.children()),s=s.contents()),t._pasteArea.empty(),a=t.editor.selection.restore(),u(s)}}(this),10))},r.prototype._onDrop=function(e){return this.editor.triggerHandler(e)===!1?!1:setTimeout(function(e){return function(){return e.editor.trigger("valuechanged")}}(this),0)},r.prototype._onInput=function(e){return this.throttledTrigger("valuechanged",["oninput"])},r.prototype.addKeystrokeHandler=function(e,t,n){return this._keystrokeHandlers[e]||(this._keystrokeHandlers[e]={}),this._keystrokeHandlers[e][t]=n},r.prototype.addShortcut=function(t,n){return this.hotkeys.add(t,e.proxy(n,this))},r}(t),g=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="Keystroke",n.prototype._init=function(){var t;this.editor=this._module,this.editor.util.browser.safari&&this.editor.inputManager.addKeystrokeHandler("13","*",function(t){return function(n){var r,i;if(!n.shiftKey)return;r=t.editor.util.closestBlockEl();if(r.is("pre"))return;return i=e("<br/>"),t.editor.selection.rangeAtEndOf(r)?(t.editor.selection.insertNode(i),t.editor.selection.insertNode(e("<br/>")),t.editor.selection.setRangeBefore(i)):t.editor.selection.insertNode(i),!0}}(this));if(this.editor.util.browser.webkit||this.editor.util.browser.msie)t=function(t){return function(n,r){var i;if(!t.editor.selection.rangeAtEndOf(r))return;return i=e("<p/>").append(t.editor.util.phBr).insertAfter(r),t.editor.selection.setRangeAtStartOf(i),!0}}(this),this.editor.inputManager.addKeystrokeHandler("13","h1",t),this.editor.inputManager.addKeystrokeHandler("13","h2",t),this.editor.inputManager.addKeystrokeHandler("13","h3",t),this.editor.inputManager.addKeystrokeHandler("13","h4",t),this.editor.inputManager.addKeystrokeHandler("13","h5",t),this.editor.inputManager.addKeystrokeHandler("13","h6",t);return this.editor.inputManager.addKeystrokeHandler("8","*",function(e){return function(t){var n,r,i;i=e.editor.util.furthestBlockEl(),r=i.prev();if(r.is("hr")&&e.editor.selection.rangeAtStartOf(i))return e.editor.selection.save(),r.remove(),e.editor.selection.restore(),!0;n=e.editor.util.closestBlockEl();if(e.editor.util.browser.webkit&&e.editor.selection.rangeAtStartOf(n))return e.editor.selection.save(),e.editor.formatter.cleanNode(n,!0),e.editor.selection.restore(),null}}(this)),this.editor.inputManager.addKeystrokeHandler("9","*",function(e){return function(t){var n;n=e.editor.toolbar.findButton("code");if(!(e.editor.opts.tabIndent||n&&n.active))return;return t.shiftKey?e.editor.util.outdent():e.editor.util.indent(),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("13","li",function(t){return function(n,r){var i,s,o,u;i=r.clone(),i.find("ul, ol").remove();if(!t.editor.util.isEmptyNode(i)||!r.is(t.editor.util.closestBlockEl()))return;s=r.parent();if(r.next("li").length>0){if(!t.editor.util.isEmptyNode(r))return;s.parent("li").length>0?(o=e("<li/>").append(t.editor.util.phBr).insertAfter(s.parent("li")),u=e("<"+s[0].tagName+"/>").append(r.nextAll("li")),o.append(u)):(o=e("<p/>").append(t.editor.util.phBr).insertAfter(s),u=e("<"+s[0].tagName+"/>").append(r.nextAll("li")),o.after(u))}else s.parent("li").length>0?(o=e("<li/>").insertAfter(s.parent("li")),r.contents().length>0?o.append(r.contents()):o.append(t.editor.util.phBr)):(o=e("<p/>").append(t.editor.util.phBr).insertAfter(s),r.children("ul, ol").length>0&&o.after(r.children("ul, ol")));return r.prev("li").length?r.remove():s.remove(),t.editor.selection.setRangeAtStartOf(o),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("13","pre",function(t){return function(n,r){var i,s,o;return n.preventDefault(),n.shiftKey?(i=e("<p/>").append(t.editor.util.phBr).insertAfter(r),t.editor.selection.setRangeAtStartOf(i),!0):(o=t.editor.selection.getRange(),s=null,o.deleteContents(),!t.editor.util.browser.msie&&t.editor.selection.rangeAtEndOf(r)?(s=document.createTextNode("\n\n"),o.insertNode(s),o.setEnd(s,1)):(s=document.createTextNode("\n"),o.insertNode(s),o.setStartAfter(s)),o.collapse(!1),t.editor.selection.selectRange(o),!0)}}(this)),this.editor.inputManager.addKeystrokeHandler("13","blockquote",function(e){return function(t,n){var r,i;r=e.editor.util.closestBlockEl();if(!(r.is("p")&&!r.next().length&&e.editor.util.isEmptyNode(r)))return;return n.after(r),i=document.createRange(),e.editor.selection.setRangeAtStartOf(r,i),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","li",function(t){return function(n,r){var i,s,o,u,a,f,l,c;s=r.children("ul, ol"),a=r.prev("li");if(s.length>0&&a.length>0)return c="",f=null,r.contents().each(function(t,n){if(n.nodeType===1&&/UL|OL/.test(n.nodeName))return!1;if(n.nodeType===1&&/BR/.test(n.nodeName))return;return n.nodeType===3&&n.nodeValue?c+=n.nodeValue:n.nodeType===1&&(c+=e(n).text()),f=e(n)}),f&&c.length===1&&t.editor.util.browser.firefox&&!f.next("br").length?(i=e(t.editor.util.phBr).insertAfter(f),f.remove(),t.editor.selection.setRangeBefore(i),!0):c.length>0?!1:(l=document.createRange(),u=a.children("ul, ol"),u.length>0?(o=e("<li/>").append(t.editor.util.phBr).appendTo(u),u.append(s.children("li")),r.remove(),t.editor.selection.setRangeAtEndOf(o,l)):(t.editor.selection.setRangeAtEndOf(a,l),a.append(s),r.remove(),t.editor.selection.selectRange(l)),!0);return!1}}(this)),this.editor.inputManager.addKeystrokeHandler("8","pre",function(t){return function(n,r){var i,s,o;if(!t.editor.selection.rangeAtStartOf(r))return;return s=r.html().replace("\n","<br/>"),i=e("<p/>").append(s||t.editor.util.phBr).insertAfter(r),r.remove(),o=document.createRange(),t.editor.selection.setRangeAtStartOf(i,o),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","blockquote",function(e){return function(t,n){var r,i;if(!e.editor.selection.rangeAtStartOf(n))return;return r=n.children().first().unwrap(),i=document.createRange(),e.editor.selection.setRangeAtStartOf(r,i),!0}}(this))},n}(t),_=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="UndoManager",n.prototype._index=-1,n.prototype._capacity=50,n.prototype._timer=null,n.prototype._init=function(){var e,t;return this.editor=this._module,this._stack=[],this.editor.util.os.mac?(t="cmd+z",e="shift+cmd+z"):this.editor.util.os.win?(t="ctrl+z",e="ctrl+y"):(t="ctrl+z",e="shift+ctrl+z"),this.editor.inputManager.addShortcut(t,function(e){return function(t){return t.preventDefault(),e.undo(),!1}}(this)),this.editor.inputManager.addShortcut(e,function(e){return function(t){return t.preventDefault(),e.redo(),!1}}(this)),this.editor.on("valuechanged",function(e){return function(t,n){if(n==="undo"||n==="redo")return;return e._timer&&(clearTimeout(e._timer),e._timer=null),e._timer=setTimeout(function(){return e._pushUndoState(),e._timer=null},200)}}(this))},n.prototype._pushUndoState=function(){var e,t;if(this.editor.triggerHandler("pushundostate")===!1)return;e=this.currentState(),t=this.editor.body.html();if(e&&e.html===t)return;this._index+=1,this._stack.length=this._index,this._stack.push({html:t,caret:this.caretPosition()});if(this._stack.length>this._capacity)return this._stack.shift(),this._index-=1},n.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},n.prototype.undo=function(){var e;if(this._index<1||this._stack.length<2)return;return this.editor.hidePopover(),this._index-=1,e=this._stack[this._index],this.editor.body.html(e.html),this.caretPosition(e.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"])},n.prototype.redo=function(){var e;if(this._index<0||this._stack.length<this._index+2)return;return this.editor.hidePopover(),this._index+=1,e=this._stack[this._index],this.editor.body.html(e.html),this.caretPosition(e.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["redo"])},n.prototype.update=function(){var e,t;if(this._timer)return;e=this.currentState();if(!e)return;return t=this.editor.body.html(),e.html=t,e.caret=this.caretPosition()},n.prototype._getNodeOffset=function(t,n){var r,i,s;return n?r=e(t):r=e(t).parent(),s=0,i=!1,r.contents().each(function(e){return function(e,r){return n===e||t===r?!1:(r.nodeType===3?i||(s+=1,i=!0):(s+=1,i=!1),null)}}(this)),s},n.prototype._getNodePosition=function(e,t){var n,r;if(e.nodeType===3){r=e.previousSibling;while(r&&r.nodeType===3)e=r,t+=this.editor.util.getNodeLength(r),r=r.previousSibling}else t=this._getNodeOffset(e,t);return n=[],n.unshift(t),this.editor.util.traverseUp(function(e){return function(t){return n.unshift(e._getNodeOffset(t))}}(this),e),n},n.prototype._getNodeByPosition=function(t){var n,r,i,s,o,u,a,f;u=this.editor.body[0],f=t.slice(0,t.length-1);for(i=s=0,o=f.length;s<o;i=++s){a=f[i],r=u.childNodes;if(a>r.length-1){if(i!==t.length-2||!e(u).is("pre")){u=null;break}n=document.createTextNode(""),u.appendChild(n),r=u.childNodes}u=r[a]}return u},n.prototype.caretPosition=function(e){var t,n,r,i,s;if(!e)return r=this.editor.selection.getRange(),!this.editor.inputManager.focused||r==null?{}:(e={start:[],end:null,collapsed:!0},e.start=this._getNodePosition(r.startContainer,r.startOffset),r.collapsed||(e.end=this._getNodePosition(r.endContainer,r.endOffset),e.collapsed=!1),e);this.editor.inputManager.focused||this.editor.body.focus();if(!e.start){this.editor.body.blur();return}i=this._getNodeByPosition(e.start),s=e.start[e.start.length-1],e.collapsed?(t=i,n=s):(t=this._getNodeByPosition(e.end),n=e.start[e.start.length-1]);if(!i||!t)throw new Error("simditor: invalid caret state");return r=document.createRange(),r.setStart(i,s),r.setEnd(t,n),this.editor.selection.selectRange(r)},n}(t),P=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="Util",n.prototype._init=function(){this.editor=this._module;if(this.browser.msie&&this.browser.version<11)return this.phBr=""},n.prototype.phBr="<br/>",n.prototype.os=function(){var e;return e={},/Mac/.test(navigator.appVersion)?e.mac=!0:/Linux/.test(navigator.appVersion)?e.linux=!0:/Win/.test(navigator.appVersion)?e.win=!0:/X11/.test(navigator.appVersion)&&(e.unix=!0),/Mobi/.test(navigator.appVersion)&&(e.mobile=!0),e}(),n.prototype.browser=function(){var e,t,n,r,i,s,o,u,a;return a=navigator.userAgent,n=/(msie|trident)/i.test(a),e=/chrome|crios/i.test(a),u=/safari/i.test(a)&&!e,t=/firefox/i.test(a),n?{msie:!0,version:((r=a.match(/(msie |rv:)(\d+(\.\d+)?)/i))!=null?r[2]:void 0)*1}:e?{webkit:!0,chrome:!0,version:((i=a.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))!=null?i[1]:void 0)*1}:u?{webkit:!0,safari:!0,version:((s=a.match(/version\/(\d+(\.\d+)?)/i))!=null?s[1]:void 0)*1}:t?{mozilla:!0,firefox:!0,version:((o=a.match(/firefox\/(\d+(\.\d+)?)/i))!=null?o[1]:void 0)*1}:{}}(),n.prototype.support=function(){return{onselectionchange:function(){var e,t;t=document.onselectionchange;if(t!==void 0)try{return document.onselectionchange=0,document.onselectionchange===null}catch(n){e=n}finally{document.onselectionchange=t}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),n.prototype.reflow=function(t){return t==null&&(t=document),e(t)[0].offsetHeight},n.prototype.metaKey=function(e){var t;return t=/Mac/.test(navigator.userAgent),t?e.metaKey:e.ctrlKey},n.prototype.isEmptyNode=function(t){var n;return n=e(t),n.is(":empty")||!n.text()&&!n.find(":not(br, span, div)").length},n.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","table"],n.prototype.isBlockNode=function(t){return t=e(t)[0],!t||t.nodeType===3?!1:(new RegExp("^("+this.blockNodes.join("|")+")$")).test(t.nodeName.toLowerCase())},n.prototype.closestBlockEl=function(t){var n,r,i;return t==null&&(i=this.editor.selection.getRange(),t=i!=null?i.commonAncestorContainer:void 0),n=e(t),n.length?(r=n.parentsUntil(this.editor.body).addBack(),r=r.filter(function(e){return function(t){return e.isBlockNode(r.eq(t))}}(this)),r.length?r.last():null):null},n.prototype.furthestNode=function(t,n){var r,i,s;return t==null&&(s=this.editor.selection.getRange(),t=s!=null?s.commonAncestorContainer:void 0),r=e(t),r.length?(i=r.parentsUntil(this.editor.body).addBack(),i=i.filter(function(t){return function(t){var r;return r=i.eq(t),e.isFunction(n)?n(r):r.is(n)}}(this)),i.length?i.first():null):null},n.prototype.furthestBlockEl=function(t){return this.furthestNode(t,e.proxy(this.isBlockNode,this))},n.prototype.getNodeLength=function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},n.prototype.traverseUp=function(t,n){var r,i,s,o,u,a,f;n==null&&(u=this.editor.selection.getRange(),n=u!=null?u.commonAncestorContainer:void 0);if(n==null||!e.contains(this.editor.body[0],n))return!1;o=e(n).parentsUntil(this.editor.body).get(),o.unshift(n),f=[];for(r=0,i=o.length;r<i;r++){s=o[r],a=t(s);if(a===!1)break;f.push(void 0)}return f},n.prototype.indent=function(){var t,n,r,i,s,o,u,a,f,l;t=this.editor.util.closestBlockEl();if(!(t&&t.length>0))return!1;if(t.is("pre"))f=document.createTextNode("  "),this.editor.selection.insertNode(f);else if(t.is("li")){i=t.prev("li");if(i.length<1)return!1;this.editor.selection.save(),l=t.parent()[0].tagName,n=i.children("ul, ol"),n.length>0?n.append(t):e("<"+l+"/>").append(t).appendTo(i),this.editor.selection.restore()}else if(t.is("p, h1, h2, h3, h4"))o=(a=t.attr("data-indent"))!=null?a:0,o=o*1+1,o>10&&(o=10),t.attr("data-indent",o);else if(t.is("table")){u=this.editor.selection.getRange(),s=e(u.commonAncestorContainer).closest("td"),r=s.next("td"),r.length>0||(r=s.parent("tr").next("tr").find("td:first"));if(!(s.length>0&&r.length>0))return!1;this.editor.selection.setRangeAtEndOf(r)}else f=document.createTextNode("    "),this.editor.selection.insertNode(f);return this.editor.trigger("valuechanged"),!0},n.prototype.outdent=function(){var t,n,r,i,s,o,u,a,f;t=this.editor.util.closestBlockEl();if(!(t&&t.length>0))return!1;if(t.is("pre"))return!1;if(t.is("li")){n=t.parent(),r=n.parent("li");if(r.length<1)return o=this.editor.toolbar.findButton(n[0].tagName.toLowerCase()),o!=null&&o.command(),!1;this.editor.selection.save(),t.next("li").length>0&&e("<"+n[0].tagName+"/>").append(t.nextAll("li")).appendTo(t),t.insertAfter(r),n.children("li").length<1&&n.remove(),this.editor.selection.restore()}else if(t.is("p, h1, h2, h3, h4"))u=(f=t.attr("data-indent"))!=null?f:0,u=u*1-1,u<0&&(u=0),t.attr("data-indent",u);else{if(!t.is("table"))return!1;a=this.editor.selection.getRange(),s=e(a.commonAncestorContainer).closest("td"),i=s.prev("td"),i.length>0||(i=s.parent("tr").prev("tr").find("td:last"));if(!(s.length>0&&i.length>0))return!1;this.editor.selection.setRangeAtEndOf(i)}return this.editor.trigger("valuechanged"),!0},n.prototype.dataURLtoBlob=function(e){var t,n,r,i,s,o,u,a,f,l,c;o=window.Blob&&function(){var e;try{return Boolean(new Blob)}catch(t){return e=t,!1}}(),s=o&&window.Uint8Array&&function(){var e;try{return(new Blob([new Uint8Array(100)])).size===100}catch(t){return e=t,!1}}(),t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(!((o||t)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;e.split(",")[0].indexOf("base64")>=0?i=atob(e.split(",")[1]):i=decodeURIComponent(e.split(",")[1]),n=new ArrayBuffer(i.length),a=new Uint8Array(n);for(u=f=0,c=i.length;0<=c?f<=c:f>=c;u=0<=c?++f:--f)a[u]=i.charCodeAt(u);return l=e.split(",")[0].split(":")[1].split(";")[0],o?new Blob([s?a:n],{type:l}):(r=new t,r.append(n),r.getBlob(l))},n.prototype.throttle=function(e,t){var n,r,i;return n=null,r=0,i=function(){if(n)return clearTimeout(n),n=null},function(){var s,o,u,a;return o=Date.now(),r||(r=o),u=t-(o-r),a=null,0<u&&u<t?(r=o,i(),s=arguments,n=setTimeout(function(){return r=0,n=null,a=e.apply(null,s)},t)):(i(),r!==o&&(r=0),a=e.apply(null,arguments)),a}},n.prototype.formatHTML=function(t){var n,r,i,s,o,u,a,f,l;u=/<(\/?)(.+?)(\/?)>/g,f="",s=0,i=null,r="  ",a=function(e,t){return(new Array(t+1)).join(e)};while((o=u.exec(t))!==null)o.isBlockNode=e.inArray(o[2],this.blockNodes)>-1,o.isStartTag=o[1]!=="/"&&o[3]!=="/",o.isEndTag=o[1]==="/"||o[3]==="/",n=i?i.index+i[0].length:0,(l=t.substring(n,o.index)).length>0&&e.trim(l)&&(f+=l),o.isBlockNode&&o.isEndTag&&!o.isStartTag&&(s-=1),o.isBlockNode&&o.isStartTag&&(i&&i.isBlockNode&&i.isEndTag||(f+="\n"),f+=a(r,s)),f+=o[0],o.isBlockNode&&o.isEndTag&&(f+="\n"),o.isBlockNode&&o.isStartTag&&(s+=1),i=o;return e.trim(f)},n}(t),O=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.pluginName="Toolbar",n.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},n.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},n.prototype._init=function(){var t;this.editor=this._module;if(!this.opts.toolbar)return;return e.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(e){return function(e){return!1}}(this)),this.wrapper.on("mousedown",function(e){return function(t){return e.list.find(".menu-on").removeClass(".menu-on")}}(this)),e(document).on("mousedown.simditor"+this.editor.id,function(e){return function(t){return e.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.width(this.wrapper.outerWidth()),this.wrapper.css("top",this.opts.toolbarFloatOffset),t=this.wrapper.outerHeight(),this.editor.util.os.mobile||e(window).on("resize.simditor-"+this.editor.id,function(e){return function(t){return e.wrapper.css("position","static"),e.editor.util.reflow(e.wrapper),e.wrapper.css("left",e.wrapper.offset().left),e.wrapper.css("position","")}}(this)).resize(),e(window).on("scroll.simditor-"+this.editor.id,function(n){return function(r){var i,s,o;o=n.editor.wrapper.offset().top,i=o+n.editor.wrapper.outerHeight()-80,s=e(document).scrollTop()+n.opts.toolbarFloatOffset;if(s<=o||s>=i){n.editor.wrapper.removeClass("toolbar-floating").css("padding-top","");if(n.editor.util.os.mobile)return n.wrapper.css("top",n.opts.toolbarFloatOffset)}else{n.editor.wrapper.addClass("toolbar-floating").css("padding-top",t);if(n.editor.util.os.mobile)return n.wrapper.css("top",s-o+n.opts.toolbarFloatOffset)}}}(this))),this.editor.on("selectionchanged",function(e){return function(){return e.toolbarStatus()}}(this)),this.editor.on("destroy",function(e){return function(){return e.buttons.length=0}}(this)),e(document).on("mousedown.simditor-"+this.editor.id,function(e){return function(t){return e.list.find("li.menu-on").removeClass("menu-on")}}(this))},n.prototype._render=function(){var t,n,r,i;this.buttons=[],this.wrapper=e(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),i=this.opts.toolbar;for(t=0,n=i.length;t<n;t++){r=i[t];if(r==="|"){e(this._tpl.separator).appendTo(this.list);continue}if(!this.constructor.buttons[r])throw new Error('simditor: invalid toolbar button "'+r+'"');this.buttons.push(new this.constructor.buttons[r]({editor:this.editor}))}return this.opts.toolbarHidden?this.wrapper.hide():this.editor.placeholderEl.css("top",this.wrapper.outerHeight())},n.prototype.toolbarStatus=function(t){var n;if(!this.editor.inputManager.focused)return;return n=this.buttons.slice(0),this.editor.util.traverseUp(function(r){return function(r){var i,s,o,u,a,f,l;l=[];for(s=o=0,a=n.length;o<a;s=++o){i=n[s];if(t!=null&&i.name!==t)continue;(!i.status||i.status(e(r))===!0)&&l.push(i)}for(u=0,f=l.length;u<f;u++)i=l[u],s=e.inArray(i,n),n.splice(s,1);if(n.length===0)return!1}}(this))},n.prototype.findButton=function(e){var t;return t=this.list.find(".toolbar-item-"+e).data("button"),t!=null?t:null},n.addButton=function(e){return this.buttons[e.prototype.name]=e},n.buttons={},n}(t),N=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.connect(P),n.connect(v),n.connect(_),n.connect(g),n.connect(l),n.connect(T),n.connect(O),n.count=0,n.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,tabIndent:!0},n.prototype._init=function(){var t,i,s,o;this.textarea=e(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder");if(!this.textarea.length)throw new Error("simditor: param textarea is required.");i=this.textarea.data("simditor"),i!=null&&i.destroy(),this.id=++n.count,this._render(),this.opts.upload&&r&&(o=typeof this.opts.upload=="object"?this.opts.upload:{},this.uploader=r(o)),s=this.textarea.closest("form"),s.length&&(s.on("submit.simditor-"+this.id,function(e){return function(){return e.sync()}}(this)),s.on("reset.simditor-"+this.id,function(e){return function(){return e.setValue("")}}(this))),this.on("initialized",function(e){return function(){return e.opts.placeholder&&e.on("valuechanged",function(){return e._placeholder()}),e.setValue(e.textarea.val().trim()||"")}}(this));if(this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(u){t=u}}},n.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',n.prototype._render=function(){var t,n,r,i;this.el=e(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile");if(this.opts.params){n=this.opts.params,r=[];for(t in n)i=n[t],r.push(e("<input/>",{type:"hidden",name:t,value:i}).insertAfter(this.textarea));return r}},n.prototype._placeholder=function(){var e,t;return e=this.body.children(),e.length===0||e.length===1&&this.util.isEmptyNode(e)&&((t=e.data("indent"))!=null?t:0)<1?this.placeholderEl.show():this.placeholderEl.hide()},n.prototype.setValue=function(e){return this.hidePopover(),this.textarea.val(e),this.body.html(e),this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},n.prototype.getValue=function(){return this.sync()},n.prototype.sync=function(){var t,n,r,i,s,o;n=this.body.clone(),this.formatter.undecorate(n),this.formatter.format(n),this.formatter.autolink(n),t=n.children(),s=t.last("p"),i=t.first("p");while(s.is("p")&&this.util.isEmptyNode(s))r=s,s=s.prev("p"),r.remove();while(i.is("p")&&this.util.isEmptyNode(i))r=i,i=s.next("p"),r.remove();return n.find("img.uploading").remove(),o=e.trim(n.html()),this.textarea.val(o),o},n.prototype.focus=function(){var t,n;if(this.sourceMode){this.textarea.focus();return}return this.inputManager.lastCaretPosition?this.undoManager.caretPosition(this.inputManager.lastCaretPosition):(t=this.body.find("p").last(),t.length>0||(t=e("<p/>").append(this.util.phBr).appendTo(this.body)),n=document.createRange(),this.selection.setRangeAtEndOf(t,n),this.body.focus())},n.prototype.blur=function(){return this.sourceMode?this.textarea.blur():this.body.blur()},n.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(t){return function(t,n){n=e(n).data("popover");if(n.active)return n.hide()}}(this))},n.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),e(document).off(".simditor-"+this.id),e(window).off(".simditor-"+this.id),this.off()},n}(t),N.i18n={"zh-CN":{blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",text:"文本",linkText:"链接文字",linkUrl:"地址",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",source:"HTML源代码",normalText:"普通文本",underline:"下划线文字"}},o=function(t){function n(e){this.editor=e.editor,this.title=this._t(this.name),n.__super__.constructor.call(this,e)}return H(n,t),n.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},n.prototype.name="",n.prototype.icon="",n.prototype.title="",n.prototype.text="",n.prototype.htmlTag="",n.prototype.disableTag="",n.prototype.menu=!1,n.prototype.active=!1,n.prototype.disabled=!1,n.prototype.needFocus=!0,n.prototype.shortcut=null,n.prototype._init=function(){var t,n,r,i,s;this.render(),this.el.on("mousedown",function(e){return function(t){var n,r;return t.preventDefault(),e.el.hasClass("disabled")||e.needFocus&&!e.editor.inputManager.focused?!1:e.menu?(e.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),e.wrapper.is(".menu-on")&&(n=e.menuWrapper.offset().left+e.menuWrapper.outerWidth()+5-e.editor.wrapper.offset().left-e.editor.wrapper.outerWidth(),n>0&&e.menuWrapper.css({left:"auto",right:0}),e.trigger("menuexpand")),!1):(r=e.el.data("param"),e.command(r),!1)}}(this)),this.wrapper.on("click","a.menu-item",function(t){return function(n){var r,i;return n.preventDefault(),r=e(n.currentTarget),t.wrapper.removeClass("menu-on"),r.hasClass("disabled")||t.needFocus&&!t.editor.inputManager.focused?!1:(t.editor.toolbar.wrapper.removeClass("menu-on"),i=r.data("param"),t.command(i),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(e){return function(e){return!1}}(this)),this.editor.on("blur",function(e){return function(){if(e.editor.sourceMode)return;return e.setActive(!1),e.setDisabled(!1)}}(this)),this.shortcut!=null&&this.editor.inputManager.addShortcut(this.shortcut,function(e){return function(t){return e.el.mousedown(),!1}}(this)),r=this.htmlTag.split(","),i=[];for(t=0,n=r.length;t<n;t++)s=r[t],s=e.trim(s),s&&e.inArray(s,this.editor.formatter._allowedTags)<0?i.push(this.editor.formatter._allowedTags.push(s)):i.push(void 0);return i},n.prototype.render=function(){this.wrapper=e(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.el.find("span").addClass(this.icon?"simditor-icon simditor-icon-"+this.icon:"").text(this.text);if(!this.menu)return;return this.menuWrapper=e(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},n.prototype.renderMenu=function(){var t,n,r,i,s,o,u,a;if(!e.isArray(this.menu))return;this.menuEl=e("<ul/>").appendTo(this.menuWrapper),o=this.menu,a=[];for(r=0,i=o.length;r<i;r++){s=o[r];if(s==="|"){e(this._tpl.separator).appendTo(this.menuEl);continue}n=e(this._tpl.menuItem).appendTo(this.menuEl),a.push(t=n.find("a.menu-item").attr({title:(u=s.title)!=null?u:s.text,"data-param":s.param}).addClass("menu-item-"+s.name).find("span").text(s.text))}return a},n.prototype.setActive=function(e){if(e===this.active)return;return this.active=e,this.el.toggleClass("active",this.active),this.editor.toolbar.trigger("buttonstatus",[this])},n.prototype.setDisabled=function(e){if(e===this.disabled)return;return this.disabled=e,this.el.toggleClass("disabled",this.disabled),this.editor.toolbar.trigger("buttonstatus",[this])},n.prototype.status=function(e){return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:(e!=null&&this.setActive(e.is(this.htmlTag)),this.active)},n.prototype.command=function(e){},n.prototype._t=function(){var e,t,r;return e=1<=arguments.length?F.call(arguments,0):[],r=n.__super__._t.apply(this,e),r||(r=(t=this.editor)._t.apply(t,e)),r},n}(t),N.Button=o,x=function(t){function n(e){this.button=e.button,this.editor=e.button.editor,n.__super__.constructor.call(this,e)}return H(n,t),n.prototype.offset={top:4,left:0},n.prototype.target=null,n.prototype.active=!1,n.prototype._init=function(){return this.el=e('<div class="simditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",function(e){return function(t){return e.el.addClass("hover")}}(this)),this.el.on("mouseleave",function(e){return function(t){return e.el.removeClass("hover")}}(this))},n.prototype.render=function(){},n.prototype.show=function(t,n){n==null&&(n="bottom");if(t==null)return;return this.el.siblings(".simditor-popover").each(function(t){return function(t,n){n=e(n).data("popover");if(n.active)return n.hide()}}(this)),this.target=t.addClass("selected"),this.active?(this.refresh(n),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),setTimeout(function(e){return function(){return e.refresh(n),e.trigger("popovershow")}}(this),0))},n.prototype.hide=function(){if(!this.active)return;return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},n.prototype.refresh=function(e){var t,n,r,i,s;e==null&&(e="bottom");if(!this.active)return;return t=this.editor.el.offset(),i=this.target.offset(),r=this.target.outerHeight(),e==="bottom"?s=i.top-t.top+r:e==="top"&&(s=i.top-t.top-this.el.height()),n=Math.min(i.left-t.left,this.editor.wrapper.width()-this.el.outerWidth()-10),this.el.css({top:s+this.offset.top,left:n+this.offset.left})},n.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},n.prototype._t=function(){var e,t,r;return e=1<=arguments.length?F.call(arguments,0):[],r=n.__super__._t.apply(this,e),r||(r=(t=this.button)._t.apply(t,e)),r},n}(t),N.Popover=x,C=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype.name="source",t.prototype.icon="html5",t.prototype.needFocus=!1,t.prototype._init=function(){return t.__super__._init.call(this),this.editor.textarea.on("focus",function(e){return function(t){return e.editor.el.addClass("focus").removeClass("error")}}(this)),this.editor.textarea.on("blur",function(e){return function(t){return e.editor.el.removeClass("focus"),e.editor.setValue(e.editor.textarea.val())}}(this)),this.editor.textarea.on("input",function(e){return function(t){return e._resizeTextarea()}}(this))},t.prototype.status=function(e){return!0},t.prototype.command=function(){var e,t,n,r;this.editor.blur(),this.editor.el.toggleClass("simditor-source-mode"),this.editor.sourceMode=this.editor.el.hasClass("simditor-source-mode"),this.editor.sourceMode&&(this.editor.hidePopover(),this.editor.textarea.val(this.editor.util.formatHTML(this.editor.textarea.val())),this._resizeTextarea()),r=this.editor.toolbar.buttons;for(t=0,n=r.length;t<n;t++)e=r[t],e.name==="source"?e.setActive(this.editor.sourceMode):e.setDisabled(this.editor.sourceMode);return null},t.prototype._resizeTextarea=function(){return this._textareaPadding||(this._textareaPadding=this.editor.textarea.innerHeight()-this.editor.textarea.height()),this.editor.textarea.height(0).height(this.editor.textarea[0].scrollHeight-this._textareaPadding)},t}(o),N.Toolbar.addButton(C),A=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="title",n.prototype.htmlTag="h1, h2, h3, h4",n.prototype.disableTag="pre, table",n.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],n.__super__._init.call(this)},n.prototype.setActive=function(e,t){n.__super__.setActive.call(this,e),this.el.removeClass("active-p active-h1 active-h2 active-h3");if(e)return this.el.addClass("active active-"+t)},n.prototype.status=function(e){var t,n;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:(e!=null&&(t=(n=e[0].tagName)!=null?n.toLowerCase():void 0,this.setActive(e.is(this.htmlTag),t)),this.active)},n.prototype.command=function(t){var n,r,i,s,o,u,a,f,l,c,h;f=this.editor.selection.getRange(),h=f.startContainer,s=f.endContainer,i=this.editor.util.closestBlockEl(h),r=this.editor.util.closestBlockEl(s),this.editor.selection.save(),f.setStartBefore(i[0]),f.setEndAfter(r[0]),n=e(f.extractContents()),c=[],n.children().each(function(e){return function(n,r){var i,s,o,u,a;s=e._convertEl(r,t),a=[];for(o=0,u=s.length;o<u;o++)i=s[o],a.push(c.push(i));return a}}(this)),l=c.reverse();for(o=0,u=l.length;o<u;o++)a=l[o],f.insertNode(a[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},n.prototype._convertEl=function(t,n){var r,i,s;return i=e(t),s=[],i.is(n)?s.push(i):(r=e("<"+n+"/>").append(i.contents()),s.push(r)),s},n}(o),N.Toolbar.addButton(A),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="bold",n.prototype.icon="bold",n.prototype.htmlTag="b, strong",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+b",n.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),n.__super__._init.call(this)},n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:(t=document.queryCommandState("bold")===!0,this.setActive(t),t)},n.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),e(document).trigger("selectionchange")},n}(o),N.Toolbar.addButton(s),m=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="italic",n.prototype.icon="italic",n.prototype.htmlTag="i",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+i",n.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),n.__super__._init.call(this)},n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?this.disabled:(t=document.queryCommandState("italic")===!0,this.setActive(t),t)},n.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),e(document).trigger("selectionchange")},n}(o),N.Toolbar.addButton(m),M=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="underline",n.prototype.icon="underline",n.prototype.htmlTag="u",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+u",n.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),n.__super__.render.call(this)},n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?this.disabled:(t=document.queryCommandState("underline")===!0,this.setActive(t),t)},n.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),e(document).trigger("selectionchange")},n}(o),N.Toolbar.addButton(M),f=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="color",n.prototype.icon="tint",n.prototype.disableTag="pre",n.prototype.menu=!0,n.prototype.render=function(){var e;return e=1<=arguments.length?F.call(arguments,0):[],n.__super__.render.apply(this,e)},n.prototype.renderMenu=function(){return e('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default" data-color=""></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(e){return!1}),this.menuWrapper.on("click",".font-color",function(t){return function(n){var r,i,s,o;t.wrapper.removeClass("menu-on"),r=e(n.currentTarget);if(r.hasClass("font-color-default")){i=t.editor.body.find("p, li");if(!(i.length>0))return;o=window.getComputedStyle(i[0],null).getPropertyValue("color"),s=t._convertRgbToHex(o)}else o=window.getComputedStyle(r[0],null).getPropertyValue("background-color"),s=t._convertRgbToHex(o);if(!s)return;document.execCommand("foreColor",!1,s);if(!t.editor.util.support.oninput)return t.editor.trigger("valuechanged")}}(this))},n.prototype._convertRgbToHex=function(e){var t,n,r;return n=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,t=n.exec(e),t?(r=function(e,t,n){var r;return r=function(e){var t;return t=e.toString(16),t.length===1?"0"+t:t},"#"+r(e)+r(t)+r(n)},r(t[1]*1,t[2]*1,t[3]*1)):""},n}(o),N.Toolbar.addButton(f),w=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.type="",n.prototype.disableTag="pre, table",n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:e==null?this.active:(t=this.type==="ul"?"ol":"ul",e.is(t)?(this.setActive(!1),!0):(this.setActive(e.is(this.htmlTag)),this.active))},n.prototype.command=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;d=this.editor.selection.getRange(),y=d.startContainer,f=d.endContainer,u=this.editor.util.closestBlockEl(y),r=this.editor.util.closestBlockEl(f),this.editor.selection.save(),d.setStartBefore(u[0]),d.setEndAfter(r[0]),u.is("li")&&r.is("li")&&(s=this.editor.util.furthestNode(u,"ul, ol"),i=this.editor.util.furthestNode(r,"ul, ol"),s.is(i)?(l=function(e){var t;t=1;while(!e.parent().is(s))t+=1,e=e.parent();return t},g=l(u),a=l(r),g>a?o=r.parent():o=u.parent(),d.setStartBefore(o[0]),d.setEndAfter(o[0])):(d.setStartBefore(s[0]),d.setEndAfter(i[0]))),n=e(d.extractContents()),m=[],n.children().each(function(e){return function(t,n){var r,i,s,o,u;i=e._convertEl(n),u=[];for(s=0,o=i.length;s<o;s++)r=i[s],m.length&&m[m.length-1].is(e.type)&&r.is(e.type)?u.push(m[m.length-1].append(r.children())):u.push(m.push(r));return u}}(this)),v=m.reverse();for(c=0,h=v.length;c<h;c++)p=v[c],d.insertNode(p[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},n.prototype._convertEl=function(t){var n,r,i,s,o,u,a,f,l;n=e(t),l=[],r=this.type==="ul"?"ol":"ul";if(n.is(this.type))n.children("li").each(function(t){return function(n,r){var i,s,o;s=e(r),i=s.children("ul, ol").remove(),o=e("<p/>").append(e(r).html()||t.editor.util.phBr),l.push(o);if(i.length>0)return l.push(i)}}(this));else if(n.is(r))i=e("<"+this.type+"/>").append(n.html()),l.push(i);else if(n.is("blockquote")){f=n.children().get();for(u=0,a=f.length;u<a;u++)s=f[u],o=this._convertEl(s);e.merge(l,o)}else n.is("table")||(i=e("<"+this.type+"><li></li></"+this.type+">"),i.find("li").append(n.html()||this.editor.util.phBr),l.push(i));return l},n}(o),E=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype.type="ol",t.prototype.name="ol",t.prototype.icon="list-ol",t.prototype.htmlTag="ol",t.prototype.shortcut="cmd+/",t.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),t.__super__._init.call(this)},t}(w),D=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype.type="ul",t.prototype.name="ul",t.prototype.icon="list-ul",t.prototype.htmlTag="ul",t.prototype.shortcut="cmd+.",t.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),t.__super__._init.call(this)},t}(w),N.Toolbar.addButton(E),N.Toolbar.addButton(D),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="blockquote",n.prototype.icon="quote-left",n.prototype.htmlTag="blockquote",n.prototype.disableTag="pre, table",n.prototype.command=function(){var t,n,r,i,s,o,u,a,f,l,c;a=this.editor.selection.getRange(),c=a.startContainer,i=a.endContainer,r=this.editor.util.furthestBlockEl(c),n=this.editor.util.furthestBlockEl(i),this.editor.selection.save(),a.setStartBefore(r[0]),a.setEndAfter(n[0]),t=e(a.extractContents()),l=[],t.children().each(function(e){return function(t,n){var r,i,s,o,u;i=e._convertEl(n),u=[];for(s=0,o=i.length;s<o;s++)r=i[s],l.length&&l[l.length-1].is(e.htmlTag)&&r.is(e.htmlTag)?u.push(l[l.length-1].append(r.children())):u.push(l.push(r));return u}}(this)),f=l.reverse();for(s=0,o=f.length;s<o;s++)u=f[s],a.insertNode(u[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},n.prototype._convertEl=function(t){var n,r,i;return n=e(t),i=[],n.is(this.htmlTag)?n.children().each(function(t){return function(t,n){return i.push(e(n))}}(this)):(r=e("<"+this.htmlTag+"/>").append(n),i.push(r)),i},n}(o),N.Toolbar.addButton(i),u=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="code",n.prototype.icon="code",n.prototype.htmlTag="pre",n.prototype.disableTag="li, table",n.prototype._init=function(){return n.__super__._init.call(this),this.editor.on("decorate",function(t){return function(n,r){return r.find("pre").each(function(n,r){return t.decorate(e(r))})}}(this)),this.editor.on("undecorate",function(t){return function(n,r){return r.find("pre").each(function(n,r){return t.undecorate(e(r))})}}(this))},n.prototype.render=function(){var e;return e=1<=arguments.length?F.call(arguments,0):[],n.__super__.render.apply(this,e),this.popover=new a({button:this})},n.prototype.status=function(e){var t;return t=n.__super__.status.call(this,e),this.active?this.popover.show(e):this.editor.util.isBlockNode(e)&&this.popover.hide(),t},n.prototype.decorate=function(e){var t;t=e.attr("data-lang"),e.removeClass();if(t&&t!==-1)return e.addClass("lang-"+t)},n.prototype.undecorate=function(e){var t;t=e.attr("data-lang"),e.removeClass();if(t&&t!==-1)return e.addClass("lang-"+t)},n.prototype.command=function(){var t,n,r,i,s,o,u,a,f,l,c;a=this.editor.selection.getRange(),c=a.startContainer,i=a.endContainer,r=this.editor.util.closestBlockEl(c),n=this.editor.util.closestBlockEl(i),a.setStartBefore(r[0]),a.setEndAfter(n[0]),t=e(a.extractContents()),l=[],t.children().each(function(e){return function(t,n){var r,i,s,o,u;i=e._convertEl(n),u=[];for(s=0,o=i.length;s<o;s++)r=i[s],l.length&&l[l.length-1].is(e.htmlTag)&&r.is(e.htmlTag)?u.push(l[l.length-1].append(r.contents())):u.push(l.push(r));return u}}(this)),f=l.reverse();for(s=0,o=f.length;s<o;s++)u=f[s],a.insertNode(u[0]);return this.editor.selection.setRangeAtEndOf(l[0]),this.editor.trigger("valuechanged")},n.prototype._convertEl=function(t){var n,r,i,s;return n=e(t),s=[],n.is(this.htmlTag)?(r=e("<p/>").append(n.html().replace("\n","<br/>")),s.push(r)):(!n.text()&&n.children().length===1&&n.children().is("br")?i="\n":i=this.editor.formatter.clearHtml(n),r=e("<"+this.htmlTag+"/>").text(i),s.push(r)),s},n}(o),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">选择程序语言</option>\n      <option value="bash">Bash</option>\n      <option value="c++">C++</option>\n      <option value="cs">C#</option>\n      <option value="css">CSS</option>\n      <option value="erlang">Erlang</option>\n      <option value="less">Less</option>\n      <option value="scss">Sass</option>\n      <option value="diff">Diff</option>\n      <option value="coffeeScript">CoffeeScript</option>\n      <option value="html">Html,XML</option>\n      <option value="json">JSON</option>\n      <option value="java">Java</option>\n      <option value="js">JavaScript</option>\n      <option value="markdown">Markdown</option>\n      <option value="oc">Objective C</option>\n      <option value="php">PHP</option>\n      <option value="perl">Perl</option>\n      <option value="python">Python</option>\n      <option value="ruby">Ruby</option>\n      <option value="sql">SQL</option>\n    </select>\n  </div>\n</div>',t.prototype.render=function(){return this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),this.selectEl.on("change",function(e){return function(t){var n;e.lang=e.selectEl.val(),n=e.target.hasClass("selected"),e.target.removeClass().removeAttr("data-lang"),e.lang!==-1&&(e.target.addClass("lang-"+e.lang),e.target.attr("data-lang",e.lang));if(n)return e.target.addClass("selected")}}(this)),this.editor.on("valuechanged",function(e){return function(t){if(e.active)return e.refresh()}}(this))},t.prototype.show=function(){var e;return e=1<=arguments.length?F.call(arguments,0):[],t.__super__.show.apply(this,e),this.lang=this.target.attr("data-lang"),this.lang!=null?this.selectEl.val(this.lang):this.selectEl.val(-1)},t}(x),N.Toolbar.addButton(u),y=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="link",n.prototype.icon="link",n.prototype.htmlTag="a",n.prototype.disableTag="pre",n.prototype.render=function(){var e;return e=1<=arguments.length?F.call(arguments,0):[],n.__super__.render.apply(this,e),this.popover=new b({button:this})},n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:e==null?this.active:(t=!0,!e.is(this.htmlTag)||e.is('[class^="simditor-"]')?(this.setActive(!1),t=!1):this.editor.selection.rangeAtEndOf(e)?(this.setActive(!0),t=!1):this.setActive(!0),t?this.popover.show(e):this.editor.util.isBlockNode(e)&&this.popover.hide(),this.active)},n.prototype.command=function(){var t,n,r,i,s,o,u,a,f,l;return a=this.editor.selection.getRange(),this.active?(r=e(a.commonAncestorContainer).closest("a"),l=document.createTextNode(r.text()),r.replaceWith(l),a.selectNode(l)):(f=a.startContainer,o=a.endContainer,s=this.editor.util.closestBlockEl(f),n=this.editor.util.closestBlockEl(o),t=e(a.extractContents()),u=this.editor.formatter.clearHtml(t.contents(),!1),r=e("<a/>",{href:"http://www.example.com",target:"_blank",text:u||this._t("linkText")}),s[0]===n[0]?a.insertNode(r[0]):(i=e("<p/>").append(r),a.insertNode(i[0])),a.selectNodeContents(r[0]),this.popover.one("popovershow",function(e){return function(){return u?(e.popover.urlEl.focus(),e.popover.urlEl[0].select()):(e.popover.textEl.focus(),e.popover.textEl[0].select())}}(this))),this.editor.selection.selectRange(a),this.editor.trigger("valuechanged")},n}(o),b=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.render=function(){var t;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("text")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'" tabindex="-1"><span class="simditor-icon simditor-icon-unlink"></span></a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n</div>',this.el.addClass("link-popover").append(t),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.textEl.on("keyup",function(e){return function(t){if(t.which===13)return;return e.target.text(e.textEl.val())}}(this)),this.urlEl.on("keyup",function(e){return function(t){var n;if(t.which===13)return;return n=e.urlEl.val(),!/https?:\/\/|^\//ig.test(n)&&!!n&&(n="http://"+n),e.target.attr("href",n)}}(this)),e([this.urlEl[0],this.textEl[0]]).on("keydown",function(t){return function(n){if(n.which===13||n.which===27||!n.shiftKey&&n.which===9&&e(n.target).hasClass("link-url"))return n.preventDefault(),setTimeout(function(){var e;return e=document.createRange(),t.editor.selection.setRangeAfter(t.target,e),t.hide(),t.editor.trigger("valuechanged")},0)}}(this)),this.unlinkEl.on("click",function(e){return function(t){var n,r;return r=document.createTextNode(e.target.text()),e.target.replaceWith(r),e.hide(),n=document.createRange(),e.editor.selection.setRangeAfter(r,n),e.editor.trigger("valuechanged")}}(this))},n.prototype.show=function(){var e;return e=1<=arguments.length?F.call(arguments,0):[],n.__super__.show.apply(this,e),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},n}(x),N.Toolbar.addButton(y),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="image",n.prototype.icon="picture-o",n.prototype.htmlTag="img",n.prototype.disableTag="pre, table",n.prototype.defaultImage="",n.prototype.needFocus=!1,n.prototype._init=function(){var t,r,i,s;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton)){this.menu=[],s=this.editor.opts.imageButton;for(r=0,i=s.length;r<i;r++)t=s[r],this.menu.push({name:t+"-image",text:this._t(t+"Image")})}else this.menu=!1;else this.editor.uploader!=null?this.menu=[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",function(t){return function(n){var r,i;return r=e(n.currentTarget),i=document.createRange(),i.selectNode(r[0]),t.editor.selection.selectRange(i),t.editor.util.support.onselectionchange||t.editor.trigger("selectionchanged"),!1}}(this)),this.editor.body.on("mouseup","img:not([data-non-image])",function(e){return function(e){return!1}}(this)),this.editor.on("selectionchanged.image",function(t){return function(){var n,r,i;i=t.editor.selection.getRange();if(i==null)return;return n=e(i.cloneContents()).contents(),n.length===1&&n.is("img:not([data-non-image])")?(r=e(i.startContainer).contents().eq(i.startOffset),t.popover.show(r)):t.popover.hide()}}(this)),this.editor.on("valuechanged.image",function(t){return function(){var n;n=t.editor.wrapper.find(".simditor-image-loading");if(n.length>0)return n.each(function(n,r){var i,s,o;s=e(r),i=s.data("img");if(!(i&&i.parent().length>0)){s.remove();if(i){o=i.data("file");if(o){t.editor.uploader.cancel(o);if(t.editor.body.find("img.uploading").length<1)return t.editor.uploader.trigger("uploadready",[o])}}}});return}}(this)),n.__super__._init.call(this)},n.prototype.render=function(){var e;e=1<=arguments.length?F.call(arguments,0):[],n.__super__.render.apply(this,e),this.popover=new p({button:this});if(this.editor.opts.imageButton==="upload")return this._initUploader(this.el)},n.prototype.renderMenu=function(){return n.__super__.renderMenu.call(this),this._initUploader()},n.prototype._initUploader=function(t){var n,r;t==null&&(t=this.menuEl.find(".menu-item-upload-image"));if(this.editor.uploader==null){this.el.find(".btn-upload").remove();return}return n=null,r=function(r){return function(){return n&&n.remove(),n=e('<input type="file" title="'+r._t("uploadImage")+'" accept="image/*">').appendTo(t)}}(this),r(),t.on("click mousedown","input[type=file]",function(e){return function(e){return e.stopPropagation()}}(this)),t.on("change","input[type=file]",function(e){return function(t){return e.editor.inputManager.focused?(e.editor.uploader.upload(n,{inline:!0}),r()):(e.editor.one("focus",function(t){return e.editor.uploader.upload(n,{inline:!0}),r()}),e.editor.focus()),e.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(t){return function(n,r){var i;if(!r.inline)return;return r.img?i=e(r.img):(i=t.createImage(r.name),r.img=i),i.addClass("uploading"),i.data("file",r),t.editor.uploader.readImageFile(r.obj,function(e){var n;if(!i.hasClass("uploading"))return;return n=e?e.src:t.defaultImage,t.loadImage(i,n,function(){if(t.popover.active)return t.popover.refresh(),t.popover.srcEl.val(t._t("uploading")).prop("disabled",!0)})})}}(this)),this.editor.uploader.on("uploadprogress",e.proxy(this.editor.util.throttle(function(e,t,n,r){var i,s,o;if(!t.inline)return;s=t.img.data("mask");if(!s)return;i=s.data("img");if(!(i.hasClass("uploading")&&i.parent().length>0)){s.remove();return}return o=n/r,o=(o*100).toFixed(0),o>99&&(o=99),s.find(".progress").height(100-o+"%")},500),this)),this.editor.uploader.on("uploadsuccess",function(t){return function(n,r,i){var s,o,u;if(!r.inline)return;s=r.img;if(!(s.hasClass("uploading")&&s.parent().length>0))return;s.removeData("file"),s.removeClass("uploading").removeClass("loading"),o=s.data("mask"),o&&o.remove(),s.removeData("mask");if(typeof i!="object")try{i=e.parseJSON(i)}catch(a){n=a,i={success:!1}}i.success===!1?(u=i.msg||t._t("uploadFailed"),alert(u),s.attr("src",t.defaultImage)):s.attr("src",i.file_path),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(i.file_path)),t.editor.trigger("valuechanged");if(t.editor.body.find("img.uploading").length<1)return t.editor.uploader.trigger("uploadready",[r,i])}}(this)),this.editor.uploader.on("uploaderror",function(t){return function(n,r,i){var s,o,u,a;if(!r.inline)return;if(i.statusText==="abort")return;if(i.responseText){try{a=e.parseJSON(i.responseText),u=a.msg}catch(f){n=f,u=t._t("uploadError")}alert(u)}s=r.img;if(!(s.hasClass("uploading")&&s.parent().length>0))return;s.removeData("file"),s.removeClass("uploading").removeClass("loading"),o=s.data("mask"),o&&o.remove(),s.removeData("mask"),s.attr("src",t.defaultImage),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(t.defaultImage)),t.editor.trigger("valuechanged");if(t.editor.body.find("img.uploading").length<1)return t.editor.uploader.trigger("uploadready",[r,a])}}(this))},n.prototype.status=function(e){e!=null&&this.setDisabled(e.is(this.disableTag));if(this.disabled)return!0},n.prototype.loadImage=function(t,n,r){var i,s,o;return o=function(e){return function(){var n,r;return n=t.offset(),r=e.editor.wrapper.offset(),i.css({top:n.top-r.top,left:n.left-r.left,width:t.width(),height:t.height()}).show()}}(this),t.addClass("loading"),i=t.data("mask"),i||(i=e('<div class="simditor-image-loading"><div class="progress"></div></div>').hide().appendTo(this.editor.wrapper),o(),t.data("mask",i),i.data("img",t)),s=new Image,s.onload=function(e){return function(){var u,a;if(!t.hasClass("loading")&&!t.hasClass("uploading"))return;return a=s.width,u=s.height,t.attr({src:n,"data-image-size":a+","+u}).removeClass("loading"),t.hasClass("uploading")?(e.editor.util.reflow(e.editor.body),o()):(i.remove(),t.removeData("mask")),r(s)}}(this),s.onerror=function(e){return function(){return r(!1),i.remove(),t.removeData("mask").removeClass("loading")}}(this),s.src=n},n.prototype.createImage=function(t){var n,r,i,s;return t==null&&(t="Image"),this.editor.inputManager.focused||this.editor.focus(),s=this.editor.selection.getRange(),s.deleteContents(),n=this.editor.util.closestBlockEl(),n.is("p")&&!this.editor.util.isEmptyNode(n)&&(n=e("<p/>").append(this.editor.util.phBr).insertAfter(n),this.editor.selection.setRangeAtStartOf(n,s)),r=e("<img/>").attr("alt",t),s.insertNode(r[0]),i=n.next("p"),i.length>0||(i=e("<p/>").append(this.editor.util.phBr).insertAfter(n)),this.editor.selection.setRangeAtStartOf(i),r},n.prototype.command=function(e){var t;return t=this.createImage(),this.loadImage(t,e||this.defaultImage,function(e){return function(){return e.editor.trigger("valuechanged"),e.editor.util.reflow(t),t.click(),e.popover.one("popovershow",function(){return e.popover.srcEl.focus(),e.popover.srcEl[0].select()})}}(this))},n}(o),p=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.offset={top:6,left:-4},n.prototype.render=function(){var t;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;" title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;" title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(t),this.srcEl=this.el.find(".image-src"),this.srcEl.on("keydown",function(e){return function(t){var n,r;if(t.which!==13&&t.which!==27)return;t.preventDefault(),n=function(){return e.button.editor.body.focus(),e.button.editor.selection.setRangeAfter(e.target),e.hide()};if(t.which===13&&!e.target.hasClass("uploading")){r=e.srcEl.val();if(/^data:image/.test(r)&&!e.editor.uploader){n();return}return e.button.loadImage(e.target,r,function(t){var i;if(!t)return;return/^data:image/.test(r)?(i=e.editor.util.dataURLtoBlob(r),i.name="Base64 Image.png",e.editor.uploader.upload(i,{inline:!0,img:e.target})):(n(),e.editor.trigger("valuechanged"))})}return n()}}(this)),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.el.find(".image-size").on("blur",function(t){return function(n){return t._resizeImg(e(n.currentTarget)),t.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(t){return function(n){var r;r=e(n.currentTarget);if(n.which!==13&&n.which!==27&&n.which!==9)return t._resizeImg(r,!0)}}(this)),this.el.find(".image-size").on("keydown",function(t){return function(n){var r;r=e(n.currentTarget);if(n.which===13||n.which===27)return n.preventDefault(),n.which===13?t._resizeImg(r):t._restoreImg(),t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide();if(n.which===9)return t.el.data("popover").refresh()}}(this)),this.el.find(".btn-restore").on("click",function(e){return function(t){return e._restoreImg(),e.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(e){return function(t){if(e.active)return e.refresh()}}(this)),this._initUploader()},n.prototype._initUploader=function(){var t,n;t=this.el.find(".btn-upload");if(this.editor.uploader==null){t.remove();return}return n=function(n){return function(){return n.input&&n.input.remove(),n.input=e('<input type="file" title="'+n._t("uploadImage")+'" accept="image/*">').appendTo(t)}}(this),n(),this.el.on("click mousedown","input[type=file]",function(e){return function(e){return e.stopPropagation()}}(this)),this.el.on("change","input[type=file]",function(e){return function(t){return e.editor.uploader.upload(e.input,{inline:!0,img:e.target}),n()}}(this))},n.prototype._resizeImg=function(t,n){var r,i,s;n==null&&(n=!1),i=t.val()*1;if(!(e.isNumeric(i)||i<0))return;t.is(this.widthEl)?(r=this.height*i/this.width,this.heightEl.val(r)):(s=this.width*i/this.height,this.widthEl.val(s));if(!n)return this.target.attr({width:s||i,height:r||i})},n.prototype._restoreImg=function(){var e,t;return t=((e=this.target.data("image-size"))!=null?e.split(","):void 0)||[this.width,this.height],this.target.attr({width:t[0]*1,height:t[1]*1}),this.widthEl.val(t[0]),this.heightEl.val(t[1])},n.prototype.show=function(){var e,t;return t=1<=arguments.length?F.call(arguments,0):[],n.__super__.show.apply(this,t),e=this.target,this.width=e.width(),this.height=e.height(),e.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(e.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height))},n}(x),N.Toolbar.addButton(h),d=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype.name="indent",t.prototype.icon="indent",t.prototype._init=function(){return this.title=this._t(this.name)+" (Tab)",t.__super__._init.call(this)},t.prototype.status=function(e){return!0},t.prototype.command=function(){return this.editor.util.indent()},t}(o),N.Toolbar.addButton(d),S=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return H(t,e),t.prototype.name="outdent",t.prototype.icon="outdent",t.prototype._init=function(){return this.title=this._t(this.name)+" (Shift + Tab)",t.__super__._init.call(this)},t.prototype.status=function(e){return!0},t.prototype.command=function(){return this.editor.util.outdent()},t}(o),N.Toolbar.addButton(S),c=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="hr",n.prototype.icon="minus",n.prototype.htmlTag="hr",n.prototype.status=function(e){return!0},n.prototype.command=function(){var t,n,r,i;return i=this.editor.util.furthestBlockEl(),r=i.next(),r.length>0?this.editor.selection.save():n=e("<p/>").append(this.editor.util.phBr),t=e("<hr/>").insertAfter(i),n?(n.insertAfter(t),this.editor.selection.setRangeAtStartOf(n)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},n}(o),N.Toolbar.addButton(c),L=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="table",n.prototype.icon="table",n.prototype.htmlTag="table",n.prototype.disableTag="pre, li, blockquote",n.prototype.menu=!0,n.prototype._init=function(){return n.__super__._init.call(this),e.merge(this.editor.formatter._allowedTags,["tbody","tr","td","colgroup","col"]),e.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),this._initShortcuts(),this.editor.on("decorate",function(t){return function(n,r){return r.find("table").each(function(n,r){return t.decorate(e(r))})}}(this)),this.editor.on("undecorate",function(t){return function(n,r){return r.find("table").each(function(n,r){return t.undecorate(e(r))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(n){var r,i;t.editor.body.find(".simditor-table td").removeClass("active"),i=t.editor.selection.getRange();if(i==null)return;return r=e(i.commonAncestorContainer),i.collapsed&&r.is(".simditor-table")&&(t.editor.selection.rangeAtStartOf(r)?r=r.find("td:first"):r=r.find("td:last"),t.editor.selection.setRangeAtEndOf(r)),r.closest("td",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(e){return function(t){return e.editor.body.find(".simditor-table td").removeClass("active")}}(this)),this.editor.inputManager.addKeystrokeHandler("38","td",function(e){return function(t,n){var r,i,s;return i=n.parent("tr"),r=i.prev("tr"),r.length>0?(s=i.find("td").index(n),e.editor.selection.setRangeAtEndOf(r.find("td").eq(s)),!0):!0}}(this)),this.editor.inputManager.addKeystrokeHandler("40","td",function(e){return function(t,n){var r,i,s;return i=n.parent("tr"),r=i.next("tr"),r.length>0?(s=i.find("td").index(n),e.editor.selection.setRangeAtEndOf(r.find("td").eq(s)),!0):!0}}(this))},n.prototype.initResize=function(t){var n,r,i;return i=t.parent(".simditor-table"),n=t.find("colgroup"),n.length<1&&(n=e("<colgroup/>").prependTo(t),t.find("tr:first td").each(function(t){return function(t,r){var i;return i=e("<col/>").appendTo(n)}}(this)),this.refreshTableWidth(t)),r=e('<div class="simditor-resize-handle" contenteditable="false"></div>').appendTo(i),i.on("mousemove","td",function(t){return function(t){var s,o,u,a,f,l;if(i.hasClass("resizing"))return;o=e(t.currentTarget),l=t.pageX-e(t.currentTarget).offset().left,l<5&&o.prev().length>0&&(o=o.prev());if(o.next("td").length<1){r.hide();return}if((a=r.data("td"))!=null?a.is(o):void 0){r.show();return}u=o.parent().find("td").index(o),s=n.find("col").eq(u);if((f=r.data("col"))!=null?f.is(s):void 0){r.show();return}return r.css("left",o.position().left+o.outerWidth()-5).data("td",o).data("col",s).show()}}(this)),i.on("mouseleave",function(e){return function(e){return r.hide()}}(this)),i.on("mousedown",".simditor-resize-handle",function(t){return function(t){var n,r,s,o,u,a,f,l,c,h,p;return n=e(t.currentTarget),s=n.data("td"),r=n.data("col"),u=s.next("td"),o=r.next("col"),h=t.pageX,l=s.outerWidth()*1,c=u.outerWidth()*1,f=parseFloat(n.css("left")),p=s.closest("table").width(),a=50,e(document).on("mousemove.simditor-resize-table",function(e){var t,i,s;return t=e.pageX-h,i=l+t,s=c-t,i<a?(i=a,t=a-l,s=c-t):s<a&&(s=a,t=c-a,i=l+t),r.attr("width",i/p*100+"%"),o.attr("width",s/p*100+"%"),n.css("left",f+t)}),e(document).one("mouseup.simditor-resize-table",function(t){return e(document).off(".simditor-resize-table"),i.removeClass("resizing")}),i.addClass("resizing"),!1}}(this))},n.prototype._initShortcuts=function(){return this.editor.inputManager.addShortcut("ctrl+alt+up",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+down",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+left",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+right",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},n.prototype.decorate=function(e){return e.parent(".simditor-table").length>0&&this.undecorate(e),e.wrap('<div class="simditor-table"></div>'),this.initResize(e),e.parent()},n.prototype.undecorate=function(e){if(e.parent(".simditor-table").length>0)return e.parent().replaceWith(e);return},n.prototype.renderMenu=function(){return e('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteRow"><span>'+this._t("deleteRow")+'</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowAbove"><span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowBelow"><span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteCol"><span>'+this._t("deleteColumn")+'</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColLeft"><span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColRight"><span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteTable"><span>'+this._t("deleteTable")+"</span></a></li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td",function(t){return function(n){var r,i,s;return t.createMenu.find("td").removeClass("selected"),r=e(n.currentTarget),i=r.parent(),s=i.find("td").index(r)+1,i.prevAll("tr").addBack().find("td:lt("+s+")").addClass("selected")}}(this)),this.createMenu.on("mouseleave",function(t){return function(t){return e(t.currentTarget).find("td").removeClass("selected")}}(this)),this.createMenu.on("mousedown","td",function(t){return function(n){var r,i,s,o,u,a;t.wrapper.removeClass("menu-on");if(!t.editor.inputManager.focused)return;return s=e(n.currentTarget),o=s.parent(),u=o.find("td").index(s)+1,a=o.prevAll("tr").length+1,i=t.createTable(a,u,!0),r=t.editor.util.closestBlockEl(),t.editor.util.isEmptyNode(r)?r.replaceWith(i):r.after(i),t.decorate(i),t.editor.selection.setRangeAtStartOf(i.find("td:first")),t.editor.trigger("valuechanged"),!1}}(this))},n.prototype.createTable=function(t,n,r){var i,s,o,u,a,f,l,c,h,p;i=e("<table/>"),s=e("<tbody/>").appendTo(i);for(c=f=0,h=t;0<=h?f<h:f>h;c=0<=h?++f:--f){u=e("<tr/>").appendTo(s);for(a=l=0,p=n;0<=p?l<p:l>p;a=0<=p?++l:--l)o=e("<td/>").appendTo(u),r&&o.append(this.editor.util.phBr)}return i},n.prototype.refreshTableWidth=function(t){var n,r;return r=t.width(),n=t.find("col"),t.find("tr:first td").each(function(t){return function(t,i){var s;return s=n.eq(t),s.attr("width",e(i).outerWidth()/r*100+"%")}}(this))},n.prototype.setActive=function(e){return n.__super__.setActive.call(this,e),e?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},n.prototype.deleteRow=function(e){var t,n,r;return n=e.parent("tr"),n.siblings("tr").length<1?this.deleteTable(e):(t=n.next("tr"),t.length>0||(t=n.prev("tr")),r=n.find("td").index(e),n.remove(),this.editor.selection.setRangeAtEndOf(t.find("td").eq(r)))},n.prototype.insertRow=function(t,n){var r,i,s,o,u,a,f,l;n==null&&(n="after"),s=t.parent("tr"),i=s.closest("table"),o=0,i.find("tr").each(function(t){return function(t,n){return o=Math.max(o,e(n).find("td").length)}}(this)),r=e("<tr/>");for(u=f=1,l=o;1<=l?f<=l:f>=l;u=1<=l?++f:--f)e("<td/>").append(this.editor.util.phBr).appendTo(r);return s[n](r),a=s.find("td").index(t),this.editor.selection.setRangeAtStartOf(r.find("td").eq(a))},n.prototype.deleteCol=function(t){var n,r,i,s;return i=t.parent("tr"),i.siblings("tr").length<1&&t.siblings("td").length<1?this.deleteTable(t):(s=i.find("td").index(t),n=t.next("td"),n.length>0||(n=i.prev("td")),r=i.closest("table"),r.find("col").eq(s).remove(),r.find("tr").each(function(t){return function(t,n){return e(n).find("td").eq(s).remove()}}(this)),this.refreshTableWidth(r),this.editor.selection.setRangeAtEndOf(n))},n.prototype.insertCol=function(t,n){var r,i,s,o,u,a,f,l;return n==null&&(n="after"),u=t.parent("tr"),a=u.find("td").index(t),o=t.closest("table"),r=o.find("col").eq(a),o.find("tr").each(function(t){return function(r,i){var s;return s=e("<td/>").append(t.editor.util.phBr),e(i).find("td").eq(a)[n](s)}}(this)),i=e("<col/>"),r[n](i),f=o.width(),l=Math.max(parseFloat(r.attr("width"))/2,50/f*100),r.attr("width",l+"%"),i.attr("width",l+"%"),this.refreshTableWidth(o),s=n==="after"?t.next("td"):t.prev("td"),this.editor.selection.setRangeAtStartOf(s)},n.prototype.deleteTable=function(e){var t,n;n=e.closest(".simditor-table"),t=n.next("p"),n.remove();if(t.length>0)return this.editor.selection.setRangeAtStartOf(t)},n.prototype.command=function(t){var n,r;r=this.editor.selection.getRange(),n=e(r.commonAncestorContainer).closest("td");if(n.length>0){if(t==="deleteRow")this.deleteRow(n);else if(t==="insertRowAbove")this.insertRow(n,"before");else if(t==="insertRowBelow")this.insertRow(n);else if(t==="deleteCol")this.deleteCol(n);else if(t==="insertColLeft")this.insertCol(n,"before");else if(t==="insertColRight")this.insertCol(n);else{if(t!=="deleteTable")return;this.deleteTable(n)}return this.editor.trigger("valuechanged")}return},n}(o),N.Toolbar.addButton(L),k=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return H(n,t),n.prototype.name="strikethrough",n.prototype.icon="strikethrough",n.prototype.htmlTag="strike",n.prototype.disableTag="pre",n.prototype.status=function(e){var t;return e!=null&&this.setDisabled(e.is(this.disableTag)),this.disabled?!0:(t=document.queryCommandState("strikethrough")===!0,this.setActive(t),t)},n.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),e(document).trigger("selectionchange")},n}(o),N.Toolbar.addButton(k),N});OJApp.controller("cadRankController",["$scope","$http","CadData",function(e,t,n){}]);OJApp.controller("comListController",["$scope","$http","CadData",function(e,t,n){}]);OJApp.controller("eachComController",["$scope","$http","CadData",function(e,t,n){}]);OJApp.controller("frComController",["$scope","$http","CadData",function(e,t,n){}]);OJApp.controller("cadLoginCtrl",["$scope","$http","Data",function(e,t,n){e.errorMsg={},e.verifyQtn={},e.confirm=function(){if(e.Lemail&&e.Lpwd){var r=md5(e.Lpwd);console.log(r),t({url:WEBROOT+"/tuser/confirm",method:"POST",headers:{Authorization:n.token()},data:{email:e.Lemail,pwd:r}}).success(function(t){console.log("success1"),e.state=t.state,n.clear();var r=e.Lname;e.message=t.message,n.setName(e.message.username),n.setEmail(e.Lemail),e.state==0?(n.setToken(t.token),n.setLastActive((new Date).getTime()),console.log("已经登录成功")):e.errmsg=t.message.msg}).error(function(){console.log("err"),alert("网络错误")})}}}]);OJApp.controller("cadSignupCtrl",["$scope","$http","Data",function(e,t,n){e.Remail,e.name,e.errorMsg={},e.verifyQtn={},console.log("dadada"),e.$on("mobileError",function(t,n){e.$apply(function(){e.errorMsg.mobile=n})}),e.$on("vertifycode",function(t,n){e.$apply(function(){e.verifyQtn.answer=n})}),e.addhr=function(){if(e.Remail&&e.Rpwd&&e.verifyAns)if(e.Rpwd!=null)if(e.verifyAns==e.verifyQtn.answer){var r=/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!r.test(e.Remail))return e.errorEmail="请输入正确的email格式1",!1;t({url:WEBROOT+"/tuser/register",method:"POST",headers:{Authorization:n.token()},data:{email:e.Remail,pwd:md5(e.Rpwd.toLowerCase()),username:e.name,tel:e.mobile}}).success(function(t){e.state=t.state,e.message=t.message,e.state==0?(n.setToken(t.token),n.setName(e.message.email),n.setEmail(e.message.email)):alert(e.message)}).error(function(){alert("网络错误q")})}else e.errorMsg.general="验证问题答案错误";else e.errorMsg.general="密码为空，请重新输入";else e.errorMsg.general="所有选项均不可为空"}}]);